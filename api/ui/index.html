<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HYCä¸‹è½½ç«™ v2.2 - ç®¡ç†æ§åˆ¶å°</title>
    <!-- Font Awesome å›¾æ ‡åº“ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <!-- Chart.js å›¾è¡¨åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg: #0f0f23;
            --bg-dark: #0f0f23;
            --bg-card: #1a1a2e;
            --bg-input: #16213e;
            --primary: #e94560;
            --primary-hover: #ff6b6b;
            --text: #eee;
            --text-muted: #888;
            --border: #2a2a4a;
            --success: #4ade80;
            --warning: #fbbf24;
            --danger: #ef4444;
            --info: #60a5fa;
        }
        html, body {
            height: 100%;
            overflow: hidden;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
        }

        /* ä¸»æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; margin-right: 2px; }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 4px; border: 2px solid var(--bg-dark); }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary-hover); }

        /* ç™»å½•é¡µ */
        .login-container { display: flex; justify-content: center; align-items: center; min-height: 100vh; background: var(--bg-dark); }
        .login-box { background: var(--bg-card); padding: 40px; border-radius: 12px; width: 400px; box-shadow: 0 10px 40px rgba(0,0,0,0.4); border: 1px solid var(--border); }
        .login-box h1 { text-align: center; margin-bottom: 10px; color: var(--primary); font-size: 28px; }
        .login-box .subtitle { text-align: center; color: var(--text-muted); margin-bottom: 30px; }
        .login-box input { width: 100%; padding: 12px 16px; margin: 10px 0; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-input); color: var(--text); font-size: 14px; }
        .login-box input:focus { outline: none; border-color: var(--primary); }
        .login-box button { width: 100%; padding: 14px; border: none; border-radius: 8px; background: var(--primary); color: #fff; cursor: pointer; font-size: 16px; font-weight: 600; margin-top: 10px; transition: all 0.2s; }
        .login-box button:hover { background: var(--primary-hover); transform: translateY(-1px); }
        .login-box .tips { text-align: center; margin-top: 20px; color: var(--text-muted); font-size: 12px; line-height: 1.8; }

        /* ä¸»ç•Œé¢ */
        .app-container { display: none; height: 100vh; overflow: hidden; }
        .app-container.active { display: flex; }

        /* ä¾§è¾¹æ  */
        .sidebar {
            width: 260px;
            background: var(--bg-card);
            border-right: 1px solid var(--border);
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            z-index: 50;
        }
        .sidebar::-webkit-scrollbar { width: 6px; }
        .sidebar::-webkit-scrollbar-track { background: var(--bg-input); }
        .sidebar::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 3px; }
        .sidebar::-webkit-scrollbar-thumb:hover { background: #c93550; }
        .sidebar-header { padding: 20px; border-bottom: 1px solid var(--border); }
        .sidebar-header h2 { font-size: 18px; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        .sidebar-nav { flex: 1; padding: 10px 0; }
        .nav-item {
            padding: 14px 20px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            border-left: 3px solid transparent;
            color: var(--text-muted);
            font-size: 14px;
        }
        .nav-item:hover { background: rgba(233, 69, 96, 0.1); color: var(--text); }
        .nav-item.active { background: rgba(233, 69, 96, 0.15); border-left-color: var(--primary); color: var(--text); }
        .nav-item .icon { font-size: 18px; width: 24px; text-align: center; }
        .sidebar-footer { padding: 20px; border-top: 1px solid var(--border); }
        .logout-btn { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; background: transparent; color: var(--text-muted); cursor: pointer; font-size: 14px; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .logout-btn:hover { border-color: var(--danger); color: var(--danger); background: rgba(239, 68, 68, 0.1); }

        /* ä¸»å†…å®¹ */
        .main-content { margin-left: 260px; flex: 1; padding: 24px; height: 100vh; display: flex; flex-direction: column; overflow: hidden; box-sizing: border-box; }
        .page { display: none; flex-direction: column; flex: 1; min-height: 0; overflow: hidden; }
        .page.active { display: flex; animation: fadeIn 0.3s ease; overflow-y: auto; margin-right: -8px; padding-right: 16px; }
        .page.active::-webkit-scrollbar { width: 6px; }
        .page.active::-webkit-scrollbar-track { background: var(--bg-input); border-radius: 3px; }
        .page.active::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 3px; }
        .page.active::-webkit-scrollbar-thumb:hover { background: #c93550; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* é¡µé¢å¤´éƒ¨ - å›ºå®šä¸æ»šåŠ¨ */
        .page-header { padding: 0 0 12px 0; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; position: sticky; top: 0px; background: var(--bg); z-index: 100; margin-bottom: 16px; }
        .page-header h1 { font-size: 24px; color: var(--text); display: flex; align-items: center; gap: 12px; }
        .page-header .desc { color: var(--text-muted); font-size: 14px; margin-top: 4px; }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; margin-bottom: 24px; }
        .stat-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }
        .stat-card:hover { transform: translateY(-2px); border-color: var(--primary); }
        .stat-card .icon { font-size: 28px; margin-bottom: 10px; }
        .stat-card .value { font-size: 28px; font-weight: 700; color: var(--text); margin-bottom: 4px; }
        .stat-card .label { color: var(--text-muted); font-size: 13px; }
        .stat-card .trend { font-size: 12px; margin-top: 8px; display: flex; align-items: center; gap: 4px; }
        .trend.up { color: var(--success); }
        .trend.down { color: var(--danger); }

        /* å¡ç‰‡ */
        .card { background: var(--bg-card); border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid var(--border); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--border); }
        .card-title { font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .card-title .icon { font-size: 18px; }
        .card-body { padding: 0; }

        /* å¢å¼ºç»Ÿè®¡å¡ç‰‡æ ·å¼ */
        .stat-card { display: flex; align-items: center; gap: 16px; }
        .stat-card-icon { font-size: 36px; line-height: 1; }
        .stat-card-content { flex: 1; }
        .stat-card-value { font-size: 26px; font-weight: 700; color: var(--text); line-height: 1.2; }
        .stat-card-label { font-size: 13px; color: var(--text-muted); margin-top: 2px; }

        /* ç»Ÿè®¡å¡ç‰‡é¢œè‰²å˜ä½“ */
        .stat-card-primary { background: linear-gradient(135deg, var(--primary) 0%, #ff6b6b 100%); border: none; }
        .stat-card-primary .stat-card-icon, .stat-card-primary .stat-card-value, .stat-card-primary .stat-card-label { color: #fff; }
        .stat-card-primary .stat-card-label { opacity: 0.9; }
        .stat-card-info { background: linear-gradient(135deg, #4dabf7 0%, #339af0 100%); border: none; }
        .stat-card-info .stat-card-icon, .stat-card-info .stat-card-value, .stat-card-info .stat-card-label { color: #fff; }
        .stat-card-info .stat-card-label { opacity: 0.9; }
        .stat-card-success { background: linear-gradient(135deg, #51cf66 0%, #40c057 100%); border: none; }
        .stat-card-success .stat-card-icon, .stat-card-success .stat-card-value, .stat-card-success .stat-card-label { color: #fff; }
        .stat-card-success .stat-card-label { opacity: 0.9; }
        .stat-card-warning { background: linear-gradient(135deg, #ffd43b 0%, #fab005 100%); border: none; }
        .stat-card-warning .stat-card-icon, .stat-card-warning .stat-card-value, .stat-card-warning .stat-card-label { color: #333; }
        .stat-card-warning .stat-card-label { opacity: 0.8; }

        /* å°å‹ç»Ÿè®¡é¡¹ */
        .stat-item-mini { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--bg-input); border-radius: 8px; }
        .stat-item-icon { font-size: 24px; }
        .stat-item-value { font-size: 18px; font-weight: 700; color: var(--text); }
        .stat-item-label { font-size: 12px; color: var(--text-muted); }

        /* è¡¨æ ¼ */
        .table-container { overflow-x: auto; }
        .table-container table thead { position: sticky; top: 0; z-index: 10; }
        /* æœ€è¿‘æ´»åŠ¨åˆ—è¡¨æ»šåŠ¨å®¹å™¨ */
        #activityContainer {
            max-height: 400px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) var(--bg-input);
        }
        #activityContainer::-webkit-scrollbar { width: 6px; }
        #activityContainer::-webkit-scrollbar-track { background: var(--bg-input); }
        #activityContainer::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 3px; }
        #activityContainer::-webkit-scrollbar-thumb:hover { background: #c93550; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 14px 16px; text-align: left; border-bottom: 1px solid var(--border); }
        th { color: var(--text-muted); font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; background: var(--bg-input); }
        tr:hover { background: rgba(233, 69, 96, 0.05); }
        tr:last-child td { border-bottom: none; }

        /* æŒ‰é’® */
        .btn { padding: 10px 18px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s; display: inline-flex; align-items: center; gap: 6px; }
        .btn-primary { background: var(--primary); color: #fff; }
        .btn-primary:hover { background: var(--primary-hover); }
        .btn-secondary { background: var(--bg-input); color: var(--text); border: 1px solid var(--border); }
        .btn-secondary:hover { border-color: var(--primary); }
        .btn-danger { background: var(--danger); color: #fff; }
        .btn-danger:hover { opacity: 0.9; }
        .btn-success { background: var(--success); color: #000; }
        .btn-warning { background: var(--warning); color: #000; }
        .btn-sm { padding: 6px 12px; font-size: 12px; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        /* æ–‡æœ¬æ¡†æ»šåŠ¨æ¡ */
        textarea::-webkit-scrollbar { width: 6px; }
        textarea::-webkit-scrollbar-track { background: var(--bg-input); }
        textarea::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 3px; }
        textarea::-webkit-scrollbar-thumb:hover { background: #c93550; }
        /* å›¾è¡¨åˆ‡æ¢æŒ‰é’® */
        .chart-type-toggle { display: flex; gap: 4px; }
        .chart-type-toggle .btn {
            background: var(--bg-input);
            color: var(--text-muted);
            border: 1px solid var(--border);
            padding: 5px 10px;
        }
        .chart-type-toggle .btn.active {
            background: var(--primary);
            color: #fff;
            border-color: var(--primary);
        }
        .chart-type-toggle .btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        .chart-type-toggle .btn.active:hover {
            color: #fff;
        }

        /* è¾“å…¥æ¡† */
        input, select, textarea {
            padding: 10px 14px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-input);
            color: var(--text);
            font-size: 14px;
        }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary); }
        textarea { resize: vertical; min-height: 100px; }

        /* æ ‡ç­¾ */
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 500; }
        .badge-success { background: rgba(74, 222, 128, 0.15); color: var(--success); }
        .badge-warning { background: rgba(251, 191, 36, 0.15); color: var(--warning); }
        .badge-danger { background: rgba(239, 68, 68, 0.15); color: var(--danger); }
        .badge-info { background: rgba(96, 165, 250, 0.15); color: var(--info); }
        .badge-primary { background: rgba(233, 69, 96, 0.15); color: var(--primary); }

        /* è¿›åº¦æ¡ */
        .progress { background: var(--bg-input); border-radius: 10px; height: 8px; overflow: hidden; }
        .progress-bar { background: linear-gradient(90deg, var(--primary), var(--primary-hover)); height: 100%; transition: width 0.3s; border-radius: 10px; }
        .progress-sm { height: 4px; }

        /* å¼€å…³ - æç®€ç»†é•¿æ ·å¼ */
        .switch {
            position: relative;
            display: inline-block;
            width: 36px;
            height: 20px;
            vertical-align: middle;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
            position: absolute;
        }
        .switch-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #555;
            border-radius: 20px;
            transition: 0.3s;
            opacity: 0.6;
        }
        .switch-slider:before {
            position: absolute;
            content: "";
            height: 14px;
            width: 14px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            border-radius: 50%;
            transition: 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .switch input:checked + .switch-slider {
            background-color: var(--primary, #6366f1);
            opacity: 1;
        }
        .switch input:checked + .switch-slider:before {
            transform: translateX(16px);
        }

        /* å¯¹è¯æ¡† */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(4px); }
        .modal.active { display: flex; }
        .modal-content {
            background: var(--bg-card);
            border-radius: 16px;
            width: 500px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border);
            animation: modalIn 0.3s ease;
            overflow: hidden;
        }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            background: var(--bg-card);
            position: sticky;
            top: 0;
            z-index: 1;
        }
        .modal-header h3 { font-size: 18px; display: flex; align-items: center; gap: 10px; margin: 0; }
        .modal-close { cursor: pointer; font-size: 24px; color: var(--text-muted); transition: color 0.2s; background: none; border: none; padding: 0; line-height: 1; }
        .modal-close:hover { color: var(--text); }
        .modal-body { padding: 24px; flex: 1; overflow-y: auto; }
        .modal-body::-webkit-scrollbar { width: 6px; }
        .modal-body::-webkit-scrollbar-track { background: var(--bg-input); }
        .modal-body::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 3px; }
        .modal-body::-webkit-scrollbar-thumb:hover { background: #c93550; }
        .modal-footer { padding: 16px 24px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 12px; flex-shrink: 0; background: var(--bg-card); }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 8px; color: var(--text-muted); font-size: 13px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; }

        /* è¾“å…¥æ¡†ç»„æ ·å¼ */
        .input-group { margin-bottom: 0; }
        .input-group label { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; color: var(--text-muted); font-size: 13px; font-weight: 500; }
        .input-group label i { color: var(--primary); width: 16px; text-align: center; }
        .input-group input, .input-group select {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-card);
            color: var(--text);
            font-size: 14px;
            transition: all 0.2s;
        }
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
        }
        .input-group input::placeholder { color: var(--text-muted); opacity: 0.7; }

        /* ç¾åŒ–é€‰æ‹©æ¡† */
        .select-wrapper { position: relative; }
        .select-wrapper select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            padding-right: 40px !important;
            cursor: pointer;
        }
        .select-arrow {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            pointer-events: none;
            font-size: 12px;
        }
        select option {
            padding: 12px;
            background: var(--bg-card);
            color: var(--text);
        }

        /* é…ç½®å¡ç‰‡æ ·å¼ */
        .config-card {
            background: var(--bg-input);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
        }
        .config-card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px 18px;
            background: linear-gradient(135deg, var(--primary) 0%, #2563eb 100%);
            color: white;
            font-weight: 600;
            font-size: 14px;
        }
        .config-card-body {
            padding: 18px;
        }

        /* çŠ¶æ€å¾½ç«  */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }
        .status-badge.enabled { background: var(--success); }
        .status-badge.disabled { background: var(--danger); }

        /* å¼€å…³å¡ç‰‡ */
        .toggle-card {
            background: var(--bg-input);
            border-radius: 12px;
            padding: 16px 20px;
            border: 1px solid var(--border);
        }

        /* æœç´¢æ¡† */
        .search-box { position: relative; width: 300px; }
        .search-box input { width: 100%; padding-left: 44px; }
        .search-icon { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--text-muted); }

        /* é€šçŸ¥ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 14px 24px;
            border-radius: 10px;
            z-index: 2000;
            animation: slideIn 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .notification-success { background: var(--success); color: #000; }
        .notification-error { background: var(--danger); color: #fff; }
        .notification-warning { background: var(--warning); color: #000; }
        .notification-info { background: var(--info); color: #fff; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* æ ‡ç­¾é¡µ */
        .tabs { display: flex; gap: 4px; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 0; }
        .tab { padding: 12px 20px; cursor: pointer; border: none; background: none; color: var(--text-muted); font-size: 14px; border-bottom: 2px solid transparent; margin-bottom: -1px; transition: all 0.2s; }
        .tab:hover { color: var(--text); }
        .tab.active { color: var(--primary); border-bottom-color: var(--primary); }

        /* ç©ºçŠ¶æ€ */
        .empty { text-align: center; padding: 60px 20px; color: var(--text-muted); }
        .empty .icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }
        .empty p { font-size: 14px; }

        /* æ–‡ä»¶æµè§ˆå™¨ */
        .file-browser {
            background: var(--bg-card);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
            margin-top: 16px;
        }
        /* é¢åŒ…å±‘å¯¼èˆª - æ•´åˆå¼è®¾è®¡ */
        .breadcrumb {
            padding: 6px 16px;
            background: linear-gradient(180deg, var(--bg-input) 0%, var(--bg-card) 100%);
            color: var(--text-muted);
            font-size: 13px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 4px;
            flex-wrap: wrap;
            margin-bottom: 8px;
            border-radius: 8px 8px 0 0;
        }
        .breadcrumb a {
            color: var(--primary);
            cursor: pointer;
            text-decoration: none;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        .breadcrumb a:hover {
            background: rgba(233, 69, 96, 0.1);
            text-decoration: none;
        }
        .breadcrumb .separator {
            color: var(--text-muted);
            padding: 0 2px;
        }
        .breadcrumb .current {
            color: var(--text);
            font-weight: 500;
            padding: 4px 8px;
            background: rgba(233, 69, 96, 0.08);
            border-radius: 4px;
        }
        .file-list {
            max-height: 500px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) var(--bg-input);
        }
        .file-list::-webkit-scrollbar { width: 6px; }
        .file-list::-webkit-scrollbar-track { background: var(--bg-input); }
        .file-list::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 3px; }
        .file-list::-webkit-scrollbar-thumb:hover { background: #c93550; }
        /* æ–‡ä»¶é¡¹ - å¤§å¡ç‰‡å¼è®¾è®¡ */
        .file-item {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 14px;
            cursor: pointer;
            border-bottom: 1px solid var(--border);
            transition: all 0.2s;
        }
        .file-item:last-child { border-bottom: none; }
        .file-item:hover {
            background: rgba(233, 69, 96, 0.05);
            padding-left: 20px;
        }
        .file-item.selected {
            background: rgba(233, 69, 96, 0.12);
            padding-left: 20px;
            border-left: 3px solid var(--primary);
        }
        .file-icon {
            font-size: 32px;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            flex-shrink: 0;
        }
        .file-info {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .file-name {
            font-weight: 500;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: var(--text);
        }
        .file-meta {
            color: var(--text-muted);
            font-size: 12px;
            display: flex;
            gap: 12px;
            align-items: center;
        }
        .file-meta .meta-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .file-actions {
            display: flex;
            gap: 6px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .file-item:hover .file-actions,
        .file-item.selected .file-actions {
            opacity: 1;
        }

        /* å·¥å…·æ  */
        .toolbar { display: flex; gap: 12px; margin-bottom: 16px; align-items: center; flex-wrap: wrap; }
        .toolbar-left { display: flex; gap: 12px; align-items: center; flex: 1; }
        .toolbar-right { display: flex; gap: 12px; align-items: center; }

        /* ç³»ç»Ÿèµ„æº */
        .resource-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .resource-item { background: var(--bg-input); border-radius: 12px; padding: 16px; }
        .resource-header { display: flex; justify-content: space-between; margin-bottom: 12px; }
        .resource-label { color: var(--text-muted); font-size: 13px; }
        .resource-value { font-weight: 600; }
        .resource-bar { margin-top: 8px; }

        /* ç½‘æ ¼å¸ƒå±€ */
        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        @media (max-width: 1200px) { .grid-2 { grid-template-columns: 1fr; } }

        /* ä»ªè¡¨ç›˜åº•éƒ¨è¡Œ - ä¸‹è½½è¶‹åŠ¿ä¸æœåŠ¡å™¨ä¿¡æ¯ */
        .dashboard-bottom-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }
        .trend-card { min-height: 260px; }
        .server-info-card { min-height: 260px; }
        .server-details .detail-item:last-child { border-bottom: none !important; }

        @media (max-width: 1200px) {
            .dashboard-bottom-row { grid-template-columns: 1fr; }
            .trend-card, .server-info-card { min-height: auto; }
        }

        /* ç§»åŠ¨ç«¯æ ‡é¢˜æ å†…çš„èœå•æŒ‰é’® */
        .mobile-menu-btn {
            display: none;
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 8px;
            background: var(--bg-input);
            color: var(--text);
            font-size: 18px;
            cursor: pointer;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        /* ç§»åŠ¨ç«¯é®ç½©å±‚ */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
        .sidebar-overlay.active { display: block; }

        /* å“åº”å¼ - å¹³æ¿ */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
                z-index: 1000;
                transition: transform 0.3s ease;
                width: 260px;
            }
            .sidebar.active { transform: translateX(0); }
            .main-content { margin-left: 0; padding: 24px 16px; box-sizing: border-box; }
            .mobile-menu-btn { display: flex; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .resource-grid { grid-template-columns: 1fr; }
            .page-header { gap: 12px; }
            .page-header > div { flex: 1; min-width: 0; display: flex; align-items: baseline; gap: 8px; }
            .page-header h1 { display: flex; align-items: center; gap: 8px; margin: 0; }
            .page-header .desc { font-size: 13px; margin-top: 0; }
        }

        /* å“åº”å¼ - ç§»åŠ¨ç«¯ */
        @media (max-width: 600px) {
            .main-content { padding: 16px 12px; box-sizing: border-box; width: 100%; max-width: 100vw; overflow-x: hidden; }
            .page-header { flex-direction: row; align-items: center; justify-content: flex-start; gap: 8px; width: 100%; box-sizing: border-box; }
            .page-header > div { flex: 1; min-width: 0; display: flex; align-items: baseline; gap: 8px; }
            .page-header h1 { font-size: 18px; flex: 1; min-width: 0; margin: 0; white-space: nowrap; }
            .page-header .desc { font-size: 12px; margin-top: 0; white-space: nowrap; }
            .page-header > *:not(h1):not(div) { flex-shrink: 0; }
            .stats-grid { grid-template-columns: 1fr 1fr; gap: 12px; }
            .stat-card { padding: 16px; }
            .stat-card .icon { font-size: 24px; }
            .stat-card .value { font-size: 22px; }
            .card { padding: 16px; }
            .card-header { padding-bottom: 12px; margin-bottom: 12px; }
            .card-title { font-size: 15px; }
            .toolbar { gap: 8px; }
            .toolbar-left, .toolbar-right { gap: 8px; flex-wrap: wrap; }
            .search-box { width: 100%; order: -1; }
            .search-box input { padding-left: 40px; }
            .table-container { margin: 0 -16px; }
            th, td { padding: 10px 12px; font-size: 13px; }
            .modal-content { width: 95%; max-height: 90vh; margin: 20px; }
            .modal-body { padding: 16px; }
            .modal-header { padding: 16px; }
            .modal-footer { padding: 12px 16px; }
            .dashboard-bottom-row { gap: 16px; }
            .btn { padding: 8px 14px; font-size: 13px; white-space: nowrap; }
            .btn-sm { padding: 5px 10px; font-size: 12px; }
            .input-group input, .input-group select, .input-group textarea { width: 100%; max-width: 100%; box-sizing: border-box; }
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
            .config-card, .toggle-card { width: 100%; box-sizing: border-box; max-width: 100vw; }
            .badge { font-size: 11px; padding: 3px 6px; }
            * { max-width: 100vw; }
        }

        /* å°å±å¹•ä¼˜åŒ– */
        @media (max-width: 480px) {
            .stats-grid { grid-template-columns: 1fr; }
            .stat-card { padding: 14px; }
            .stat-card .value { font-size: 20px; }
            .stat-card .label { font-size: 12px; }
        }
    </style>
</head>
<body>
    <!-- ç™»å½•é¡µ -->
    <div class="login-container" id="loginPage">
        <div class="login-box">
            <h1>ğŸ“¦ HYC</h1>
            <p class="subtitle">ä¸‹è½½ç«™ç®¡ç†æ§åˆ¶å° v2.2</p>
            <input type="text" id="loginUser" placeholder="ç”¨æˆ·å">
            <input type="password" id="loginPass" placeholder="å¯†ç ">
            <input type="text" id="loginKey" placeholder="API Key (å¯é€‰)">
            <button onclick="login()">ç™»å½•</button>
            <div class="tips">
                æ”¯æŒ Authorization Bearer / X-API-Key / Cookie è®¤è¯<br>
                API Key æ ¼å¼: hyc_xxx æˆ–ç›´æ¥è¾“å…¥å¯†é’¥
            </div>
        </div>
    </div>

    <!-- ä¸»ç•Œé¢ -->
    <div class="app-container" id="appPage">
        <!-- ç§»åŠ¨ç«¯ä¾§è¾¹æ é®ç½© -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

        <!-- ä¾§è¾¹æ  -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>ğŸ“¦ HYC ä¸‹è½½ç«™</h2>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-item active" data-page="dashboard">
                    <span class="icon">ğŸ“Š</span>
                    <span>ä»ªè¡¨ç›˜</span>
                </div>
                <div class="nav-item" data-page="files">
                    <span class="icon">ğŸ“</span>
                    <span>æ–‡ä»¶ç®¡ç†</span>
                </div>
                <div class="nav-item" data-page="sync">
                    <span class="icon">ğŸ”„</span>
                    <span>é•œåƒåŒæ­¥</span>
                </div>
                <div class="nav-item" data-page="mirrors">
                    <span class="icon">ğŸš€</span>
                    <span>åŠ é€Ÿæº</span>
                </div>
                <div class="nav-item" data-page="downloads">
                    <span class="icon">ğŸ“¥</span>
                    <span>ä¸‹è½½ç»Ÿè®¡</span>
                </div>
                <div class="nav-item" data-page="config">
                    <span class="icon">ğŸ“„</span>
                    <span>é…ç½®æ–‡ä»¶</span>
                </div>
                <div class="nav-item" data-page="settings">
                    <span class="icon">âš™ï¸</span>
                    <span>ç³»ç»Ÿè®¾ç½®</span>
                </div>
                <div class="nav-item" data-page="api-docs">
                    <span class="icon">ğŸ“š</span>
                    <span>API æ–‡æ¡£</span>
                </div>
            </nav>
            <div class="sidebar-footer">
                <button class="logout-btn" onclick="logout()">
                    <span>ğŸšª</span>
                    <span>é€€å‡ºç™»å½•</span>
                </button>
            </div>
        </aside>

        <!-- ä¸»å†…å®¹ -->
        <main class="main-content">
            <!-- ä»ªè¡¨ç›˜ -->
            <div class="page active" id="page-dashboard">
                <div class="page-header">
                    <div>
                        <h1>ğŸ“Š ç³»ç»Ÿä»ªè¡¨ç›˜</h1>
                        <p class="desc">å®æ—¶ç›‘æ§ç³»ç»ŸçŠ¶æ€</p>
                    </div>
                    <span class="badge badge-success" id="serverStatus">â— è¿è¡Œä¸­</span>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="icon">ğŸ“</div>
                        <div class="value" id="statFiles">-</div>
                        <div class="label">æ–‡ä»¶æ€»æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon">ğŸ’¾</div>
                        <div class="value" id="statStorage">-</div>
                        <div class="label">å­˜å‚¨ç©ºé—´</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon">ğŸ“¥</div>
                        <div class="value" id="statDownloads">-</div>
                        <div class="label">ä»Šæ—¥ä¸‹è½½</div>
                    </div>
                </div>

                <!-- ç³»ç»Ÿèµ„æºç›‘æ§ -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title"><span class="icon">ğŸ–¥ï¸</span>ç³»ç»Ÿèµ„æº</span>
                    </div>
                    <div class="resource-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px;">
                        <div class="resource-item">
                            <div class="resource-header">
                                <span class="resource-label">CPU ä½¿ç”¨ç‡</span>
                                <span class="resource-value" id="cpuValue">-</span>
                            </div>
                            <div class="progress" style="height: 8px; background: var(--bg-input); border-radius: 4px; overflow: hidden;">
                                <div class="progress-bar" id="cpuBar" style="width: 0%; height: 100%; transition: width 0.3s ease; background: linear-gradient(90deg, var(--primary), var(--primary-hover));"></div>
                            </div>
                        </div>
                        <div class="resource-item">
                            <div class="resource-header">
                                <span class="resource-label">å†…å­˜ä½¿ç”¨ç‡</span>
                                <span class="resource-value" id="memValue">-</span>
                            </div>
                            <div class="progress" style="height: 8px; background: var(--bg-input); border-radius: 4px; overflow: hidden;">
                                <div class="progress-bar" id="memBar" style="width: 0%; height: 100%; transition: width 0.3s ease; background: linear-gradient(90deg, var(--success), #4ade80);"></div>
                            </div>
                        </div>
                        <div class="resource-item">
                            <div class="resource-header">
                                <span class="resource-label">ç£ç›˜ä½¿ç”¨ç‡</span>
                                <span class="resource-value" id="diskValue">-</span>
                            </div>
                            <div class="progress" style="height: 8px; background: var(--bg-input); border-radius: 4px; overflow: hidden;">
                                <div class="progress-bar" id="diskBar" style="width: 0%; height: 100%; transition: width 0.3s ease; background: linear-gradient(90deg, var(--warning), #fbbf24);"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ä¸‹è½½è¶‹åŠ¿ä¸æœåŠ¡å™¨ä¿¡æ¯ -->
                <div class="dashboard-bottom-row">
                    <div class="card trend-card">
                        <div class="card-header">
                            <span class="card-title"><span class="icon">ğŸ“ˆ</span>ä¸‹è½½è¶‹åŠ¿ (è¿‘7å¤©)</span>
                        </div>
                        <div id="downloadChart" style="height: 180px; display: flex; align-items: flex-end; gap: 8px; padding: 20px 10px;">
                            <!-- å›¾è¡¨ç”± JS ç”Ÿæˆ -->
                        </div>
                    </div>

                    <div class="card server-info-card">
                        <div class="card-header">
                            <span class="card-title"><span class="icon">â„¹ï¸</span>æœåŠ¡å™¨ä¿¡æ¯</span>
                        </div>
                        <div class="server-details" style="padding: 16px 20px;">
                            <div class="detail-item" style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border-color);">
                                <span style="color: var(--text-muted);">è¿è¡Œæ—¶é—´</span>
                                <span style="font-weight: 500;" id="serverUptimeDetail">-</span>
                            </div>
                            <div class="detail-item" style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border-color);">
                                <span style="color: var(--text-muted);">åŠ é€Ÿæºæ•°é‡</span>
                                <span style="font-weight: 500;" id="mirrorCount">-</span>
                            </div>
                            <div class="detail-item" style="display: flex; justify-content: space-between; padding: 10px 0;">
                                <span style="color: var(--text-muted);">åŒæ­¥çŠ¶æ€</span>
                                <span style="font-weight: 500; color: var(--success);" id="syncStatus">æ­£å¸¸</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æœ€è¿‘æ´»åŠ¨ -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title"><span class="icon">ğŸ“‹</span>æœ€è¿‘æ´»åŠ¨</span>
                    </div>
                    <div class="table-container" id="activityContainer">
                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 160px;">æ—¶é—´</th>
                                    <th style="width: 100px;">ç±»å‹</th>
                                    <th>å†…å®¹</th>
                                    <th style="width: 100px;">çŠ¶æ€</th>
                                </tr>
                            </thead>
                            <tbody id="activityLog">
                                <tr><td colspan="4" class="empty">åŠ è½½ä¸­...</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div id="activityLoadMore" style="display: none; text-align: center; padding: 15px;">
                        <button class="btn btn-primary" onclick="loadMoreActivity()">åŠ è½½æ›´å¤š</button>
                    </div>
                    <div id="activityLoading" style="display: none; text-align: center; padding: 15px; color: var(--text-muted);">
                        <span>åŠ è½½ä¸­...</span>
                    </div>
                    <div id="activityEnd" style="display: none; text-align: center; padding: 15px; color: var(--text-muted); font-size: 12px;">
                        å·²æ˜¾ç¤ºå…¨éƒ¨è®°å½•
                    </div>
                </div>
            </div>

            <!-- æ–‡ä»¶ç®¡ç† -->
            <div class="page" id="page-files">
                <div class="page-header">
                    <div>
                        <h1>ğŸ“ æ–‡ä»¶ç®¡ç†</h1>
                        <p class="desc">æµè§ˆå’Œç®¡ç†æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶</p>
                    </div>
                </div>

                <div class="card">
                    <div class="toolbar">
                        <div class="toolbar-left">
                            <button class="btn btn-secondary btn-sm" onclick="goUp()" id="goUpBtn" style="display: none;">â¬†ï¸ è¿”å›ä¸Šçº§</button>
                            <div class="search-box">
                                <span class="search-icon">ğŸ”</span>
                                <input type="text" id="fileSearch" placeholder="æœç´¢æ–‡ä»¶..." onkeyup="searchFiles()">
                            </div>
                            <button class="btn btn-secondary btn-sm" onclick="refreshFiles()">ğŸ”„ åˆ·æ–°</button>
                        </div>
                        <div class="toolbar-right">
                            <button class="btn btn-secondary" onclick="showModal('mkdirModal')">ğŸ“ æ–°å»ºç›®å½•</button>
                            <button class="btn btn-primary" onclick="showModal('uploadModal')">ğŸ“¤ ä¸Šä¼ æ–‡ä»¶</button>
                        </div>
                    </div>

                    <div class="breadcrumb" id="fileBreadcrumb">
                        <a onclick="navigateTo('/')">æ ¹ç›®å½•</a>
                    </div>

                    <div class="file-browser">
                        <div class="file-list" id="fileList">
                            <div class="empty"><div class="icon"><i class="fa-solid fa-spinner fa-spin"></i></div><p>åŠ è½½ä¸­...</p></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- é•œåƒåŒæ­¥ -->
            <div class="page" id="page-sync">
                <div class="page-header">
                    <div>
                        <h1>ğŸ”„ é•œåƒåŒæ­¥</h1>
                        <p class="desc">ç®¡ç†é•œåƒåŒæ­¥æºå’ŒåŒæ­¥ä»»åŠ¡</p>
                    </div>
                    <button class="btn btn-primary" onclick="showModal('addSyncModal')">+ æ·»åŠ åŒæ­¥æº</button>
                </div>

                <div class="tabs">
                    <button class="tab active" onclick="switchSyncTab('sources')">åŒæ­¥æº</button>
                    <button class="tab" onclick="switchSyncTab('history')">åŒæ­¥å†å²</button>
                </div>

                <div id="sync-sources-tab">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">åŒæ­¥æºåˆ—è¡¨</span>
                            <span id="syncStatus" class="badge badge-info">ç©ºé—²</span>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>åç§°</th>
                                        <th>ç±»å‹</th>
                                        <th>ç›®æ ‡è·¯å¾„</th>
                                        <th>çŠ¶æ€</th>
                                        <th>è¿›åº¦</th>
                                        <th>åŒæ­¥æ–¹å¼</th>
                                        <th>æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody id="syncList">
                                    <tr><td colspan="7" class="empty">åŠ è½½ä¸­...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="sync-history-tab" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">åŒæ­¥å†å²è®°å½•</span>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>åŒæ­¥ID</th>
                                        <th>ç±»å‹</th>
                                        <th>çŠ¶æ€</th>
                                        <th>æ–‡ä»¶æ•°</th>
                                        <th>å¤§å°</th>
                                        <th>å¼€å§‹æ—¶é—´</th>
                                        <th>è€—æ—¶</th>
                                    </tr>
                                </thead>
                                <tbody id="syncHistory">
                                    <tr><td colspan="7" class="empty">æš‚æ— åŒæ­¥è®°å½•</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- åŠ é€Ÿæº -->
            <div class="page" id="page-mirrors">
                <div class="page-header">
                    <div>
                        <h1>ğŸš€ åŠ é€Ÿæº</h1>
                        <p class="desc">é…ç½®å’Œç®¡ç†ä¸‹è½½åŠ é€Ÿæº</p>
                    </div>
                    <button onclick="showAddMirrorModal()" class="btn btn-primary">
                        <i class="fa-solid fa-plus"></i> æ·»åŠ åŠ é€Ÿæº
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title"><i class="fa-solid fa-list"></i> åŠ é€Ÿæºåˆ—è¡¨</span>
                    </div>
                    <div id="mirrorList">
                        <div style="text-align: center; padding: 40px; color: var(--text-muted);">
                            <i class="fa-solid fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i>
                            <div>åŠ è½½ä¸­...</div>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <div class="card-header">
                        <span class="card-title">ğŸ“ ä½¿ç”¨è¯´æ˜</span>
                    </div>
                    <div id="mirrorUsageGuide" style="background: var(--bg-input); padding: 16px; border-radius: 8px; font-size: 13px; line-height: 1.8; overflow-wrap: break-word; word-break: break-all;">
                        <div style="color: var(--text-muted); text-align: center; padding: 20px;">
                            <i class="fa-solid fa-info-circle" style="font-size: 24px; margin-bottom: 10px;"></i>
                            <div>æ·»åŠ åŠ é€Ÿæºåï¼Œæ­¤å¤„å°†æ˜¾ç¤ºå¯¹åº”çš„ä½¿ç”¨å‘½ä»¤</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¸´æ—¶åŒæ­¥å¼¹çª— -->
            <div id="tempSyncModal" class="modal" style="display: none;">
                <div class="modal-content" style="max-width: 500px;">
                    <div class="modal-header">
                        <h3><i class="fa-solid fa-bolt"></i> ä¸´æ—¶å•æ¬¡åŒæ­¥</h3>
                        <button class="modal-close" onclick="document.getElementById('tempSyncModal').style.display='none'">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="input-group">
                            <label><i class="fa-solid fa-server"></i> åŒæ­¥æº</label>
                            <input type="text" id="tempSyncSource" readonly />
                        </div>
                        <div class="input-group">
                            <label><i class="fa-solid fa-box"></i> è¦åŒæ­¥çš„åŒ…å</label>
                            <textarea id="tempSyncPackages" rows="5" style="width: 100%; box-sizing: border-box;" placeholder="è¾“å…¥è¦åŒæ­¥çš„åŒ…åï¼Œå¤šä¸ªåŒ…åç”¨é€—å·æˆ–æ¢è¡Œåˆ†éš”"></textarea>
                        </div>
                        <div style="margin-top: 15px; color: var(--text-secondary); font-size: 12px;">
                            <i class="fa-solid fa-info-circle"></i> æ­¤åŠŸèƒ½åªåŒæ­¥æŒ‡å®šçš„åŒ…ï¼Œä¸ä¼šåŒæ­¥æ•´ä¸ªæº
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="document.getElementById('tempSyncModal').style.display='none'">å–æ¶ˆ</button>
                        <button class="btn btn-primary" onclick="doTempSync()">
                            <i class="fa-solid fa-bolt"></i> å¼€å§‹åŒæ­¥
                        </button>
                    </div>
                </div>
            </div>

            <!-- æ·»åŠ åŠ é€Ÿæºå¼¹çª— -->
            <div id="addMirrorModal" class="modal" style="display: none;">
                <div class="modal-content" style="max-width: 500px;">
                    <div class="modal-header">
                        <h3 id="mirrorModalTitle"><i class="fa-solid fa-plus-circle"></i> æ·»åŠ åŠ é€Ÿæº</h3>
                        <button class="modal-close" onclick="closeAddMirrorModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="input-group">
                            <label><i class="fa-solid fa-tag"></i> åŠ é€Ÿæºåç§°</label>
                            <input type="text" id="newMirrorName" placeholder="ä¾‹å¦‚: docker-mirror" />
                        </div>
                        <div class="input-group">
                            <label><i class="fa-solid fa-layer-group"></i> ç±»å‹</label>
                            <select id="newMirrorType">
                                <option value="http">ğŸŒ HTTP æ–‡ä»¶æœåŠ¡</option>
                                <option value="docker">ğŸ³ Docker Registry</option>
                                <option value="apt">ğŸ“¦ APT (Debian/Ubuntu)</option>
                                <option value="yum">ğŸ¯ YUM (CentOS/RHEL)</option>
                                <!-- Python -->
                                <option value="pypi">ğŸ PyPI (Python)</option>
                                <option value="pip">ğŸ“¦ pip</option>
                                <option value="pipenv">ğŸ¥ƒ Pipenv</option>
                                <option value="poetry">ğŸ“ Poetry</option>
                                <!-- Node.js -->
                                <option value="npm">ğŸ“¦ npm</option>
                                <option value="yarn">ğŸ§¶ Yarn</option>
                                <option value="pnpm">ğŸ“¦ pnpm</option>
                                <option value="bower">ğŸ€ Bower</option>
                                <!-- Go -->
                                <option value="go">ğŸ”· Go æ¨¡å—</option>
                                <!-- Java -->
                                <option value="maven">ğŸ«™ Maven</option>
                                <option value="gradle">ğŸ”¨ Gradle</option>
                                <!-- .NET -->
                                <option value="nuget">ğŸ“š NuGet</option>
                                <!-- Ruby -->
                                <option value="gem">ğŸ’ RubyGems</option>
                                <!-- Rust -->
                                <option value="cargo">ğŸ¦€ Cargo</option>
                                <!-- PHP -->
                                <option value="composer">ğŸ¼ Composer</option>
                                <!-- Swift/Apple -->
                                <option value="cocoapods">ğŸ CocoaPods</option>
                                <!-- C/C++ -->
                                <option value="conan">âš”ï¸ Conan</option>
                                <!-- Dart/Flutter -->
                                <option value="pub">ğŸ¯ Pub.dev</option>
                                <option value="dart">ğŸ¦ Dart SDK</option>
                                <option value="flutter">ğŸª¶ Flutter</option>
                                <!-- Haskell -->
                                <option value="hackage">ğŸ¦„ Hackage</option>
                                <option value="stackage">ğŸ“š Stackage</option>
                                <!-- OCaml -->
                                <option value="opam">ğŸ”¶ OPAM</option>
                                <!-- Dè¯­è¨€ -->
                                <option value="dub">ğŸ’  Dub</option>
                                <!-- Nim -->
                                <option value="nimble">âš¡ Nimble</option>
                                <!-- Julia -->
                                <option value="julia">ğŸ”¬ Julia</option>
                                <!-- Lua -->
                                <option value="lua">ğŸŒ™ Lua</option>
                                <option value="luarocks">ğŸŒ™ LuaRocks</option>
                                <!-- Elm -->
                                <option value="elm">ğŸŒ³ Elm</option>
                                <!-- V -->
                                <option value="v">V Vè¯­è¨€</option>
                                <!-- Helm -->
                                <option value="helm">âš“ Helm Charts</option>
                                <!-- R -->
                                <option value="cran">ğŸ“Š CRAN</option>
                                <!-- LaTeX -->
                                <option value="ctan">ğŸ“ CTAN</option>
                                <!-- CUDA -->
                                <option value="cuda">ğŸ® CUDA</option>
                                <!-- Linux å‘è¡Œç‰ˆ -->
                                <option value="alpine">ğŸ”ï¸ Alpine</option>
                                <option value="arch">ğŸ”µ Arch</option>
                                <option value="aur">ğŸ“¦ AUR</option>
                                <option value="centos">ğŸ¯ CentOS</option>
                                <option value="debian">ğŸ± Debian</option>
                                <option value="fedora">ğŸ© Fedora</option>
                                <option value="gentoo">ğŸ§¬ Gentoo</option>
                                <option value="opensuse">ğŸ¦ openSUSE</option>
                                <option value="void">â° Void</option>
                                <option value="freebsd">ğŸ¦… FreeBSD</option>
                                <option value="netbsd">ğŸŒ NetBSD</option>
                                <option value="openbsd">ğŸ¡ OpenBSD</option>
                                <option value="rocky">ğŸª¨ Rocky Linux</option>
                                <option value="alma">ğŸ”” AlmaLinux</option>
                                <option value="kali">ğŸ”ª Kali Linux</option>
                                <option value="ubuntu">ğŸŸ  Ubuntu</option>
                                <option value="mint">ğŸŒ¿ Linux Mint</option>
                                <!-- å¼€å‘å·¥å…· -->
                                <option value="jetbrains">ğŸ’œ JetBrains</option>
                                <option value="vscode">ğŸ’™ VS Code</option>
                                <!-- è¯­è¨€è¿è¡Œæ—¶ -->
                                <option value="rustup">ğŸ¦€ Rustup</option>
                                <option value="dotnet">ğŸ”· .NET SDK</option>
                                <option value="node">ğŸŸ¢ Node.js</option>
                                <option value="python">ğŸ Python</option>
                                <option value="ruby">ğŸ’ Ruby</option>
                                <option value="php">ğŸ˜ PHP</option>
                                <!-- ç³»ç»ŸåŒ…ç®¡ç†å™¨ -->
                                <option value="homebrew">ğŸº Homebrew</option>
                                <option value="brew">ğŸº Brew</option>
                                <option value="chocolatey">ğŸ« Chocolatey</option>
                                <option value="snap">ğŸ“¦ Snap</option>
                                <option value="flatpak">ğŸ“¦ Flatpak</option>
                                <option value="winget">ğŸªŸ winget</option>
                                <option value="scoop">ğŸ¥„ Scoop</option>
                                <!-- å…¶ä»– -->
                                <option value="termux">ğŸ“± Termux</option>
                                <option value="msys2">ğŸ’» MSYS2</option>
                                <option value="nix">â„ï¸ Nix</option>
                                <option value="guix">ğŸŒ¿ Guix</option>
                                <option value="custom">âœ¨ è‡ªå®šä¹‰</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label><i class="fa-solid fa-link"></i> ä¸Šæ¸¸åœ°å€</label>
                            <input type="text" id="newMirrorUrl" placeholder="ä¾‹å¦‚: https://mirror.example.com" />
                        </div>
                        <div class="input-group">
                            <label><i class="fa-solid fa-bullseye"></i> ç›®æ ‡è·¯å¾„ (å¯é€‰)</label>
                            <input type="text" id="newMirrorTarget" placeholder="ä¾‹å¦‚: docker, apt/ubuntu" />
                        </div>
                        <div class="input-group">
                            <label><i class="fa-solid fa-folder"></i> å­˜å‚¨ç›®å½• (å¯é€‰)</label>
                            <input type="text" id="newMirrorStorageDir" placeholder="ä¾‹å¦‚: docker-cn, pypi-cn (é»˜è®¤: é•œåƒåç§°)" />
                        </div>
                        <div class="input-group">
                            <label><i class="fa-solid fa-pen-to-square"></i> æè¿° (å¯é€‰)</label>
                            <input type="text" id="newMirrorDesc" placeholder="æè¿°è¿™ä¸ªåŠ é€Ÿæºçš„ç”¨é€”" />
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--bg-input); border-radius: 8px;">
                            <input type="checkbox" id="newMirrorEnabled" checked />
                            <span>å¯ç”¨æ­¤åŠ é€Ÿæº</span>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button onclick="closeAddMirrorModal()" class="btn btn-secondary">å–æ¶ˆ</button>
                        <button onclick="addMirror()" id="mirrorModalBtn" class="btn btn-primary">æ·»åŠ </button>
                    </div>
                </div>
            </div>

            <!-- é…ç½®æ–‡ä»¶ -->
            <div class="page" id="page-config">
                <div class="page-header">
                    <div>
                        <h1>ğŸ“„ é…ç½®æ–‡ä»¶</h1>
                        <p class="desc">æŸ¥çœ‹å’Œç¼–è¾‘æœåŠ¡å™¨é…ç½®æ–‡ä»¶</p>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="reloadConfig()" class="btn btn-secondary">ğŸ”„ é‡æ–°åŠ è½½</button>
                        <button onclick="saveConfig()" class="btn btn-primary">ğŸ’¾ ä¿å­˜é…ç½®</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">settings.json</span>
                        <span id="configPath" style="color: var(--text-muted); font-size: 12px;"></span>
                    </div>
                    <div style="position: relative;">
                        <textarea id="configEditor" style="width: 100%; min-height: 500px; max-height: 70vh; background: var(--bg-input); border: 1px solid var(--border); border-radius: 8px; padding: 16px; color: var(--text); font-family: 'Monaco', 'Menlo', 'Consolas', monospace; font-size: 13px; line-height: 1.6; resize: vertical; overflow-y: auto;" placeholder="åŠ è½½é…ç½®ä¸­..."></textarea>
                        <div id="configJsonError" style="position: absolute; bottom: 10px; right: 10px; background: var(--danger); color: white; padding: 8px 12px; border-radius: 6px; font-size: 12px; display: none;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 12px;">
                        <span id="configStatus" style="color: var(--text-muted); font-size: 12px;"></span>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="formatConfig()" class="btn btn-secondary" style="padding: 8px 16px;">ğŸ“ æ ¼å¼åŒ–</button>
                            <button onclick="resetConfig()" class="btn btn-warning" style="padding: 8px 16px;">ğŸ”„ é‡ç½®</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">ğŸ“‹ é…ç½®è¯´æ˜</span>
                    </div>
                    <div style="background: var(--bg-input); padding: 16px; border-radius: 8px; font-size: 13px; line-height: 1.8;">
                        <div style="margin-bottom: 12px;">
                            <strong style="color: var(--info);">mirrors</strong> - åŠ é€Ÿæºé…ç½®<br>
                            <code style="color: var(--text-muted);">"enabled": true/false</code> - å¯ç”¨æˆ–ç¦ç”¨è¯¥åŠ é€Ÿæº
                        </div>
                        <div style="margin-bottom: 12px;">
                            <strong style="color: var(--info);">è‡ªå®šä¹‰åŠ é€Ÿæº</strong><br>
                            æ·»åŠ è‡ªå®šä¹‰é•œåƒæºï¼Œæ”¯æŒ HTTPã€Git ç­‰ç±»å‹
                        </div>
                        <div>
                            <strong style="color: var(--warning);">æ³¨æ„ï¼š</strong>ä¿å­˜åéœ€è¦ç‚¹å‡»"é‡æ–°åŠ è½½"æˆ–é‡å¯æœåŠ¡å™¨ä½¿é…ç½®ç”Ÿæ•ˆ
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¸‹è½½ç»Ÿè®¡ -->
            <div class="page" id="page-downloads">
                <div class="page-header">
                    <div>
                        <h1>ğŸ“¥ ä¸‹è½½ç»Ÿè®¡</h1>
                        <p class="desc">ä¸‹è½½é‡å’Œæµé‡ç»Ÿè®¡</p>
                    </div>
                </div>

                <!-- æ ¸å¿ƒæŒ‡æ ‡åŒº - 2è¡Œ4åˆ— -->
                <div class="stats-grid" style="grid-template-columns: repeat(4, 1fr);">
                    <div class="stat-card stat-card-primary">
                        <div class="stat-card-icon">ğŸ“¥</div>
                        <div class="stat-card-content">
                            <div class="stat-card-value" id="todayDl">-</div>
                            <div class="stat-card-label">ä»Šæ—¥ä¸‹è½½</div>
                        </div>
                    </div>
                    <div class="stat-card stat-card-info">
                        <div class="stat-card-icon">ğŸ“…</div>
                        <div class="stat-card-content">
                            <div class="stat-card-value" id="weekDl">-</div>
                            <div class="stat-card-label">æœ¬å‘¨ä¸‹è½½</div>
                        </div>
                    </div>
                    <div class="stat-card stat-card-warning">
                        <div class="stat-card-icon">ğŸ“†</div>
                        <div class="stat-card-content">
                            <div class="stat-card-value" id="yearDl">-</div>
                            <div class="stat-card-label">ä»Šå¹´ä¸‹è½½</div>
                        </div>
                    </div>
                    <div class="stat-card stat-card-warning">
                        <div class="stat-card-icon">ğŸ“Š</div>
                        <div class="stat-card-content">
                            <div class="stat-card-value" id="totalDl">-</div>
                            <div class="stat-card-label">ç´¯è®¡ä¸‹è½½</div>
                        </div>
                    </div>
                </div>

                <!-- å›¾è¡¨åŒºåŸŸ -->
                <div class="card" style="margin-top: 20px;">
                    <div class="card-header">
                        <span class="card-title">ğŸ“Š ä¸‹è½½è¶‹åŠ¿åˆ†æ</span>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <!-- æ—¶é—´ç²’åº¦é€‰æ‹© -->
                            <select id="periodSelect" onchange="changePeriod()" style="padding: 6px 12px; border-radius: 6px; background: var(--bg-input); color: var(--text); border: 1px solid var(--border);">
                                <option value="year" selected>æŒ‰å¹´ç»Ÿè®¡</option>
                                <option value="month">æŒ‰æœˆç»Ÿè®¡</option>
                            </select>
                            <!-- å¹´ä»½é€‰æ‹© -->
                            <select id="yearSelect" onchange="changePeriod()" style="padding: 6px 12px; border-radius: 6px; background: var(--bg-input); color: var(--text); border: 1px solid var(--border);">
                            </select>
                            <!-- æœˆä»½é€‰æ‹© -->
                            <select id="monthSelect" onchange="changePeriod()" style="padding: 6px 12px; border-radius: 6px; background: var(--bg-input); color: var(--text); border: 1px solid var(--border);">
                            </select>
                            <!-- å›¾è¡¨ç±»å‹åˆ‡æ¢ -->
                            <div class="chart-type-toggle">
                                <button class="btn btn-sm" id="lineChartBtn" onclick="switchChartType('line')" title="æŠ˜çº¿å›¾">
                                    <i class="fas fa-chart-line"></i>
                                </button>
                                <button class="btn btn-sm" id="barChartBtn" onclick="switchChartType('bar')" title="æŸ±çŠ¶å›¾">
                                    <i class="fas fa-chart-bar"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div style="padding: 20px;">
                        <canvas id="downloadChartCanvas" height="100"></canvas>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">ä¸‹è½½æ’è¡Œ TOP 20</span>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 60px; text-align: center;">æ’å</th>
                                    <th>æ–‡ä»¶</th>
                                    <th style="width: 100px; text-align: center;">ä¸‹è½½æ¬¡æ•°</th>
                                    <th style="width: 100px; text-align: center;">å¤§å°</th>
                                    <th style="width: 120px; text-align: center;">å æ¯”</th>
                                </tr>
                            </thead>
                            <tbody id="downloadRank">
                                <tr><td colspan="5" class="empty">åŠ è½½ä¸­...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ç³»ç»Ÿè®¾ç½® -->
            <div class="page" id="page-settings">
                <div class="page-header">
                    <div>
                        <h1>âš™ï¸ ç³»ç»Ÿè®¾ç½®</h1>
                        <p class="desc">ç³»ç»Ÿé…ç½®å’Œå®‰å…¨ç®¡ç†</p>
                    </div>
                    <button class="btn btn-primary" onclick="saveSettings()">ğŸ’¾ ä¿å­˜è®¾ç½®</button>
                </div>

                <div class="tabs">
                    <button class="tab active" onclick="switchSettingsTab('security')">å®‰å…¨</button>
                    <button class="tab" onclick="switchSettingsTab('storage')">å­˜å‚¨</button>
                    <button class="tab" onclick="switchSettingsTab('sync')">åŒæ­¥</button>
                    <button class="tab" onclick="switchSettingsTab('features')">åŠŸèƒ½</button>
                    <button class="tab" onclick="switchSettingsTab('performance')">æ€§èƒ½</button>
                    <button class="tab" onclick="switchSettingsTab('log')">æ—¥å¿—</button>
                    <button class="tab" onclick="switchSettingsTab('alerts')">å‘Šè­¦</button>
                </div>

                <div id="settings-security">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">â„¹ï¸ æœåŠ¡å™¨ä¿¡æ¯</span>
                        </div>
                        <div class="stats-grid" style="margin-bottom: 0;">
                            <div class="stat-card">
                                <div class="icon">â±ï¸</div>
                                <div class="value" id="serverUptime">-</div>
                                <div class="label">è¿è¡Œæ—¶é—´</div>
                            </div>
                            <div class="stat-card">
                                <div class="icon">ğŸ“Š</div>
                                <div class="value" id="serverVersion">-</div>
                                <div class="label">ç‰ˆæœ¬</div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ”’ IP è®¿é—®æ§åˆ¶</span>
                        </div>
                        <div class="form-group">
                            <label>IP ç™½åå• (æ¯è¡Œä¸€ä¸ªï¼Œæ”¯æŒ CIDR)</label>
                            <textarea id="ipWhitelist" rows="5" placeholder="127.0.0.1&#10;192.168.1.0/24&#10;10.0.0.0/8"></textarea>
                        </div>
                        <div class="form-group">
                            <label>IP é»‘åå• (æ¯è¡Œä¸€ä¸ª)</label>
                            <textarea id="ipBlacklist" rows="5" placeholder="1.2.3.4&#10;5.6.7.8"></textarea>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">âš¡ é€Ÿç‡é™åˆ¶</span>
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>è¯·æ±‚é€Ÿç‡é™åˆ¶ (è¯·æ±‚/åˆ†é’Ÿ)</label>
                            <input type="number" id="rateLimit" value="100">
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ” è®¤è¯è®¾ç½®</span>
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>è®¤è¯æ–¹å¼</label>
                            <select id="authType">
                                <option value="none">æ— è®¤è¯</option>
                                <option value="basic">Basic Auth</option>
                                <option value="token">Token</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ä¼šè¯è¶…æ—¶æ—¶é—´ (åˆ†é’Ÿ)</label>
                            <input type="number" id="sessionTimeout" value="60" style="max-width: 300px;">
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ”‘ ä¿®æ”¹å¯†ç </span>
                        </div>
                        <div class="form-group">
                            <label>ç”¨æˆ·å</label>
                            <input type="text" id="changePasswordUsername" placeholder="admin" style="max-width: 300px;">
                        </div>
                        <div class="form-group">
                            <label>åŸå¯†ç  (å¯é€‰ï¼Œä¸å¡«åˆ™å¼ºåˆ¶ä¿®æ”¹)</label>
                            <input type="password" id="changePasswordOld" placeholder="è¾“å…¥åŸå¯†ç " style="max-width: 300px;">
                        </div>
                        <div class="form-group">
                            <label>æ–°å¯†ç </label>
                            <input type="password" id="changePasswordNew" placeholder="è¾“å…¥æ–°å¯†ç " style="max-width: 300px;">
                        </div>
                        <div class="form-group">
                            <label>ç¡®è®¤æ–°å¯†ç </label>
                            <input type="password" id="changePasswordConfirm" placeholder="å†æ¬¡è¾“å…¥æ–°å¯†ç " style="max-width: 300px;">
                        </div>
                        <button class="btn btn-primary" onclick="changePassword()">
                            <i class="fa-solid fa-key"></i> ä¿®æ”¹å¯†ç 
                        </button>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ“‹ ç™»å½•æ—¥å¿—</span>
                            <button class="btn btn-sm" onclick="loadLoginLogs()">
                                <i class="fa-solid fa-refresh"></i> åˆ·æ–°
                            </button>
                        </div>
                        <div class="table-container" style="max-height: 300px; overflow-y: auto;">
                            <table>
                                <thead>
                                    <tr>
                                        <th>æ—¶é—´</th>
                                        <th>ç”¨æˆ·å</th>
                                        <th>çŠ¶æ€</th>
                                        <th>IP</th>
                                        <th>åŸå› </th>
                                    </tr>
                                </thead>
                                <tbody id="loginLogsTable">
                                    <tr><td colspan="5" class="empty">ç‚¹å‡»åˆ·æ–°åŠ è½½æ—¥å¿—</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="settings-storage" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ–¥ï¸ æœåŠ¡å™¨é…ç½®</span>
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>æœåŠ¡å™¨åç§°</label>
                            <input type="text" id="serverName" placeholder="HYCä¸‹è½½ç«™">
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>ç›‘å¬åœ°å€</label>
                            <input type="text" id="serverHost" placeholder="0.0.0.0">
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>ç›‘å¬ç«¯å£</label>
                            <input type="number" id="serverPort" value="8080">
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>API ç‰ˆæœ¬</label>
                            <select id="apiVersion">
                                <option value="v1">v1 (åŸºç¡€)</option>
                                <option value="v2">v2 (å¢å¼º)</option>
                            </select>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ“ å­˜å‚¨é…ç½®</span>
                        </div>
                        <div class="form-group">
                            <label>æ–‡ä»¶å­˜å‚¨ç›®å½•</label>
                            <input type="text" id="storagePath" placeholder="./downloads">
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>æ’åºæ–¹å¼</label>
                            <select id="sortBy">
                                <option value="name">åç§°</option>
                                <option value="size">å¤§å°</option>
                                <option value="time">æ—¶é—´</option>
                            </select>
                        </div>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; margin-top: 12px;">
                            <input type="checkbox" id="sortReverse">
                            <span>åå‘æ’åº</span>
                        </label>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ—„ï¸ æ•°æ®åº“é…ç½®</span>
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>æ•°æ®åº“ç±»å‹</label>
                            <select id="dbType" onchange="switchDbType()">
                                <option value="sqlite">SQLite</option>
                                <option value="postgresql">PostgreSQL</option>
                                <option value="mysql">MySQL</option>
                            </select>
                        </div>

                        <!-- SQLite é…ç½® -->
                        <div id="db-sqlite-config">
                            <div class="form-group">
                                <label>æ•°æ®åº“æ–‡ä»¶è·¯å¾„</label>
                                <input type="text" id="dbPath" placeholder="./data/hyc.db">
                            </div>
                        </div>

                        <!-- PostgreSQL é…ç½® -->
                        <div id="db-postgresql-config" style="display: none;">
                            <div class="form-group" style="max-width: 300px;">
                                <label>ä¸»æœº</label>
                                <input type="text" id="dbHost" placeholder="localhost">
                            </div>
                            <div class="form-group" style="max-width: 300px;">
                                <label>ç«¯å£</label>
                                <input type="number" id="dbPort" value="5432">
                            </div>
                            <div class="form-group" style="max-width: 300px;">
                                <label>ç”¨æˆ·</label>
                                <input type="text" id="dbUser" placeholder="postgres">
                            </div>
                            <div class="form-group" style="max-width: 300px;">
                                <label>å¯†ç </label>
                                <input type="password" id="dbPassword" placeholder="æ•°æ®åº“å¯†ç ">
                            </div>
                            <div class="form-group" style="max-width: 300px;">
                                <label>æ•°æ®åº“åç§°</label>
                                <input type="text" id="dbName" placeholder="hyc">
                            </div>
                        </div>

                        <!-- MySQL é…ç½® -->
                        <div id="db-mysql-config" style="display: none;">
                            <div class="form-group" style="max-width: 300px;">
                                <label>ä¸»æœº</label>
                                <input type="text" id="mysqlHost" placeholder="localhost">
                            </div>
                            <div class="form-group" style="max-width: 300px;">
                                <label>ç«¯å£</label>
                                <input type="number" id="mysqlPort" value="3306">
                            </div>
                            <div class="form-group" style="max-width: 300px;">
                                <label>ç”¨æˆ·</label>
                                <input type="text" id="mysqlUser" placeholder="root">
                            </div>
                            <div class="form-group" style="max-width: 300px;">
                                <label>å¯†ç </label>
                                <input type="password" id="mysqlPassword" placeholder="æ•°æ®åº“å¯†ç ">
                            </div>
                            <div class="form-group" style="max-width: 300px;">
                                <label>æ•°æ®åº“åç§°</label>
                                <input type="text" id="mysqlName" placeholder="hyc">
                            </div>
                        </div>
                    </div>
                </div>

                <div id="settings-sync" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ”„ åŒæ­¥é…ç½®</span>
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>è‡ªåŠ¨åŒæ­¥é—´éš” (åˆ†é’Ÿ)</label>
                            <input type="number" id="syncInterval" value="60">
                        </div>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="autoSync">
                            <span>å¯ç”¨è‡ªåŠ¨åŒæ­¥</span>
                        </label>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ§¹ è‡ªåŠ¨æ¸…ç†</span>
                        </div>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="autoClean">
                            <span>å¯ç”¨è‡ªåŠ¨æ¸…ç†</span>
                        </label>
                        <div class="form-group" style="max-width: 300px; margin-top: 12px;">
                            <label>æ¸…ç†é—´éš” (å¤©)</label>
                            <input type="number" id="cleanInterval" value="7">
                        </div>
                    </div>
                </div>

                <div id="settings-features" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ“‚ æ–‡ä»¶æµè§ˆ</span>
                        </div>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="enableBrowse" checked>
                            <span>å¯ç”¨ç›®å½•æµè§ˆ</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; margin-top: 12px;">
                            <input type="checkbox" id="showHidden">
                            <span>æ˜¾ç¤ºéšè—æ–‡ä»¶</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; margin-top: 12px;">
                            <input type="checkbox" id="showHash" checked>
                            <span>æ˜¾ç¤ºæ–‡ä»¶å“ˆå¸Œ</span>
                        </label>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ”Œ å®æ—¶é€šä¿¡</span>
                        </div>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="enableWebSocket" checked>
                            <span>å¯ç”¨ WebSocket</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; margin-top: 12px;">
                            <input type="checkbox" id="enableSSE" checked>
                            <span>å¯ç”¨ SSE</span>
                        </label>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ“Š ç›‘æ§</span>
                        </div>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="enableMonitor" checked>
                            <span>å¯ç”¨ç›‘æ§</span>
                        </label>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ” æœç´¢è®¾ç½®</span>
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>æœ€å¤§æœç´¢ç»“æœæ•°</label>
                            <input type="number" id="maxSearchResults" value="100">
                        </div>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; margin-top: 12px;">
                            <input type="checkbox" id="calculateHash">
                            <span>è®¡ç®—æ–‡ä»¶å“ˆå¸Œ</span>
                        </label>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ” SSL/HTTPS è®¾ç½®</span>
                        </div>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="enableSSL">
                            <span>å¯ç”¨ SSL/HTTPS</span>
                        </label>
                        <div class="form-group" style="max-width: 500px; margin-top: 12px;">
                            <label>SSL è¯ä¹¦è·¯å¾„</label>
                            <input type="text" id="sslCert" placeholder="/path/to/cert.pem">
                        </div>
                        <div class="form-group" style="max-width: 500px;">
                            <label>SSL å¯†é’¥è·¯å¾„</label>
                            <input type="text" id="sslKey" placeholder="/path/to/key.pem">
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">â¤ï¸ å¥åº·æ£€æŸ¥</span>
                        </div>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="enableHealthCheck">
                            <span>å¯ç”¨å¥åº·æ£€æŸ¥</span>
                        </label>
                        <div class="form-group" style="max-width: 300px; margin-top: 12px;">
                            <label>å¥åº·æ£€æŸ¥é—´éš” (ç§’)</label>
                            <input type="number" id="healthCheckInterval" value="60">
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>è¶…æ—¶æ—¶é—´ (ç§’)</label>
                            <input type="number" id="healthCheckTimeout" value="10">
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>æœ€å¤§é‡è¯•æ¬¡æ•°</label>
                            <input type="number" id="healthCheckRetries" value="3">
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">âš¡ æ•…éšœè½¬ç§»</span>
                        </div>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="enableFailover">
                            <span>å¯ç”¨æ•…éšœè½¬ç§»</span>
                        </label>
                        <div class="form-group" style="max-width: 300px; margin-top: 12px;">
                            <label>æ•…éšœé˜ˆå€¼ (æ¬¡)</label>
                            <input type="number" id="failoverThreshold" value="3">
                        </div>
                    </div>
                </div>

                <div id="settings-performance" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">âš™ï¸ çº¿ç¨‹ä¸ç›‘æ§</span>
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>æœ€å¤§çº¿ç¨‹æ•°</label>
                            <input type="number" id="maxThreads" value="4">
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>ç›‘æ§é—´éš” (ç§’)</label>
                            <input type="number" id="monitorInterval" value="3">
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>å¥åº·æ£€æŸ¥é—´éš” (ç§’)</label>
                            <input type="number" id="healthInterval" value="30">
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ“ æ–‡ä»¶ä¸Šä¼ </span>
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>æœ€å¤§ä¸Šä¼ å¤§å° (MB)</label>
                            <input type="number" id="maxUploadSize" value="1024">
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>è¯·æ±‚è¶…æ—¶ (ç§’)</label>
                            <input type="number" id="requestTimeout" value="300">
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ§µ è¿æ¥æ± é…ç½®</span>
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>è¿æ¥æ± å¤§å°</label>
                            <input type="number" id="poolSize" value="5">
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>æœ€å¤§æº¢å‡ºè¿æ¥</label>
                            <input type="number" id="maxOverflow" value="10">
                        </div>
                    </div>
                </div>

                <div id="settings-log" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ” è°ƒè¯•æ¨¡å¼</span>
                        </div>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="debugMode">
                            <span>å¯ç”¨è°ƒè¯•æ¨¡å¼</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; margin-top: 12px;">
                            <input type="checkbox" id="debugHttp">
                            <span>è°ƒè¯• HTTP è¯·æ±‚</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; margin-top: 12px;">
                            <input type="checkbox" id="debugAuth">
                            <span>è°ƒè¯•è®¤è¯</span>
                        </label>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ“ æ—¥å¿—é…ç½®</span>
                        </div>
                        <div class="form-group">
                            <label>æ—¥å¿—æ–‡ä»¶è·¯å¾„</label>
                            <input type="text" id="logFile" placeholder="./logs/hyc.log">
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>æ—¥å¿—çº§åˆ«</label>
                            <select id="logLevel">
                                <option value="DEBUG">DEBUG</option>
                                <option value="INFO">INFO</option>
                                <option value="WARNING">WARNING</option>
                                <option value="ERROR">ERROR</option>
                            </select>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ›¡ï¸ å®‰å…¨é€‰é¡¹</span>
                        </div>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="enableRange" checked>
                            <span>å¯ç”¨ HTTP Range è¯·æ±‚ (æ–­ç‚¹ç»­ä¼ )</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; margin-top: 12px;">
                            <input type="checkbox" id="enableStats" checked>
                            <span>å¯ç”¨ç»Ÿè®¡</span>
                        </label>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ“¦ ç¼“å­˜é…ç½®</span>
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>ç¼“å­˜å¤§å° (MB)</label>
                            <input type="number" id="cacheSize" value="1024">
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>ç¼“å­˜ TTL (ç§’)</label>
                            <input type="number" id="cacheTTL" value="3600">
                        </div>
                    </div>
                </div>

                <div id="settings-alerts" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ”” å‘Šè­¦è®¾ç½®</span>
                        </div>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="enableAlerts" checked>
                            <span>å¯ç”¨å‘Šè­¦</span>
                        </label>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ’¾ ç£ç›˜å‘Šè­¦</span>
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>ç£ç›˜ä½¿ç”¨ç‡è­¦å‘Šé˜ˆå€¼ (%)</label>
                            <input type="number" id="diskWarning" value="80">
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>ç£ç›˜ä½¿ç”¨ç‡ä¸¥é‡é˜ˆå€¼ (%)</label>
                            <input type="number" id="diskCritical" value="90">
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ“§ é‚®ä»¶é€šçŸ¥</span>
                        </div>
                        <div class="form-group">
                            <label>SMTP æœåŠ¡å™¨</label>
                            <input type="text" id="smtpServer" placeholder="smtp.example.com">
                        </div>
                        <div class="form-group" style="max-width: 300px;">
                            <label>SMTP ç«¯å£</label>
                            <input type="number" id="smtpPort" value="587">
                        </div>
                        <div class="form-group">
                            <label>å‘é€é‚®ç®±</label>
                            <input type="email" id="smtpFrom" placeholder="noreply@example.com">
                        </div>
                        <div class="form-group">
                            <label>æ”¶ä»¶äººé‚®ç®±</label>
                            <input type="email" id="alertEmail" placeholder="admin@example.com">
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ”— Webhook é€šçŸ¥</span>
                        </div>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="enableWebhook">
                            <span>å¯ç”¨ Webhook</span>
                        </label>
                        <div class="form-group" style="max-width: 500px; margin-top: 12px;">
                            <label>Webhook URL</label>
                            <input type="url" id="webhookUrl" placeholder="https://example.com/webhook">
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">ğŸ“‹ å®šæ—¶ä»»åŠ¡</span>
                        </div>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="enableCleanupTask">
                            <span>å¯ç”¨æ•°æ®åº“æ¸…ç†ä»»åŠ¡</span>
                        </label>
                        <div class="form-group" style="max-width: 300px; margin-top: 12px;">
                            <label>æ¸…ç†ä»»åŠ¡ Cron è¡¨è¾¾å¼</label>
                            <input type="text" id="cleanupCron" placeholder="0 2 * * *" value="0 2 * * *">
                        </div>
                    </div>
                </div>
            </div>

            <!-- API æ–‡æ¡£ -->
            <div class="page" id="page-api-docs">
                <div class="page-header">
                    <div>
                        <h1>ğŸ“š API æ–‡æ¡£</h1>
                        <p class="desc">æ¥å£è°ƒç”¨è¯´æ˜</p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">ğŸ”‘ è®¤è¯æ–¹å¼</span>
                    </div>
                    <pre style="background: var(--bg-input); padding: 16px; border-radius: 8px; overflow-x: auto; font-size: 13px; line-height: 1.8;">
# 1. Bearer Token
Authorization: Bearer YOUR_API_KEY

# 2. API Key Header (æ¨è)
X-API-Key: YOUR_API_KEY

# 3. Cookie
Cookie: hyc_auth=SESSION_ID

# 4. Query Parameter
?key=YOUR_API_KEY</pre>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">ğŸ“ æ–‡ä»¶ API</span>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr><th>æ–¹æ³•</th><th>è·¯å¾„</th><th>è¯´æ˜</th><th>è®¤è¯</th></tr>
                            </thead>
                            <tbody>
                                <tr><td><span class="badge badge-info">GET</span></td><td>/api/v1/files</td><td>åˆ—å‡ºæ–‡ä»¶</td><td>-</td></tr>
                                <tr><td><span class="badge badge-info">GET</span></td><td>/api/v1/file/*</td><td>è·å–æ–‡ä»¶ä¿¡æ¯</td><td>-</td></tr>
                                <tr><td><span class="badge badge-info">GET</span></td><td>/api/v1/file/*/preview</td><td>é¢„è§ˆæ–‡ä»¶</td><td>-</td></tr>
                                <tr><td><span class="badge badge-danger">DELETE</span></td><td>/api/v1/file/*</td><td>åˆ é™¤æ–‡ä»¶</td><td>admin</td></tr>
                                <tr><td><span class="badge badge-warning">PUT</span></td><td>/api/v1/mkdir</td><td>åˆ›å»ºç›®å½•</td><td>admin</td></tr>
                                <tr><td><span class="badge badge-warning">PUT</span></td><td>/api/v1/file/rename</td><td>é‡å‘½åæ–‡ä»¶</td><td>admin</td></tr>
                                <tr><td><span class="badge badge-primary">POST</span></td><td>/api/v1/upload</td><td>ä¸Šä¼ æ–‡ä»¶</td><td>admin</td></tr>
                                <tr><td><span class="badge badge-primary">POST</span></td><td>/api/v1/batch</td><td>æ‰¹é‡æ“ä½œ</td><td>admin</td></tr>
                                <tr><td><span class="badge badge-info">GET</span></td><td>/api/v1/search</td><td>æœç´¢æ–‡ä»¶</td><td>-</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">ğŸ”„ åŒæ­¥ API</span>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr><th>æ–¹æ³•</th><th>è·¯å¾„</th><th>è¯´æ˜</th></tr>
                            </thead>
                            <tbody>
                                <tr><td><span class="badge badge-info">GET</span></td><td>/api/v1/sync/sources</td><td>è·å–åŒæ­¥æº</td></tr>
                                <tr><td><span class="badge badge-primary">POST</span></td><td>/api/v1/sync/sources</td><td>æ·»åŠ åŒæ­¥æº</td></tr>
                                <tr><td><span class="badge badge-danger">DELETE</span></td><td>/api/v1/sync/sources/{name}</td><td>åˆ é™¤åŒæ­¥æº</td></tr>
                                <tr><td><span class="badge badge-primary">POST</span></td><td>/api/v1/sync/start</td><td>å¼€å§‹åŒæ­¥</td></tr>
                                <tr><td><span class="badge badge-warning">POST</span></td><td>/api/v1/sync/stop</td><td>åœæ­¢åŒæ­¥</td></tr>
                                <tr><td><span class="badge badge-info">GET</span></td><td>/api/v1/sync/status</td><td>è·å–çŠ¶æ€</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">ğŸš€ åŠ é€Ÿæº API</span>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr><th>æ–¹æ³•</th><th>è·¯å¾„</th><th>è¯´æ˜</th></tr>
                            </thead>
                            <tbody>
                                <tr><td><span class="badge badge-info">GET</span></td><td>/api/v2/mirrors</td><td>è·å–é•œåƒåˆ—è¡¨</td></tr>
                                <tr><td><span class="badge badge-primary">POST</span></td><td>/api/v2/mirrors</td><td>æ·»åŠ é•œåƒ</td></tr>
                                <tr><td><span class="badge badge-warning">PUT</span></td><td>/api/v2/mirrors/{name}</td><td>æ›´æ–°é•œåƒ</td></tr>
                                <tr><td><span class="badge badge-danger">DELETE</span></td><td>/api/v2/mirrors/{name}</td><td>åˆ é™¤é•œåƒ</td></tr>
                                <tr><td><span class="badge badge-warning">PUT</span></td><td>/api/v2/mirrors/{name}/enable</td><td>å¯ç”¨/ç¦ç”¨</td></tr>
                                <tr><td><span class="badge badge-primary">POST</span></td><td>/api/v2/mirrors/{name}/refresh</td><td>åˆ·æ–°é•œåƒ</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>


                <div class="card">
                    <div class="card-header">
                        <span class="card-title">ğŸ“Š ç›‘æ§ API</span>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr><th>æ–¹æ³•</th><th>è·¯å¾„</th><th>è¯´æ˜</th></tr>
                            </thead>
                            <tbody>
                                <tr><td><span class="badge badge-info">GET</span></td><td>/api/v1/stats</td><td>åŸºç¡€ç»Ÿè®¡</td></tr>
                                <tr><td><span class="badge badge-info">GET</span></td><td>/api/v2/monitor/realtime</td><td>å®æ—¶ç›‘æ§</td></tr>
                                <tr><td><span class="badge badge-info">GET</span></td><td>/api/v1/health</td><td>å¥åº·æ£€æŸ¥</td></tr>
                                <tr><td><span class="badge badge-info">GET</span></td><td>/api/v2/server/info</td><td>æœåŠ¡å™¨ä¿¡æ¯</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">ğŸ”” å‘Šè­¦ API</span>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr><th>æ–¹æ³•</th><th>è·¯å¾„</th><th>è¯´æ˜</th></tr>
                            </thead>
                            <tbody>
                                <tr><td><span class="badge badge-info">GET</span></td><td>/api/v2/alerts</td><td>è·å–å‘Šè­¦</td></tr>
                                <tr><td><span class="badge badge-primary">POST</span></td><td>/api/v2/alerts/{id}/acknowledge</td><td>ç¡®è®¤å‘Šè­¦</td></tr>
                                <tr><td><span class="badge badge-info">GET</span></td><td>/api/v2/alerts/config</td><td>å‘Šè­¦é…ç½®</td></tr>
                                <tr><td><span class="badge badge-warning">PUT</span></td><td>/api/v2/alerts/config</td><td>æ›´æ–°å‘Šè­¦é…ç½®</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">ğŸª Webhooks API</span>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr><th>æ–¹æ³•</th><th>è·¯å¾„</th><th>è¯´æ˜</th></tr>
                            </thead>
                            <tbody>
                                <tr><td><span class="badge badge-info">GET</span></td><td>/api/v2/webhooks</td><td>åˆ—å‡º Webhooks</td></tr>
                                <tr><td><span class="badge badge-primary">POST</span></td><td>/api/v2/webhooks</td><td>åˆ›å»º Webhook</td></tr>
                                <tr><td><span class="badge badge-warning">PUT</span></td><td>/api/v2/webhooks/{id}</td><td>æ›´æ–° Webhook</td></tr>
                                <tr><td><span class="badge badge-danger">DELETE</span></td><td>/api/v2/webhooks/{id}</td><td>åˆ é™¤ Webhook</td></tr>
                                <tr><td><span class="badge badge-primary">POST</span></td><td>/api/v2/webhooks/{id}/test</td><td>æµ‹è¯• Webhook</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">ğŸ‘¥ ç®¡ç† API</span>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr><th>æ–¹æ³•</th><th>è·¯å¾„</th><th>è¯´æ˜</th></tr>
                            </thead>
                            <tbody>
                                <tr><td><span class="badge badge-info">GET</span></td><td>/api/v2/admin/stats</td><td>è·å–ç»Ÿè®¡</td></tr>
                                <tr><td><span class="badge badge-primary">POST</span></td><td>/api/v2/admin/auth/verify</td><td>éªŒè¯è®¤è¯</td></tr>
                                <tr><td><span class="badge badge-warning">POST</span></td><td>/api/v2/server/restart</td><td>é‡å¯æœåŠ¡å™¨</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">âš™ï¸ é…ç½® API</span>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr><th>æ–¹æ³•</th><th>è·¯å¾„</th><th>è¯´æ˜</th></tr>
                            </thead>
                            <tbody>
                                <tr><td><span class="badge badge-info">GET</span></td><td>/api/v1/config</td><td>è·å–é…ç½®</td></tr>
                                <tr><td><span class="badge badge-warning">PUT</span></td><td>/api/v2/config</td><td>ä¿å­˜é…ç½®</td></tr>
                                <tr><td><span class="badge badge-primary">POST</span></td><td>/api/v2/config/reload</td><td>é‡æ–°åŠ è½½</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ä¸Šä¼ å¯¹è¯æ¡† -->
    <div class="modal" id="uploadModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ“¤ ä¸Šä¼ æ–‡ä»¶</h3>
                <button class="modal-close" onclick="hideModal('uploadModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>é€‰æ‹©æ–‡ä»¶</label>
                    <input type="file" id="uploadFile" multiple>
                </div>
                <div class="form-group">
                    <label>ç›®æ ‡ç›®å½•</label>
                    <input type="text" id="uploadPath" placeholder="ç•™ç©ºä¸ºæ ¹ç›®å½•">
                </div>
                <div id="uploadProgress" style="display: none;">
                    <div class="progress" style="height: 10px;"><div class="progress-bar" id="uploadBar" style="width: 0%"></div></div>
                    <p style="text-align: center; margin-top: 8px; font-size: 13px; color: var(--text-muted);" id="uploadStatus">ä¸Šä¼ ä¸­...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('uploadModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="uploadFiles()">ä¸Šä¼ </button>
            </div>
        </div>
    </div>

    <!-- æ–°å»ºç›®å½•å¯¹è¯æ¡† -->
    <div class="modal" id="mkdirModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ“ æ–°å»ºç›®å½•</h3>
                <button class="modal-close" onclick="hideModal('mkdirModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>ç›®å½•è·¯å¾„</label>
                    <input type="text" id="mkdirPath" placeholder="ä¾‹å¦‚: downloads/newfolder">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('mkdirModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="createDirectory()">åˆ›å»º</button>
            </div>
        </div>
    </div>

    <!-- é‡å‘½åæ–‡ä»¶å¯¹è¯æ¡† -->
    <div class="modal" id="renameModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>âœï¸ é‡å‘½åæ–‡ä»¶</h3>
                <button class="modal-close" onclick="hideModal('renameModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>æ–°æ–‡ä»¶å</label>
                    <input type="text" id="renameFileName" placeholder="è¾“å…¥æ–°æ–‡ä»¶å">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('renameModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="renameFile()">é‡å‘½å</button>
            </div>
        </div>
    </div>

    <!-- æ–‡ä»¶é¢„è§ˆå¯¹è¯æ¡† -->
    <div class="modal" id="previewModal">
        <div class="modal-content" style="max-width: 900px; width: 95vw;">
            <div class="modal-header">
                <h3 id="previewFileName">ğŸ“„ æ–‡ä»¶é¢„è§ˆ</h3>
                <button class="modal-close" onclick="hideModal('previewModal')">Ã—</button>
            </div>
            <div class="modal-body" id="previewContent" style="max-height: 70vh; overflow: auto;">
                <!-- é¢„è§ˆå†…å®¹å°†ç”± JS å¡«å…… -->
            </div>
        </div>
    </div>

    <!-- æ·»åŠ åŒæ­¥æºå¯¹è¯æ¡† -->
    <div class="modal" id="addSyncModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>+ æ·»åŠ åŒæ­¥æº</h3>
                <button class="modal-close" onclick="hideModal('addSyncModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>åç§°</label>
                    <input type="text" id="syncName" placeholder="ä¾‹å¦‚: ubuntu-releases">
                </div>
                <div class="form-group">
                    <label>åŒæ­¥ç±»å‹</label>
                    <select id="syncType" onchange="updateSyncTypeFields()">
                        <option value="http">HTTP/HTTPS</option>
                        <option value="ftp">FTP</option>
                        <option value="sftp">SFTP</option>
                        <option value="rsync">Rsync</option>
                        <option value="git">Git</option>
                        <option value="s3">AWS S3 / MinIO</option>
                        <option value="oss">é˜¿é‡Œäº‘ OSS</option>
                        <option value="cos">è…¾è®¯äº‘ COS</option>
                        <option value="local">æœ¬åœ°ç›®å½•</option>
                        <option value="webdav">WebDAV</option>
                    </select>
                </div>

                <!-- é€šç”¨å­—æ®µ -->
                <div id="syncUrlGroup" class="form-group">
                    <label id="syncUrlLabel">æº URL</label>
                    <input type="text" id="syncUrl" placeholder="ä¾‹å¦‚: https://releases.ubuntu.com/">
                </div>

                <!-- S3/OSS/COS é¢å¤–å­—æ®µ -->
                <div id="syncCloudFields" style="display: none;">
                    <div class="form-group">
                        <label>Bucket åç§°</label>
                        <input type="text" id="syncBucket" placeholder="ä¾‹å¦‚: my-bucket">
                    </div>
                    <div class="form-group">
                        <label>Access Key</label>
                        <input type="text" id="syncAccessKey" placeholder="Access Key ID">
                    </div>
                    <div class="form-group">
                        <label>Secret Key</label>
                        <input type="password" id="syncSecretKey" placeholder="Secret Access Key">
                    </div>
                    <div class="form-group">
                        <label>åŒºåŸŸ/Endpoint</label>
                        <input type="text" id="syncRegion" placeholder="ä¾‹å¦‚: cn-hangzhou æˆ– https://s3.amazonaws.com">
                    </div>
                    <div class="form-group">
                        <label>å‰ç¼€ (å¯é€‰)</label>
                        <input type="text" id="syncPrefix" placeholder="ä¾‹å¦‚: mirrors/">
                    </div>
                </div>

                <!-- FTP/SFTP é¢å¤–å­—æ®µ -->
                <div id="syncFtpFields" style="display: none;">
                    <div class="form-group">
                        <label>ä¸»æœºåœ°å€</label>
                        <input type="text" id="syncHost" placeholder="ä¾‹å¦‚: ftp.example.com">
                    </div>
                    <div class="form-group">
                        <label>ç«¯å£</label>
                        <input type="number" id="syncPort" placeholder="21" value="21">
                    </div>
                    <div class="form-group">
                        <label>ç”¨æˆ·å</label>
                        <input type="text" id="syncUsername" placeholder="anonymous">
                    </div>
                    <div class="form-group">
                        <label>å¯†ç </label>
                        <input type="password" id="syncPassword" placeholder="å¯†ç ">
                    </div>
                    <div class="form-group">
                        <label>è¿œç¨‹è·¯å¾„</label>
                        <input type="text" id="syncRemotePath" placeholder="/pub">
                    </div>
                </div>

                <!-- æœ¬åœ°ç›®å½•é¢å¤–å­—æ®µ -->
                <div id="syncLocalFields" style="display: none;">
                    <div class="form-group">
                        <label>æœ¬åœ°æºè·¯å¾„</label>
                        <input type="text" id="syncLocalPath" placeholder="ä¾‹å¦‚: /mnt/external/mirrors">
                    </div>
                </div>

                <!-- é€šç”¨ç›®æ ‡è·¯å¾„ -->
                <div id="syncTargetGroup" class="form-group">
                    <label>å­˜å‚¨è·¯å¾„</label>
                    <input type="text" id="syncTarget" placeholder="ä¾‹å¦‚: pypi/simple, npm/packages">
                    <small style="color: var(--text-muted);">ç›¸å¯¹äº downloads ç›®å½•çš„å­˜å‚¨è·¯å¾„ï¼Œå¦‚å¡«å†™ pypi/simple åˆ™æ–‡ä»¶å°†å­˜æ”¾åˆ° downloads/pypi/simple/</small>
                </div>

                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="syncAuto" checked>
                    <span>å¯ç”¨è‡ªåŠ¨åŒæ­¥</span>
                </label>

                <!-- å®šæ—¶åŒæ­¥é…ç½® -->
                <div style="margin-top: 15px; padding: 15px; background: var(--bg-input); border-radius: 8px;">
                    <label style="font-weight: 600; margin-bottom: 10px; display: block;">â° å®šæ—¶åŒæ­¥ (Cron è¡¨è¾¾å¼)</label>
                    <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                        <input type="checkbox" id="syncScheduleEnabled">
                        <span>å¯ç”¨å®šæ—¶</span>
                        <input type="text" id="syncScheduleCron" placeholder="0 2 * * *" style="flex: 1; min-width: 150px;" value="0 2 * * *">
                    </div>
                    <div style="font-size: 12px; color: var(--text-muted); margin-top: 8px;">
                        å¸¸ç”¨: æ¯å¤©å‡Œæ™¨ 2 ç‚¹ <code>0 2 * * *</code> | æ¯å‘¨æ—¥å‡Œæ™¨ <code>0 2 * * 0</code> | æ¯æœˆ1å· <code>0 2 1 * *</code>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('addSyncModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="btnAddSyncSource" onclick="addSyncSource()">æ·»åŠ </button>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘åŒæ­¥æºå¯¹è¯æ¡† -->
    <div class="modal" id="editSyncModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fa-solid fa-edit"></i> ç¼–è¾‘åŒæ­¥æº</h3>
                <button class="modal-close" onclick="hideModal('editSyncModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>åç§°</label>
                    <input type="text" id="editSyncName" disabled style="background: var(--bg-input); opacity: 0.7; cursor: not-allowed;">
                    <small style="color: var(--text-muted);">åç§°ä¸å¯æ›´æ”¹</small>
                </div>
                <div class="form-group">
                    <label>åŒæ­¥ç±»å‹</label>
                    <select id="editSyncType" onchange="updateEditSyncTypeFields()">
                        <option value="http">HTTP/HTTPS</option>
                        <option value="ftp">FTP</option>
                        <option value="sftp">SFTP</option>
                        <option value="rsync">Rsync</option>
                        <option value="git">Git</option>
                        <option value="s3">AWS S3 / MinIO</option>
                        <option value="oss">é˜¿é‡Œäº‘ OSS</option>
                        <option value="cos">è…¾è®¯äº‘ COS</option>
                        <option value="local">æœ¬åœ°ç›®å½•</option>
                        <option value="webdav">WebDAV</option>
                    </select>
                </div>

                <!-- é€šç”¨å­—æ®µ -->
                <div id="editSyncUrlGroup" class="form-group">
                    <label id="editSyncUrlLabel">æº URL</label>
                    <input type="text" id="editSyncUrl" placeholder="ä¾‹å¦‚: https://releases.ubuntu.com/">
                </div>

                <!-- S3/OSS/COS é¢å¤–å­—æ®µ -->
                <div id="editSyncCloudFields" style="display: none;">
                    <div class="form-group">
                        <label>Bucket åç§°</label>
                        <input type="text" id="editSyncBucket" placeholder="ä¾‹å¦‚: my-bucket">
                    </div>
                    <div class="form-group">
                        <label>Access Key</label>
                        <input type="text" id="editSyncAccessKey" placeholder="Access Key ID">
                    </div>
                    <div class="form-group">
                        <label>Secret Key</label>
                        <input type="password" id="editSyncSecretKey" placeholder="Secret Access Key">
                    </div>
                    <div class="form-group">
                        <label>åŒºåŸŸ/Endpoint</label>
                        <input type="text" id="editSyncRegion" placeholder="ä¾‹å¦‚: cn-hangzhou æˆ– https://s3.amazonaws.com">
                    </div>
                    <div class="form-group">
                        <label>å‰ç¼€ (å¯é€‰)</label>
                        <input type="text" id="editSyncPrefix" placeholder="ä¾‹å¦‚: mirrors/">
                    </div>
                </div>

                <!-- FTP/SFTP é¢å¤–å­—æ®µ -->
                <div id="editSyncFtpFields" style="display: none;">
                    <div class="form-group">
                        <label>ä¸»æœºåœ°å€</label>
                        <input type="text" id="editSyncHost" placeholder="ä¾‹å¦‚: ftp.example.com">
                    </div>
                    <div class="form-group">
                        <label>ç«¯å£</label>
                        <input type="number" id="editSyncPort" placeholder="21" value="21">
                    </div>
                    <div class="form-group">
                        <label>ç”¨æˆ·å</label>
                        <input type="text" id="editSyncUsername" placeholder="anonymous">
                    </div>
                    <div class="form-group">
                        <label>å¯†ç </label>
                        <input type="password" id="editSyncPassword" placeholder="å¯†ç ">
                    </div>
                    <div class="form-group">
                        <label>è¿œç¨‹è·¯å¾„</label>
                        <input type="text" id="editSyncRemotePath" placeholder="/pub">
                    </div>
                </div>

                <!-- æœ¬åœ°ç›®å½•é¢å¤–å­—æ®µ -->
                <div id="editSyncLocalFields" style="display: none;">
                    <div class="form-group">
                        <label>æœ¬åœ°æºè·¯å¾„</label>
                        <input type="text" id="editSyncLocalPath" placeholder="ä¾‹å¦‚: /mnt/external/mirrors">
                    </div>
                </div>

                <!-- å­˜å‚¨è·¯å¾„ -->
                <div id="editSyncTargetGroup" class="form-group">
                    <label>å­˜å‚¨è·¯å¾„</label>
                    <input type="text" id="editSyncTarget" placeholder="ä¾‹å¦‚: pypi/simple, npm/packages">
                    <small style="color: var(--text-muted);">ç›¸å¯¹äº downloads ç›®å½•çš„å­˜å‚¨è·¯å¾„</small>
                </div>

                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="editSyncAuto">
                    <span>å¯ç”¨è‡ªåŠ¨åŒæ­¥</span>
                </label>

                <!-- å®šæ—¶åŒæ­¥é…ç½® -->
                <div style="margin-top: 15px; padding: 15px; background: var(--bg-input); border-radius: 8px;">
                    <label style="font-weight: 600; margin-bottom: 10px; display: block;">â° å®šæ—¶åŒæ­¥ (Cron è¡¨è¾¾å¼)</label>
                    <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                        <input type="checkbox" id="editSyncScheduleEnabled">
                        <span>å¯ç”¨å®šæ—¶</span>
                        <input type="text" id="editSyncScheduleCron" placeholder="0 2 * * *" style="flex: 1; min-width: 150px;" value="0 2 * * *">
                    </div>
                    <div style="font-size: 12px; color: var(--text-muted); margin-top: 8px;">
                        å¸¸ç”¨: æ¯å¤©å‡Œæ™¨ 2 ç‚¹ <code>0 2 * * *</code> | æ¯å‘¨æ—¥å‡Œæ™¨ <code>0 2 * * 0</code> | æ¯æœˆ1å· <code>0 2 1 * *</code>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('editSyncModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="btnEditSyncSource" onclick="saveEditSyncSource()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘åŠ é€Ÿæºå¯¹è¯æ¡† -->
    <div class="modal" id="editMirrorModal">
        <div class="modal-content" style="max-width: 560px;">
            <div class="modal-header" style="background: linear-gradient(135deg, var(--primary) 0%, #2563eb 100%); border-radius: 16px 16px 0 0;">
                <h3 style="color: white;"><i class="fa-solid fa-sliders"></i> ç¼–è¾‘åŠ é€Ÿæº</h3>
                <button class="modal-close" onclick="hideModal('editMirrorModal')" style="color: white; opacity: 0.8;">Ã—</button>
            </div>
            <div class="modal-body" style="padding: 24px;">
                <!-- åŠ é€Ÿæºåç§° -->
                <div class="input-group" style="margin-bottom: 20px;">
                    <label><i class="fa-solid fa-tag"></i> åŠ é€Ÿæºåç§°</label>
                    <input type="text" id="editMirrorName" disabled style="background: var(--bg-input); opacity: 0.7; cursor: not-allowed;">
                    <small style="color: var(--text-muted); display: flex; align-items: center; gap: 6px; margin-top: 6px;"><i class="fa-solid fa-info-circle"></i> åç§°ä¸å¯æ›´æ”¹</small>
                </div>

                <!-- åè®®ç±»å‹å’Œä¼˜å…ˆçº§ -->
                <div style="display: grid; grid-template-columns: 1fr 120px; gap: 16px; margin-bottom: 20px;">
                    <div class="input-group">
                        <label><i class="fa-solid fa-layer-group"></i> åè®®ç±»å‹</label>
                        <div class="select-wrapper">
                            <select id="editMirrorType">
                                <option value="custom" data-icon="fa-gear">âš™ï¸ è‡ªå®šä¹‰ (Custom)</option>
                                <option value="http" data-icon="fa-globe">ğŸŒ HTTP æ–‡ä»¶æœåŠ¡</option>
                                <option value="docker" data-icon="fa-docker">ğŸ³ Docker Registry V2</option>
                                <option value="apt" data-icon="fa-debian">ğŸ“¦ APT (Debian/Ubuntu)</option>
                                <option value="yum" data-icon="fa-redhat">ğŸ¯ YUM (CentOS/RHEL)</option>
                                <option value="pacman" data-icon="fa-archway">ğŸ”µ Pacman (Arch Linux)</option>
                                <option value="pypi" data-icon="fa-python">ğŸ PyPI (Python)</option>
                                <option value="npm" data-icon="fa-npm">ğŸ“¦ NPM (Node.js)</option>
                                <option value="go" data-icon="fa-golang">ğŸ”· Go æ¨¡å—</option>
                                <option value="maven" data-icon="fa-leaf">ğŸ«™ Maven (Java)</option>
                                <option value="gradle" data-icon="fa-hammer">ğŸ”¨ Gradle</option>
                                <option value="gem" data-icon="fa-gem">ğŸ’ RubyGems</option>
                                <option value="cargo" data-icon="fa-ship">ğŸ¦€ Cargo (Rust)</option>
                                <option value="nuget" data-icon="fa-book">ğŸ“š NuGet (.NET)</option>
                                <option value="cocoapods" data-icon="fa-apple">ğŸ CocoaPods</option>
                                <option value="cran" data-icon="fa-chart-bar">ğŸ“Š CRAN (R)</option>
                                <option value="ctan" data-icon="fa-file-alt">ğŸ“ CTAN (LaTeX)</option>
                                <option value="cuda" data-icon="fa-gamepad">ğŸ® NVIDIA CUDA</option>
                                <option value="goproxy" data-icon="fa-golang">ğŸ”· GoProxy (Go æ¨¡å—)</option>
                                <option value="git" data-icon="fa-git-alt">ğŸ”€ Git ä»“åº“</option>
                            </select>
                            <i class="fa-solid fa-chevron-down select-arrow"></i>
                        </div>
                    </div>
                    <div class="input-group">
                        <label><i class="fa-solid fa-sort-numeric-up"></i> ä¼˜å…ˆçº§</label>
                        <input type="number" id="editMirrorPriority" value="0" min="0" max="100" style="text-align: center;">
                    </div>
                </div>

                <!-- ä¸Šæ¸¸åœ°å€ -->
                <div class="input-group" style="margin-bottom: 20px;">
                    <label><i class="fa-solid fa-link"></i> ä¸Šæ¸¸åœ°å€</label>
                    <input type="text" id="editMirrorUrl" placeholder="ä¾‹å¦‚: https://mirror.example.com" />
                </div>

                <!-- å­˜å‚¨ç›®å½• -->
                <div class="input-group" style="margin-bottom: 20px;">
                    <label><i class="fa-solid fa-folder"></i> å­˜å‚¨ç›®å½•</label>
                    <input type="text" id="editMirrorStorageDir" placeholder="ä¾‹å¦‚: docker-cn, pypi-cn (é»˜è®¤: é•œåƒåç§°)" />
                </div>

                <!-- æè¿° -->
                <div class="input-group" style="margin-bottom: 20px;">
                    <label><i class="fa-solid fa-pen-to-square"></i> æè¿°</label>
                    <input type="text" id="editMirrorDesc" placeholder="æè¿°è¿™ä¸ªåŠ é€Ÿæºçš„ç”¨é€”" />
                </div>

                <!-- å¯ç”¨å¼€å…³ -->
                <div class="toggle-card">
                    <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                        <label class="switch">
                            <input type="checkbox" id="editMirrorEnabled" checked>
                            <span class="switch-slider"></span>
                        </label>
                        <span style="flex: 1;"><i class="fa-solid fa-power-off"></i> å¯ç”¨æ­¤åŠ é€Ÿæº</span>
                        <span class="status-badge enabled" id="editMirrorStatusBadge"><i class="fa-solid fa-check"></i> å·²å¯ç”¨</span>
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('editMirrorModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="updateMirror()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let apiToken = localStorage.getItem('hyc_api_key') || '';
        let currentPath = '/';
        let currentFiles = [];
        let refreshTimer = null;

        // API åŸºç¡€åœ°å€
        const API_BASE = window.location.origin;

        // ============ è®¤è¯ç›¸å…³ ============

        async function login() {
            const user = document.getElementById('loginUser').value;
            const pass = document.getElementById('loginPass').value;
            const key = document.getElementById('loginKey').value.trim();

            if (!key && (!user || !pass)) {
                showNotification('è¯·è¾“å…¥ç”¨æˆ·åå¯†ç æˆ– API Key', 'error');
                return;
            }

            if (key) {
                // ç›´æ¥ä½¿ç”¨ API Key
                apiToken = key;
                localStorage.setItem('hyc_api_key', apiToken);
                // ä¿å­˜ç”¨æˆ·å
                if (user) localStorage.setItem('hyc_username', user);
                enterApp();
                showNotification('ç™»å½•æˆåŠŸ', 'success');
            } else {
                // è°ƒç”¨ç™»å½• API è·å– token
                try {
                    const response = await fetch(API_BASE + '/api/v2/user/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username: user, password: pass })
                    });
                    const data = await response.json();
                    if (data.success && data.token) {
                        apiToken = data.token;
                        localStorage.setItem('hyc_api_key', apiToken);
                        // ä¿å­˜ç”¨æˆ·å
                        if (user) localStorage.setItem('hyc_username', user);
                        enterApp();
                        showNotification('ç™»å½•æˆåŠŸ', 'success');
                    } else {
                        showNotification(data.error || 'ç™»å½•å¤±è´¥', 'error');
                    }
                } catch (e) {
                    // ç™»å½• API å¤±è´¥ï¼Œå›é€€åˆ° Basic Auth æ–¹å¼
                    apiToken = btoa(user + ':' + pass);
                    localStorage.setItem('hyc_api_key', apiToken);
                    // ä¿å­˜ç”¨æˆ·å
                    if (user) localStorage.setItem('hyc_username', user);
                    enterApp();
                    showNotification('ç™»å½•æˆåŠŸ', 'success');
                }
            }
        }

        function enterApp() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('appPage').style.display = 'flex';
            document.getElementById('appPage').classList.add('active');
            // è‡ªåŠ¨å¡«å……ç”¨æˆ·ååˆ°ä¿®æ”¹å¯†ç è¾“å…¥æ¡†
            const savedUsername = localStorage.getItem('hyc_username') || '';
            if (savedUsername) {
                const usernameInput = document.getElementById('changePasswordUsername');
                if (usernameInput) usernameInput.value = savedUsername;
            }
            initMobileMenuButtons();
            loadDashboard();
        }

        function logout() {
            localStorage.removeItem('hyc_api_key');
            apiToken = '';
            location.reload();
        }

        // ============ åˆå§‹åŒ– ============
        async function initApp() {
            // æœ‰ä¿å­˜çš„tokenï¼Œç›´æ¥è¿›å…¥ï¼ˆåªå¯¹éç©ºtokenç”Ÿæ•ˆï¼‰
            if (apiToken && apiToken.trim() !== '') {
                enterApp();
                return;
            }
            // æ¸…é™¤å¯èƒ½æ®‹ç•™çš„ç©ºtoken
            localStorage.removeItem('hyc_api_key');
            apiToken = '';
            // æ— tokenï¼Œä¿æŒç™»å½•é¡µï¼Œä¸è°ƒç”¨éœ€è¦è®¤è¯çš„API
        }

        // ============ é¡µé¢å¯¼èˆª ============
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                const page = this.dataset.page;
                if (page) showPage(page);
            });
        });

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

            document.getElementById('page-' + pageId).classList.add('active');
            document.querySelector('.nav-item[data-page="' + pageId + '"]').classList.add('active');

            // ç¡®ä¿ç§»åŠ¨ç«¯èœå•æŒ‰é’®å­˜åœ¨
            initMobileMenuButtons();

            // åŠ è½½é¡µé¢æ•°æ®
            const loaders = {
                dashboard: loadDashboard,
                files: loadFiles,
                sync: loadSync,
                mirrors: loadMirrors,
                downloads: loadDownloads,
                config: loadConfig,
                settings: loadSettings
            };
            if (loaders[pageId]) loaders[pageId]();
        }

        function switchSyncTab(tab) {
            document.querySelectorAll('#page-sync .tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('sync-sources-tab').style.display = tab === 'sources' ? 'block' : 'none';
            document.getElementById('sync-history-tab').style.display = tab === 'history' ? 'block' : 'none';
            // åˆ‡æ¢åˆ°å†å²æ ‡ç­¾æ—¶åŠ è½½å†å²è®°å½•
            if (tab === 'history') {
                loadSyncHistory();
            }
        }

        // åˆ‡æ¢æ•°æ®åº“ç±»å‹æ—¶æ˜¾ç¤º/éšè—å¯¹åº”çš„é…ç½®è¾“å…¥æ¡†
        function switchDbType() {
            const dbType = document.getElementById('dbType').value;
            document.getElementById('db-sqlite-config').style.display = dbType === 'sqlite' ? 'block' : 'none';
            document.getElementById('db-postgresql-config').style.display = dbType === 'postgresql' ? 'block' : 'none';
            document.getElementById('db-mysql-config').style.display = dbType === 'mysql' ? 'block' : 'none';
        }

        function switchSettingsTab(tab) {
            document.querySelectorAll('#page-settings .tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('settings-security').style.display = tab === 'security' ? 'block' : 'none';
            document.getElementById('settings-storage').style.display = tab === 'storage' ? 'block' : 'none';
            document.getElementById('settings-sync').style.display = tab === 'sync' ? 'block' : 'none';
            document.getElementById('settings-features').style.display = tab === 'features' ? 'block' : 'none';
            document.getElementById('settings-performance').style.display = tab === 'performance' ? 'block' : 'none';
            document.getElementById('settings-log').style.display = tab === 'log' ? 'block' : 'none';
            document.getElementById('settings-alerts').style.display = tab === 'alerts' ? 'block' : 'none';
        }

        // ============ API è¯·æ±‚ ============
        async function apiRequest(url, options = {}) {
            const headers = { 'Accept': 'application/json' };
            if (apiToken) {
                if (apiToken.includes(':')) {
                    headers['Authorization'] = 'Basic ' + apiToken;
                } else if (apiToken.startsWith('eyJ')) {
                    headers['Authorization'] = 'Bearer ' + apiToken;
                } else {
                    headers['X-API-Key'] = apiToken;
                }
            }
            try {
                const r = await fetch(API_BASE + url, { ...options, headers: { ...headers, ...options.headers } });
                return await r.json().catch(() => ({}));
            } catch (e) {
                console.error('API Error:', url, e);
                return { error: e.message };
            }
        }

        // ============ é€šçŸ¥ ============
        function showNotification(msg, type = 'success') {
            const div = document.createElement('div');
            div.className = 'notification notification-' + type;
            div.innerHTML = '<span>' + (type === 'success' ? 'âœ“' : type === 'error' ? 'âœ•' : 'â„¹') + '</span> ' + msg;
            document.body.appendChild(div);
            setTimeout(() => div.remove(), 3000);
        }

        // å¼¹çª—æ‰“å¼€/å…³é—­ç®¡ç†
        function showModal(id) {
            const modal = document.getElementById(id);
            if (!modal) return;

            // æ‰“å¼€å¼¹çª—æ—¶æ¸…ç©ºè¡¨å•è¾“å…¥æ¡†
            modal.querySelectorAll('input[type="text"], input[type="password"], input[type="number"], input[type="email"], textarea').forEach(input => {
                // ä¿ç•™æœ‰ disabled å±æ€§çš„è¾“å…¥æ¡†ï¼ˆæ˜¾ç¤ºåªè¯»ä¿¡æ¯çš„ï¼‰
                if (!input.disabled) {
                    input.value = '';
                }
            });
            modal.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach(input => {
                input.checked = input.getAttribute('data-default-checked') === 'true' || input.hasAttribute('checked');
            });

            // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
            document.body.style.overflow = 'hidden';
            modal.classList.add('active');
        }
        function hideModal(id) {
            document.getElementById(id).classList.remove('active');
            // æ¢å¤èƒŒæ™¯æ»šåŠ¨
            document.body.style.overflow = '';
        }

        // ============ ç§»åŠ¨ç«¯ä¾§è¾¹æ  ============
        // åˆå§‹åŒ–é¡µé¢æ ‡é¢˜æ èœå•æŒ‰é’®
        function initMobileMenuButtons() {
            const pageHeaders = document.querySelectorAll('.page-header');
            pageHeaders.forEach(header => {
                if (!header.querySelector('.mobile-menu-btn')) {
                    const btn = document.createElement('button');
                    btn.className = 'mobile-menu-btn';
                    btn.innerHTML = 'â˜°';
                    btn.onclick = toggleSidebar;
                    btn.title = 'åˆ‡æ¢èœå•';
                    header.insertBefore(btn, header.firstChild);
                }
            });
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');

            if (sidebar && overlay) {
                const isActive = sidebar.classList.contains('active');
                if (isActive) {
                    sidebar.classList.remove('active');
                    overlay.classList.remove('active');
                    // æ›´æ–°æ‰€æœ‰èœå•æŒ‰é’®å›¾æ ‡
                    document.querySelectorAll('.mobile-menu-btn').forEach(btn => btn.innerHTML = 'â˜°');
                } else {
                    sidebar.classList.add('active');
                    overlay.classList.add('active');
                    document.querySelectorAll('.mobile-menu-btn').forEach(btn => btn.innerHTML = 'âœ•');
                }
            }
        }

        // ç‚¹å‡»å¯¼èˆªé¡¹åå…³é—­ä¾§è¾¹æ ï¼ˆç§»åŠ¨ç«¯ï¼‰
        document.addEventListener('DOMContentLoaded', function() {
            const navItems = document.querySelectorAll('.nav-item[data-page]');
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const sidebar = document.getElementById('sidebar');
                    const overlay = document.getElementById('sidebarOverlay');
                    // æ£€æŸ¥æ˜¯å¦ä¸ºç§»åŠ¨ç«¯
                    if (window.innerWidth <= 1024 && sidebar && sidebar.classList.contains('active')) {
                        sidebar.classList.remove('active');
                        overlay.classList.remove('active');
                        document.querySelectorAll('.mobile-menu-btn').forEach(btn => btn.innerHTML = 'â˜°');
                    }
                });
            });
        });

        // ============ ä»ªè¡¨ç›˜ ============
        let dashboardTimer = null;
        let activityOffset = 0;      // å·²åŠ è½½çš„æ´»åŠ¨è®°å½•åç§»é‡
        let activityHasMore = true;   // æ˜¯å¦è¿˜æœ‰æ›´å¤šæ•°æ®
        let activityLoading = false;  // æ˜¯å¦æ­£åœ¨åŠ è½½
        let activityDataCache = [];   // ç¼“å­˜å·²åŠ è½½çš„æ´»åŠ¨æ•°æ®

        // åŠ è½½æ›´å¤šæ´»åŠ¨è®°å½•
        window.loadMoreActivity = async function() {
            if (activityLoading || !activityHasMore) return;

            activityLoading = true;
            document.getElementById('activityLoading').style.display = 'block';
            document.getElementById('activityLoadMore').style.display = 'none';

            try {
                const newActivity = await apiRequest(`/api/v2/activity?limit=20&offset=${activityOffset}`).catch(e => ({ error: e.message }));

                if (newActivity && !newActivity.error) {
                    const newItems = newActivity.activities || [];
                    const total = newActivity.total || 0;

                    if (newItems.length === 0) {
                        activityHasMore = false;
                    } else {
                        // è¿½åŠ æ–°æ•°æ®
                        activityDataCache = [...activityDataCache, ...newItems];
                        activityOffset += newItems.length;

                        // æ ¹æ®æ€»æ•°åˆ¤æ–­æ˜¯å¦è¿˜æœ‰æ›´å¤š
                        activityHasMore = activityOffset < total;
                    }

                    renderActivityTable(newItems, false);
                }
            } catch (e) {
                console.error('åŠ è½½æ›´å¤šæ´»åŠ¨å¤±è´¥:', e);
            }

            activityLoading = false;

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('activityLoading').style.display = 'none';
            if (activityHasMore) {
                document.getElementById('activityLoadMore').style.display = 'block';
            } else {
                document.getElementById('activityEnd').style.display = 'block';
            }
        };

        async function loadDashboard() {
            // å–æ¶ˆä¹‹å‰çš„å®šæ—¶å™¨
            if (dashboardTimer) {
                clearInterval(dashboardTimer);
                dashboardTimer = null;
            }

            const updateData = async () => {
                try {
                    // åˆ†åˆ«è¯·æ±‚ï¼Œæ¯ä¸ªè¯·æ±‚ç‹¬ç«‹å¤„ç†é”™è¯¯
                    const stats = await apiRequest('/api/v1/stats').catch(e => ({ error: e.message }));
                    const monitor = await apiRequest('/api/v2/monitor/realtime').catch(e => ({ error: e.message }));
                    const health = await apiRequest('/api/v1/health').catch(e => ({ error: e.message }));
                    const mirrors = await apiRequest('/api/v2/mirrors').catch(e => ({ error: e.message }));
                    // é¦–æ¬¡åŠ è½½æ´»åŠ¨æ—¶é‡ç½®åç§»é‡å’Œç¼“å­˜
                    if (activityOffset === 0) {
                        const activity = await apiRequest('/api/v2/activity?limit=20').catch(e => ({ error: e.message }));
                        if (activity && !activity.error) {
                            activityDataCache = activity.activities || [];
                            activityOffset = activityDataCache.length;
                            activityHasMore = activity.count > activityDataCache.length;
                            renderActivityTable(activityDataCache, true);
                        }
                    }
                    const downloadTrend = await apiRequest('/api/v2/stats/download-trend?days=7').catch(e => ({ error: e.message }));

                    // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
                    if (stats && !stats.error) {
                        const el = document.getElementById('statFiles');
                        if (el) el.textContent = formatNum(stats.total_files || 0);

                        const el2 = document.getElementById('statStorage');
                        if (el2) el2.textContent = stats.total_size_formatted || formatSize(stats.total_size || 0);

                        const el3 = document.getElementById('statDownloads');
                        if (el3) el3.textContent = formatNum(stats.downloads_today || 0);
                    }

                    // æ›´æ–°ç›‘æ§æ•°æ® - é€ä¸ªæ›´æ–°ä¸æ€•å¤±è´¥
                    try {
                        const cpuPercent = (monitor?.cpu?.percent || 0);
                        const memPercent = (monitor?.memory?.percent || 0);
                        const diskPercent = (monitor?.disk?.percent || 0);

                        const cpuValEl = document.getElementById('cpuValue');
                        const cpuBarEl = document.getElementById('cpuBar');
                        const memValEl = document.getElementById('memValue');
                        const memBarEl = document.getElementById('memBar');
                        const diskValEl = document.getElementById('diskValue');
                        const diskBarEl = document.getElementById('diskBar');

                        if (cpuValEl) cpuValEl.textContent = cpuPercent.toFixed(1) + '%';
                        if (cpuBarEl) cpuBarEl.style.width = Math.min(cpuPercent, 100) + '%';
                        if (memValEl) memValEl.textContent = memPercent.toFixed(1) + '%';
                        if (memBarEl) memBarEl.style.width = Math.min(memPercent, 100) + '%';
                        if (diskValEl) diskValEl.textContent = diskPercent.toFixed(1) + '%';
                        if (diskBarEl) diskBarEl.style.width = Math.min(diskPercent, 100) + '%';
                    } catch (e) {
                        console.error('Monitor update error:', e);
                    }

                    // æ›´æ–°æœåŠ¡å™¨ä¿¡æ¯
                    if (health?.server) {
                        const uptimeText = formatUptime(health.server.uptime);
                        // æ›´æ–°ç»Ÿè®¡å¡ç‰‡çš„è¿è¡Œæ—¶é—´
                        const cardEl = document.getElementById('serverUptime');
                        if (cardEl) cardEl.textContent = uptimeText;
                        // æ›´æ–°è¯¦æƒ…é¡µçš„è¿è¡Œæ—¶é—´
                        const detailEl = document.getElementById('serverUptimeDetail');
                        if (detailEl) detailEl.textContent = uptimeText;
                    }

                    // æ›´æ–°åŠ é€Ÿæºæ•°é‡
                    if (mirrors && !mirrors.error) {
                        const mirrorCount = mirrors.count || (mirrors.mirrors ? Object.keys(mirrors.mirrors).length : 0);
                        const el = document.getElementById('mirrorCount');
                        if (el) el.textContent = mirrorCount;

                        // æ›´æ–°åŒæ­¥çŠ¶æ€
                        const syncStatusEl = document.getElementById('syncStatus');
                        if (syncStatusEl && mirrors.mirrors) {
                            const syncing = Object.values(mirrors.mirrors).some(m => m?.syncing) || false;
                            syncStatusEl.textContent = syncing ? 'åŒæ­¥ä¸­...' : 'æ­£å¸¸';
                            syncStatusEl.style.color = syncing ? 'var(--warning)' : 'var(--success)';
                        }
                    }

                    // æ›´æ–°é¦–é¡µä¸‹è½½è¶‹åŠ¿å›¾è¡¨ï¼ˆä½¿ç”¨Chart.jsï¼‰
                    if (downloadTrend?.trend) {
                        renderDashboardChart(downloadTrend.trend);
                    }
                } catch (e) {
                    console.error('Failed to load dashboard:', e);
                }
            };

            // ç«‹å³æ›´æ–°ä¸€æ¬¡
            await updateData();

            // æ¯3ç§’è‡ªåŠ¨åˆ·æ–°ç›‘æ§æ•°æ®
            dashboardTimer = setInterval(updateData, 3000);
        }

        // ============ ä¸‹è½½è¶‹åŠ¿å›¾è¡¨ï¼ˆæŠ˜çº¿å›¾ï¼‰============
        // é¦–é¡µä»ªè¡¨æ¿ä¸‹è½½è¶‹åŠ¿å›¾è¡¨ï¼ˆChart.jsï¼‰
        let dashboardChart = null;
        let dashboardChartInitialized = false;
        function renderDashboardChart(trend) {
            const container = document.getElementById('downloadChart');
            if (!container) return;

            try {
                if (!trend || trend.length === 0) {
                    if (!dashboardChartInitialized) {
                        container.innerHTML = '<div class="empty" style="width: 100%; text-align: center; padding: 40px;">æš‚æ— ä¸‹è½½æ•°æ®</div>';
                    }
                    return;
                }

                const labels = trend.map(d => {
                    let label = d.date || '';
                    if (label.includes('-')) {
                        const parts = label.split('-');
                        if (parts.length >= 3) label = `${parts[1]}-${parts[2]}`;
                    }
                    return label;
                });
                const values = trend.map(d => d.downloads || 0);

                // é¦–æ¬¡åˆ›å»º canvas
                if (!dashboardChartInitialized) {
                    container.innerHTML = '';
                    const canvas = document.createElement('canvas');
                    container.appendChild(canvas);
                    dashboardChartInitialized = true;
                }

                const canvas = container.querySelector('canvas');
                const ctx = canvas.getContext('2d');

                const primaryColor = '#e94560';

                // å¦‚æœå·²æœ‰å›¾è¡¨å®ä¾‹ï¼Œæ›´æ–°æ•°æ®è€Œä¸æ˜¯é‡å»º
                if (dashboardChart) {
                    dashboardChart.data.labels = labels;
                    dashboardChart.data.datasets[0].data = values;
                    dashboardChart.update('none');
                    return;
                }

                // é¦–æ¬¡åˆ›å»ºå›¾è¡¨
                dashboardChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'ä¸‹è½½é‡',
                            data: values,
                            backgroundColor: 'rgba(233, 69, 96, 0.1)',
                            borderColor: primaryColor,
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: primaryColor,
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(26, 26, 46, 0.95)',
                                titleColor: '#fff',
                                bodyColor: '#aaa',
                                borderColor: primaryColor,
                                borderWidth: 1
                            }
                        },
                        scales: {
                            x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#888' } },
                            y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#888', precision: 0 } }
                        }
                    }
                });
            } catch (e) {
                console.error('Failed to render dashboard chart:', e);
                container.innerHTML = '<div class="empty" style="width: 100%; text-align: center; padding: 40px;">åŠ è½½å¤±è´¥</div>';
            }
        }

        function renderDownloadTrend(trendData) {
            const container = document.getElementById('downloadChart');
            if (!container) return;

            try {
                const trend = trendData?.trend || [];
                if (trend.length === 0) {
                    container.innerHTML = '<div class="empty" style="width: 100%; text-align: center; padding: 40px;">æš‚æ— ä¸‹è½½æ•°æ®</div>';
                    return;
                }

                // è®¡ç®—æ•°æ®èŒƒå›´
                const maxDownloads = Math.max(...trend.map(d => d.downloads), 1);
                const minDownloads = Math.min(...trend.map(d => d.downloads), 0);
                const range = maxDownloads - minDownloads || 1;

                // å›¾è¡¨å°ºå¯¸
                const padding = { top: 20, right: 15, bottom: 30, left: 10 };
                const width = container.clientWidth || 400;
                const height = 180;
                const chartWidth = width - padding.left - padding.right;
                const chartHeight = height - padding.top - padding.bottom;

                // è®¡ç®—åæ ‡ç‚¹
                const points = trend.map((item, index) => {
                    const x = padding.left + 20 + (index / (trend.length - 1 || 1)) * (chartWidth - 20);
                    const y = padding.top + chartHeight - ((item.downloads - minDownloads) / range) * chartHeight;
                    return { x, y, value: item.downloads, date: item.date, index };
                });

                // ç”Ÿæˆ SVG æŠ˜çº¿å›¾
                const linePath = points.length > 1
                    ? points.map((p, i) => `${i === 0 ? 'M' : 'L'} ${p.x} ${p.y}`).join(' ')
                    : `M ${points[0].x + 15} ${points[0].y}`;

                // ç”Ÿæˆå¡«å……åŒºåŸŸè·¯å¾„
                const fillPath = points.length > 1
                    ? `${linePath} L ${points[points.length - 1].x} ${padding.top + chartHeight} L ${points[0].x} ${padding.top + chartHeight} Z`
                    : '';

                // ç”Ÿæˆæ•°æ®ç‚¹
                const dots = points.map(p => `
                    <circle cx="${p.x}" cy="${p.y}" r="4" fill="var(--primary)" stroke="#fff" stroke-width="2">
                        <title>${p.date}: ${p.value} æ¬¡ä¸‹è½½</title>
                    </circle>
                `).join('');

                // ç”Ÿæˆ X è½´æ ‡ç­¾
                const labels = trend.map((item, index) => {
                    const x = padding.left + 20 + (index / (trend.length - 1 || 1)) * (chartWidth - 20);
                    // è§£ææ—¥æœŸæ ¼å¼ (YYYY-MM-DD -> MM-DD)
                    let label = item.date;
                    if (item.date && item.date.includes('-')) {
                        const parts = item.date.split('-');
                        if (parts.length >= 3) {
                            label = `${parts[1]}-${parts[2]}`;
                        } else if (parts.length === 2) {
                            label = parts[1];
                        }
                    }
                    return `<text x="${x}" y="${height - 8}" text-anchor="middle" font-size="11" fill="var(--text-muted)">${label}</text>`;
                }).join('');

                // ç”Ÿæˆ Y è½´ç½‘æ ¼çº¿å’Œæ•°å€¼
                const yTicks = 4;
                const gridLines = [];
                const yLabels = [];
                for (let i = 0; i <= yTicks; i++) {
                    const value = maxDownloads - (i / yTicks) * range;
                    const y = padding.top + (i / yTicks) * chartHeight;
                    gridLines.push(`<line x1="${padding.left}" y1="${y}" x2="${width - padding.right}" y2="${y}" stroke="var(--border-color)" stroke-dasharray="3,3"/>`);
                    yLabels.push(`<text x="${padding.left - 5}" y="${y + 4}" text-anchor="end" font-size="10" fill="var(--text-muted)">${Math.round(value)}</text>`);
                }

                container.innerHTML = `
                    <svg width="100%" height="${height}" viewBox="0 0 ${width} ${height}" style="display: block;">
                        <!-- ç½‘æ ¼çº¿å’Œ Y è½´æ ‡ç­¾ -->
                        ${gridLines.join('')}
                        ${yLabels.join('')}

                        <!-- å¡«å……åŒºåŸŸ -->
                        ${fillPath ? `<path d="${fillPath}" fill="url(#gradient)" opacity="0.3"/>` : ''}

                        <!-- æŠ˜çº¿ -->
                        <path d="${linePath}" fill="none" stroke="var(--primary)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>

                        <!-- æ•°æ®ç‚¹ -->
                        ${dots}

                        <!-- X è½´æ ‡ç­¾ -->
                        ${labels}
                    </svg>
                    <svg width="100%" height="0" style="position: absolute;">
                        <defs>
                            <linearGradient id="gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" stop-color="var(--primary)" stop-opacity="0.6"/>
                                <stop offset="100%" stop-color="var(--primary)" stop-opacity="0.05"/>
                            </linearGradient>
                        </defs>
                    </svg>
                `;

                // æ·»åŠ  hover æ•ˆæœ
                container.querySelectorAll('circle').forEach((circle, i) => {
                    circle.style.transition = 'r 0.2s ease';
                    circle.style.cursor = 'pointer';
                    circle.addEventListener('mouseenter', () => {
                        circle.setAttribute('r', '6');
                    });
                    circle.addEventListener('mouseleave', () => {
                        circle.setAttribute('r', '4');
                    });
                });
            } catch (e) {
                console.error('Failed to render download trend:', e);
                container.innerHTML = '<div class="empty" style="width: 100%; text-align: center; padding: 40px;">åŠ è½½å¤±è´¥</div>';
            }
        }

        // æ¸²æŸ“æœ€è¿‘æ´»åŠ¨è¡¨æ ¼
        function renderActivityTable(activities, isFirstLoad) {
            const tbody = document.getElementById('activityLog');
            if (!tbody) return;

            try {
                if (activities.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" class="empty">æš‚æ— æ´»åŠ¨è®°å½•</td></tr>';
                    document.getElementById('activityLoadMore').style.display = 'none';
                    document.getElementById('activityEnd').style.display = 'none';
                    return;
                }

                const html = activities.map(a => {
                    const statusClass = a.status_type === 'success' ? 'var(--success)' :
                                      a.status_type === 'error' ? 'var(--danger)' :
                                      a.status_type === 'warning' ? 'var(--warning)' : 'var(--info)';
                    const typeIcon = a.type === 'åŒæ­¥' ? 'fa-sync' :
                                    a.type === 'ä¸‹è½½' ? 'fa-download' :
                                    a.type === 'å‘Šè­¦' ? 'fa-exclamation-triangle' : 'fa-info';
                    return `<tr>
                        <td>${a.time || '-'}</td>
                        <td><i class="fa-solid ${typeIcon}"></i> ${a.type}</td>
                        <td>${a.content || '-'}</td>
                        <td><span style="color: ${statusClass}; font-weight: 500;">${a.status || '-'}</span></td>
                    </tr>`;
                }).join('');

                if (isFirstLoad) {
                    tbody.innerHTML = html;
                } else {
                    tbody.insertAdjacentHTML('beforeend', html);
                }

                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                if (activityHasMore) {
                    document.getElementById('activityLoadMore').style.display = 'block';
                    document.getElementById('activityEnd').style.display = 'none';
                } else {
                    document.getElementById('activityLoadMore').style.display = 'none';
                    document.getElementById('activityEnd').style.display = 'block';
                }
            } catch (e) {
                console.error('Failed to render activity:', e);
                tbody.innerHTML = '<tr><td colspan="4" class="empty">åŠ è½½å¤±è´¥</td></tr>';
            }
        }

        // ============ æ–‡ä»¶ç®¡ç† ============
        async function loadFiles() {
            const list = document.getElementById('fileList');
            list.innerHTML = '<div class="empty"><div class="icon"><i class="fa-solid fa-folder-open fa-spin"></i></div><p>åŠ è½½ä¸­...</p></div>';

            try {
                const url = '/api/v1/files?path=' + encodeURIComponent(currentPath);
                const data = await apiRequest(url);

                // æ£€æŸ¥æ˜¯å¦æœ‰æ•°æ® (å³ä½¿æœ‰errorï¼Œå¦‚æœæœ‰filesä¹Ÿè¦æ˜¾ç¤º)
                if (!data || (!data.files && data.error)) {
                    list.innerHTML = '<div class="empty"><div class="icon"><i class="fa-solid fa-triangle-exclamation"></i></div><p>' + (data?.error || 'æœåŠ¡å™¨é”™è¯¯') + '</p><p style="font-size: 12px; color: var(--text-muted);">å½“å‰è·¯å¾„: ' + (currentPath || '/') + '</p></div>';
                    return;
                }

                // å¦‚æœæœ‰filesï¼Œå³ä½¿æœ‰errorä¹Ÿè¦æ˜¾ç¤º
                if (!data.files) {
                    list.innerHTML = '<div class="empty"><div class="icon"><i class="fa-regular fa-folder-open"></i></div><p>ç›®å½•ä¸ºç©º</p></div>';
                    currentFiles = [];
                    return;
                }

                const files = data.files;

                if (files.length === 0) {
                    list.innerHTML = '<div class="empty"><div class="icon"><i class="fa-regular fa-folder-open"></i></div><p>ç›®å½•ä¸ºç©º</p><p style="font-size: 12px; color: var(--text-muted);">å½“å‰è·¯å¾„: ' + (currentPath || '/') + '</p></div>';
                    currentFiles = [];
                    return;
                }

                // Windows æ–‡ä»¶ç®¡ç†å™¨é£æ ¼æ’åºï¼šæ–‡ä»¶å¤¹åœ¨å‰ï¼Œæ–‡ä»¶åœ¨åï¼ŒæŒ‰åç§°é€’å¢æ’åº
                files.sort((a, b) => {
                    // æ–‡ä»¶å¤¹ä¼˜å…ˆ
                    if (a.is_dir && !b.is_dir) return -1;
                    if (!a.is_dir && b.is_dir) return 1;
                    // åç§°é€’å¢æ’åºï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
                    return a.name.localeCompare(b.name, undefined, { sensitivity: 'base' });
                });

                currentFiles = files;
                list.innerHTML = currentFiles.map(f => {
                    const pathStr = (f.path || '').replace(/'/g, "\\'");
                    const fileName = f.name.replace(/'/g, "\\'");
                    const isDir = f.is_dir;

                    // å•å‡»ç›®å½•è¿›å…¥ï¼Œå•å‡»æ–‡ä»¶é¢„è§ˆ
                    const clickAction = isDir
                        ? 'navigateTo(\'' + pathStr + '\')'
                        : 'showFilePreview(\'' + pathStr + '\')';

                    // æ ¼å¼åŒ–ä¿®æ”¹æ—¶é—´
                    const modifiedTime = f.modified ? f.modified.split('T')[0] + ' ' + f.modified.split('T')[1]?.substring(0, 8) : '';

                    // è·å–æ–‡ä»¶ç±»å‹å›¾æ ‡ï¼ˆä»…å›¾æ ‡ï¼‰
                    const fileIcon = getFileIcon(f.name);

                    return '<div class="file-item" onclick="' + clickAction + '; selectFile(this, \'' + fileName + '\')">' +
                        '<div class="file-icon">' + (isDir ? '<i class="fa-solid fa-folder-open"></i>' : fileIcon) + '</div>' +
                        '<div class="file-info">' +
                        '<div class="file-name">' + f.name + (isDir ? '/' : '') + '</div>' +
                        '<div class="file-meta">' +
                        (isDir
                            ? '<span class="meta-item"><i class="fa-solid fa-folder"></i> æ–‡ä»¶å¤¹</span>'
                            : '<span class="meta-item"><i class="fa-regular fa-file-lines"></i> ' + (f.size_formatted || '0 B') + '</span>') +
                        (modifiedTime ? '<span class="meta-item"><i class="fa-regular fa-clock"></i> ' + modifiedTime + '</span>' : '') +
                        '</div></div>' +
                        '<div class="file-actions">' +
                        (!isDir ? '<button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); downloadFile(\'' + pathStr + '\')" title="ä¸‹è½½"><i class="fa-solid fa-download"></i></button>' : '') +
                        '<button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); showRenameModal(\'' + pathStr + '\')" title="é‡å‘½å"><i class="fa-solid fa-pen-to-square"></i></button>' +
                        '<button class="btn btn-danger btn-sm" onclick="event.stopPropagation(); deleteFile(\'' + pathStr + '\')" title="åˆ é™¤"><i class="fa-solid fa-trash"></i></button>' +
                        '</div></div>';
                }).join('');
            } catch (e) {
                console.error('Failed to load files:', e);
                list.innerHTML = '<div class="empty"><div class="icon"><i class="fa-solid fa-circle-exclamation"></i></div><p>åŠ è½½å¤±è´¥</p><p style="font-size: 12px; color: var(--text-muted);">' + e.message + '</p></div>';
            }
        }

        function navigateTo(path) {
            // ç§»é™¤è·¯å¾„æœ«å°¾çš„ /
            if (path.endsWith('/') && path !== '/') {
                path = path.slice(0, -1);
            }
            currentPath = path;
            updateBreadcrumb();
            loadFiles();
        }

        function goUp() {
            if (!currentPath || currentPath === '/') {
                return;
            }
            const parts = currentPath.split('/');
            parts.pop();
            navigateTo(parts.join('/') || '/');
        }

        function updateBreadcrumb() {
            const parts = currentPath.split('/').filter(p => p);
            let html = '<a onclick="navigateTo(\'/\')"><i class="fa-solid fa-house"></i> æ ¹ç›®å½•</a>';
            let acc = '';
            parts.forEach((p, index) => {
                acc += '/' + p;
                const navPath = acc.replace(/'/g, "\\'");
                if (index === parts.length - 1) {
                    // å½“å‰ç›®å½•
                    html += '<span class="separator">/</span><span class="current">' + p + '</span>';
                } else {
                    html += '<span class="separator">/</span><a onclick="navigateTo(\'' + navPath + '\')">' + p + '</a>';
                }
            });
            document.getElementById('fileBreadcrumb').innerHTML = html;

            // æ˜¾ç¤º/éšè—è¿”å›ä¸Šçº§æŒ‰é’®
            const goUpBtn = document.getElementById('goUpBtn');
            if (goUpBtn) {
                goUpBtn.style.display = currentPath && currentPath !== '/' ? 'inline-flex' : 'none';
            }
        }

        function selectFile(el, name) {
            document.querySelectorAll('.file-item').forEach(f => f.classList.remove('selected'));
            el.classList.add('selected');
        }

        async function searchFiles() {
            const q = document.getElementById('fileSearch').value;
            if (!q) {
                loadFiles();
                return;
            }
            const data = await apiRequest('/api/v1/search?q=' + encodeURIComponent(q));
            const list = document.getElementById('fileList');
            if (data?.results) {
                list.innerHTML = data.results.map(f => {
                    const navPath = f.path.substring(0, f.path.lastIndexOf('/'));
                    const safePath = navPath.replace(/'/g, "\\'");
                    const safeName = f.name.replace(/'/g, "\\'");
                    const fileIcon = f.is_dir ? '<i class="fa-solid fa-folder-open"></i>' : getFileIcon(f.name);
                    return '<div class="file-item" onclick="navigateTo(\'' + safePath + '\')">' +
                        '<div class="file-icon">' + fileIcon + '</div>' +
                        '<div class="file-info">' +
                        '<div class="file-name">' + f.name + '</div>' +
                        '<div class="file-meta">' +
                        '<span><i class="fa-solid fa-link"></i> ' + f.path + '</span>' +
                        '<span><i class="fa-solid fa-weight-hanging"></i> ' + (f.size_formatted || '') + '</span>' +
                        '</div></div></div>';
                }).join('');
            }
        }

        function refreshFiles() { loadFiles(); }

        async function uploadFiles() {
            const input = document.getElementById('uploadFile');
            const path = document.getElementById('uploadPath').value || currentPath;
            const progress = document.getElementById('uploadProgress');
            const bar = document.getElementById('uploadBar');
            const status = document.getElementById('uploadStatus');

            if (!input.files.length) {
                showNotification('è¯·é€‰æ‹©æ–‡ä»¶', 'warning');
                return;
            }

            progress.style.display = 'block';
            let completed = 0;

            for (const file of input.files) {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('path', path);

                await apiRequest('/api/v1/upload', { method: 'POST', body: formData });
                completed++;
                bar.style.width = (completed / input.files.length * 100) + '%';
                status.textContent = `ä¸Šä¼ ä¸­... ${completed}/${input.files.length}`;
            }

            status.textContent = 'ä¸Šä¼ å®Œæˆ!';
            setTimeout(() => {
                hideModal('uploadModal');
                progress.style.display = 'none';
                input.value = '';
                loadFiles();
                showNotification('ä¸Šä¼ å®Œæˆ', 'success');
            }, 1000);
        }

        async function createDirectory() {
            const path = document.getElementById('mkdirPath').value;
            if (!path) {
                showNotification('è¯·è¾“å…¥ç›®å½•è·¯å¾„', 'warning');
                return;
            }
            await apiRequest('/api/v1/mkdir', {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ path })
            });
            hideModal('mkdirModal');
            loadFiles();
            showNotification('ç›®å½•åˆ›å»ºæˆåŠŸ', 'success');
        }

        async function deleteFile(path) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤ ' + path + ' å—ï¼Ÿ')) return;
            await apiRequest('/api/v1/file/' + encodeURIComponent(path), { method: 'DELETE' });
            loadFiles();
            showNotification('æ–‡ä»¶å·²åˆ é™¤', 'success');
        }

        function downloadFile(path) {
            window.open(API_BASE + '/file/' + path + '?key=' + apiToken, '_blank');
        }

        function previewFile(path) {
            window.open(API_BASE + '/api/v1/file/' + encodeURIComponent(path) + '/preview?key=' + apiToken, '_blank');
        }

        // ============ æ–‡ä»¶é‡å‘½å ============
        let renameFilePath = '';

        function showRenameModal(path) {
            renameFilePath = path;
            const fileName = path.split('/').pop();
            showModal('renameModal');
            document.getElementById('renameFileName').value = fileName;
        }

        async function renameFile() {
            const newName = document.getElementById('renameFileName').value.trim();
            if (!newName) {
                showNotification('è¯·è¾“å…¥æ–°æ–‡ä»¶å', 'warning');
                return;
            }

            if (newName.includes('/') || newName.includes('\\')) {
                showNotification('æ–‡ä»¶åä¸èƒ½åŒ…å«è·¯å¾„åˆ†éš”ç¬¦', 'warning');
                return;
            }

            // è·å–ç›®å½•è·¯å¾„å’Œæ–°å®Œæ•´è·¯å¾„
            const dirPath = renameFilePath.substring(0, renameFilePath.lastIndexOf('/'));
            const newPath = dirPath + '/' + newName;

            await apiRequest('/api/v1/file/rename', {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    old_path: renameFilePath,
                    new_path: newPath
                })
            });

            hideModal('renameModal');
            loadFiles();
            showNotification('æ–‡ä»¶å·²é‡å‘½å', 'success');
        }

        // ============ æ–‡ä»¶é¢„è§ˆ ============
        async function showFilePreview(path) {
            const fileName = path.split('/').pop();
            document.getElementById('previewFileName').innerHTML = '<i class="fa-regular fa-file"></i> ' + fileName;
            document.getElementById('previewContent').innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-muted);">åŠ è½½ä¸­...</div>';

            try {
                const response = await fetch(API_BASE + '/api/v1/file/' + encodeURIComponent(path) + '/preview?key=' + apiToken);
                const contentType = response.headers.get('content-type') || '';

                // æ£€æŸ¥æ˜¯å¦æ˜¯ JSON å“åº”ï¼ˆåç«¯è¿”å›çš„é¢„è§ˆæ ¼å¼ï¼‰
                if (contentType.includes('application/json')) {
                    const jsonData = await response.json();

                    // æ£€æŸ¥æ˜¯å¦æ˜¯é”™è¯¯å“åº”
                    if (jsonData.error) {
                        document.getElementById('previewContent').innerHTML = '<div style="text-align: center; padding: 40px; color: var(--danger);">' + jsonData.error + '</div>';
                        showModal('previewModal');
                        return;
                    }

                    // å›¾ç‰‡é¢„è§ˆï¼ˆä½¿ç”¨ data_urlï¼‰
                    if (jsonData.preview_available && jsonData.data_url) {
                        let imagePreview = '<img src="' + jsonData.data_url + '" style="max-width: 100%; max-height: 55vh; display: block; margin: 0 auto; border-radius: 8px;" />';
                        // å¦‚æœæ˜¯ SVGï¼Œé¢å¤–æä¾›æŸ¥çœ‹æºä»£ç çš„åŠŸèƒ½
                        const isSvg = jsonData.svg_content || jsonData.name?.endsWith('.svg') || jsonData.name?.endsWith('.SVG');
                        if (isSvg && jsonData.svg_content) {
                            const svgText = typeof jsonData.svg_content === 'string' ? jsonData.svg_content : JSON.stringify(jsonData.svg_content, null, 2);
                            const lines = svgText.split('\n');
                            const lineNumbers = lines.map((_, i) => i + 1).join('\n');
                            imagePreview = '<div id="svgPreviewMode">' +
                                '<div style="display: flex; justify-content: center; gap: 12px; margin-bottom: 16px;">' +
                                '<button onclick="switchSvgMode(\'image\')" class="btn btn-primary" style="padding: 8px 20px;"><i class="fa-regular fa-image"></i> å›¾ç‰‡é¢„è§ˆ</button>' +
                                '<button onclick="switchSvgMode(\'source\')" class="btn btn-secondary" style="padding: 8px 20px;"><i class="fa-solid fa-code"></i> æŸ¥çœ‹æºç </button>' +
                                '</div>' +
                                '<div id="svgImageContainer" style="display: block;">' + imagePreview + '</div>' +
                                '<div id="svgSourceContainer" style="display: none;">' +
                                '<div style="display: flex; background: var(--bg-input); border-radius: 8px; overflow: auto;">' +
                                '<div style="padding: 16px 8px; color: var(--text-muted); font-family: monospace; font-size: 13px; text-align: right; user-select: none; border-right: 1px solid var(--border); white-space: pre;">' +
                                lineNumbers + '</div>' +
                                '<pre style="flex: 1; margin: 0; padding: 16px; overflow: auto; white-space: pre-wrap; word-wrap: break-word; font-family: monospace; font-size: 13px;">' +
                                escapeHtml(svgText) + '</pre></div>' +
                                '</div></div>';
                        }
                        document.getElementById('previewContent').innerHTML = imagePreview;
                    }
                    // æ£€æŸ¥æ˜¯å¦æœ‰æ–‡æœ¬å†…å®¹é¢„è§ˆ
                    else if (jsonData.preview_available && jsonData.content !== undefined) {
                        if (jsonData.preview_available === false && jsonData.error) {
                            // é”™è¯¯å“åº”
                            document.getElementById('previewContent').innerHTML = '<div style="text-align: center; padding: 40px; color: var(--danger);"><i class="fa-solid fa-circle-exclamation"></i> ' + jsonData.error + '</div>';
                        } else if (jsonData.preview_type === 'text' || jsonData.type?.startsWith('text/')) {
                            // æ–‡æœ¬å†…å®¹é¢„è§ˆï¼ˆå¸¦è¡Œå·ï¼‰
                            let text = typeof jsonData.content === 'string' ? jsonData.content : JSON.stringify(jsonData.content, null, 2);
                            if (jsonData.truncated) {
                                text += '\n\n... (å†…å®¹è¿‡é•¿ï¼Œå·²æˆªæ–­)';
                            }
                            const lines = text.split('\n');
                            const lineNumbers = lines.map((_, i) => i + 1).join('\n');
                            document.getElementById('previewContent').innerHTML =
                                '<div style="display: flex; background: var(--bg-input); border-radius: 8px; overflow: auto;">' +
                                '<div style="padding: 16px 8px; color: var(--text-muted); font-family: monospace; font-size: 13px; text-align: right; user-select: none; border-right: 1px solid var(--border); white-space: pre;">' +
                                lineNumbers + '</div>' +
                                '<pre style="flex: 1; margin: 0; padding: 16px; overflow: auto; white-space: pre-wrap; word-wrap: break-word; font-family: monospace; font-size: 13px;">' +
                                escapeHtml(text) + '</pre></div>';
                        } else if (jsonData.preview_type === 'json') {
                            // JSON æ–‡ä»¶é¢„è§ˆï¼ˆå¸¦è¡Œå·+è¯­æ³•é«˜äº®ï¼‰
                            let text = typeof jsonData.content === 'string' ? jsonData.content : JSON.stringify(jsonData.content, null, 2);
                            if (jsonData.truncated) {
                                text += '\n\n... (å†…å®¹è¿‡é•¿ï¼Œå·²æˆªæ–­)';
                            }
                            const lines = text.split('\n');
                            const lineNumbers = lines.map((_, i) => i + 1).join('\n');
                            document.getElementById('previewContent').innerHTML =
                                '<div style="display: flex; background: var(--bg-input); border-radius: 8px; overflow: auto;">' +
                                '<div style="padding: 16px 8px; color: var(--text-muted); font-family: monospace; font-size: 13px; text-align: right; user-select: none; border-right: 1px solid var(--border); white-space: pre;">' +
                                lineNumbers + '</div>' +
                                '<pre style="flex: 1; margin: 0; padding: 16px; overflow: auto; white-space: pre-wrap; word-wrap: break-word; font-family: monospace; font-size: 13px;">' +
                                escapeHtml(text) + '</pre></div>';
                        } else if (jsonData.preview_type === 'markdown') {
                            // Markdown é¢„è§ˆ
                            let text = jsonData.content || '';
                            if (jsonData.truncated) {
                                text += '\n\n... (å†…å®¹è¿‡é•¿ï¼Œå·²æˆªæ–­)';
                            }
                            document.getElementById('previewContent').innerHTML =
                                '<div style="padding: 20px; background: var(--bg-card); border-radius: 8px;">' +
                                '<div class="markdown-body">' + escapeHtml(text).replace(/\n/g, '<br>').replace(/`([^`]+)`/g, '<code style="background: var(--bg-input); padding: 2px 6px; border-radius: 4px; font-family: monospace;">$1</code>').replace(/\*\*([^\*]+)\*\*/g, '<strong>$1</strong>').replace(/\*([^\*]+)\*/g, '<em>$1</em>') + '</div></div>';
                        } else if (jsonData.preview_type === 'xml' || jsonData.type?.includes('xml') || jsonData.name?.endsWith('.xml') || jsonData.name?.endsWith('.svg')) {
                            // XML/SVG é¢„è§ˆï¼ˆæ ¼å¼åŒ–+è¯­æ³•é«˜äº®ï¼‰
                            let text = typeof jsonData.content === 'string' ? jsonData.content : JSON.stringify(jsonData.content, null, 2);
                            if (jsonData.truncated) {
                                text += '\n\n... (å†…å®¹è¿‡é•¿ï¼Œå·²æˆªæ–­)';
                            }
                            const lines = text.split('\n');
                            const lineNumbers = lines.map((_, i) => i + 1).join('\n');
                            document.getElementById('previewContent').innerHTML =
                                '<div style="display: flex; background: var(--bg-input); border-radius: 8px; overflow: auto;">' +
                                '<div style="padding: 16px 8px; color: var(--text-muted); font-family: monospace; font-size: 13px; text-align: right; user-select: none; border-right: 1px solid var(--border); white-space: pre;">' +
                                lineNumbers + '</div>' +
                                '<pre style="flex: 1; margin: 0; padding: 16px; overflow: auto; white-space: pre-wrap; word-wrap: break-word; font-family: monospace; font-size: 13px;">' +
                                escapeHtml(text) + '</pre></div>';
                        } else if (jsonData.preview_type === 'csv') {
                            // CSV é¢„è§ˆï¼ˆè¡¨æ ¼å½¢å¼ï¼‰
                            let text = jsonData.content || '';
                            const rows = text.split('\n').filter(r => r.trim());
                            let tableHtml = '<table style="width: 100%; border-collapse: collapse; font-size: 13px;">';
                            rows.forEach((row, idx) => {
                                const cells = row.split(',');
                                const cellTag = idx === 0 ? 'th' : 'td';
                                tableHtml += '<tr>';
                                cells.forEach(cell => {
                                    tableHtml += '<' + cellTag + ' style="border: 1px solid var(--border); padding: 8px 12px; text-align: left;">' + escapeHtml(cell.trim()) + '</' + cellTag + '>';
                                });
                                tableHtml += '</tr>';
                            });
                            tableHtml += '</table>';
                            document.getElementById('previewContent').innerHTML =
                                '<div style="padding: 16px; background: var(--bg-input); border-radius: 8px; overflow: auto;">' + tableHtml + '</div>';
                        } else if (jsonData.preview_type === 'yaml') {
                            // YAML é¢„è§ˆï¼ˆå¸¦è¡Œå·ï¼‰
                            let text = typeof jsonData.content === 'string' ? jsonData.content : JSON.stringify(jsonData.content, null, 2);
                            if (jsonData.truncated) {
                                text += '\n\n... (å†…å®¹è¿‡é•¿ï¼Œå·²æˆªæ–­)';
                            }
                            const lines = text.split('\n');
                            const lineNumbers = lines.map((_, i) => i + 1).join('\n');
                            document.getElementById('previewContent').innerHTML =
                                '<div style="display: flex; background: var(--bg-input); border-radius: 8px; overflow: auto;">' +
                                '<div style="padding: 16px 8px; color: var(--text-muted); font-family: monospace; font-size: 13px; text-align: right; user-select: none; border-right: 1px solid var(--border); white-space: pre;">' +
                                lineNumbers + '</div>' +
                                '<pre style="flex: 1; margin: 0; padding: 16px; overflow: auto; white-space: pre-wrap; word-wrap: break-word; font-family: monospace; font-size: 13px;">' +
                                escapeHtml(text) + '</pre></div>';
                        } else if (jsonData.preview_type === 'audio') {
                            // éŸ³é¢‘é¢„è§ˆ
                            if (jsonData.data_url) {
                                document.getElementById('previewContent').innerHTML =
                                    '<div style="text-align: center; padding: 40px;">' +
                                    '<i class="fa-solid fa-music fa-3x"></i><br><br>' +
                                    '<audio controls style="width: 100%; max-width: 400px;">' +
                                    '<source src="' + jsonData.data_url + '" type="' + jsonData.type + '">' +
                                    'æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾' +
                                    '</audio>' +
                                    '<p style="margin-top: 16px; color: var(--text-muted);">ç‚¹å‡»ä¸‹è½½å®Œæ•´éŸ³é¢‘</p>' +
                                    '</div>';
                            } else {
                                document.getElementById('previewContent').innerHTML = '<div style="text-align: center; padding: 40px;"><i class="fa-solid fa-music"></i> éŸ³é¢‘é¢„è§ˆä¸å¯ç”¨</div>';
                            }
                        } else if (jsonData.preview_type === 'pdf') {
                            // PDF é¢„è§ˆ
                            if (jsonData.data_url) {
                                document.getElementById('previewContent').innerHTML =
                                    '<div style="text-align: center; padding: 20px;"><i class="fa-regular fa-file-pdf fa-2x"></i><br><br>' +
                                    '<embed src="' + jsonData.data_url + '" type="application/pdf" width="100%" height="70vh" />' +
                                    '<p style="margin-top: 10px; color: var(--text-muted);">å¦‚æœPDFæ— æ³•æ˜¾ç¤ºï¼Œè¯·ç‚¹å‡»ä¸‹è½½</p>' +
                                    '</div>';
                            } else {
                                document.getElementById('previewContent').innerHTML = '<div style="text-align: center; padding: 40px;"><i class="fa-regular fa-file-pdf"></i> PDFé¢„è§ˆä¸å¯ç”¨</div>';
                            }
                        } else {
                            document.getElementById('previewContent').innerHTML = '<div style="text-align: center; padding: 40px;"><i class="fa-regular fa-file"></i> æ­¤æ–‡ä»¶ç±»å‹ä¸æ”¯æŒåœ¨çº¿é¢„è§ˆ</div>';
                        }
                    } else {
                        document.getElementById('previewContent').innerHTML = '<div style="text-align: center; padding: 40px;"><i class="fa-regular fa-file"></i> æ­¤æ–‡ä»¶ç±»å‹ä¸æ”¯æŒåœ¨çº¿é¢„è§ˆ</div>';
                    }
                } else if (contentType.includes('image/')) {
                    // å›¾ç‰‡é¢„è§ˆ
                    const blob = await response.blob();
                    const blobUrl = URL.createObjectURL(blob);
                    document.getElementById('previewContent').innerHTML = '<img src="' + blobUrl + '" style="max-width: 100%; max-height: 60vh; display: block; margin: 0 auto;" />';
                } else if (contentType.includes('text/') || contentType.includes('application/javascript')) {
                    // æ–‡æœ¬é¢„è§ˆï¼ˆå¸¦è¡Œå·ï¼‰
                    const text = await response.text();
                    let displayText = text.length > 50000 ? text.substring(0, 50000) + '\n\n... (å†…å®¹è¿‡é•¿ï¼Œå·²æˆªæ–­)' : text;
                    const lines = displayText.split('\n');
                    const lineNumbers = lines.map((_, i) => i + 1).join('\n');
                    document.getElementById('previewContent').innerHTML =
                        '<div style="display: flex; background: var(--bg-input); border-radius: 8px; overflow: auto;">' +
                        '<div style="padding: 16px 8px; color: var(--text-muted); font-family: monospace; font-size: 13px; text-align: right; user-select: none; border-right: 1px solid var(--border); white-space: pre;">' +
                        lineNumbers + '</div>' +
                        '<pre style="flex: 1; margin: 0; padding: 16px; overflow: auto; white-space: pre-wrap; word-wrap: break-word; font-family: monospace; font-size: 13px;">' +
                        escapeHtml(displayText) + '</pre></div>';
                } else {
                    // å…¶ä»–ç±»å‹æ˜¾ç¤ºä¿¡æ¯
                    const size = response.headers.get('x-file-size') || 'æœªçŸ¥';
                    document.getElementById('previewContent').innerHTML = '<div style="text-align: center; padding: 40px;"><i class="fa-regular fa-file fa-3x"></i><br><br><p>æ­¤æ–‡ä»¶ç±»å‹ä¸æ”¯æŒåœ¨çº¿é¢„è§ˆ</p><p style="color: var(--text-muted); margin-top: 10px;">æ–‡ä»¶å¤§å°: ' + size + '</p><button class="btn btn-primary" style="margin-top: 20px;" onclick="downloadFile(\'' + path.replace(/'/g, "\\'") + '\')"><i class="fa-solid fa-download"></i> ä¸‹è½½æ–‡ä»¶</button></div>';
                }
            } catch (e) {
                document.getElementById('previewContent').innerHTML = '<div style="text-align: center; padding: 40px; color: var(--danger);"><i class="fa-solid fa-circle-exclamation"></i> é¢„è§ˆå¤±è´¥: ' + e.message + '</div>';
            }

            showModal('previewModal');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // SVG é¢„è§ˆæ¨¡å¼åˆ‡æ¢
        function switchSvgMode(mode) {
            const imgContainer = document.getElementById('svgImageContainer');
            const srcContainer = document.getElementById('svgSourceContainer');
            const imgBtn = imgContainer?.parentElement?.querySelector('button:nth-child(1)');
            const srcBtn = srcContainer?.parentElement?.querySelector('button:nth-child(2)');

            if (mode === 'image') {
                if (imgContainer) imgContainer.style.display = 'block';
                if (srcContainer) srcContainer.style.display = 'none';
                if (imgBtn) {
                    imgBtn.className = 'btn btn-primary';
                    imgBtn.style.padding = '8px 20px';
                }
                if (srcBtn) {
                    srcBtn.className = 'btn btn-secondary';
                    srcBtn.style.padding = '8px 20px';
                }
            } else {
                if (imgContainer) imgContainer.style.display = 'none';
                if (srcContainer) srcContainer.style.display = 'block';
                if (imgBtn) {
                    imgBtn.className = 'btn btn-secondary';
                    imgBtn.style.padding = '8px 20px';
                }
                if (srcBtn) {
                    srcBtn.className = 'btn btn-primary';
                    srcBtn.style.padding = '8px 20px';
                }
            }
        }

        // ============ é•œåƒåŒæ­¥ ============
        async function loadSync() {
            const [sources, status] = await Promise.all([
                apiRequest('/api/v1/sync/sources'),
                apiRequest('/api/v1/sync/status')
            ]);

            const syncList = document.getElementById('syncList');
            const statusBadge = document.getElementById('syncStatus');
            // æ£€æŸ¥ä»»æ„æºæ˜¯å¦åœ¨è¿è¡Œ
            const running = Object.values(status || {}).some(s => s?.status === 'syncing');

            if (sources?.sources?.length) {
                syncList.innerHTML = sources.sources.map(s => {
                    const safeName = s.name.replace(/'/g, "\\'");

                    // å®šæ—¶åŒæ­¥ä¿¡æ¯
                    const schedule = s.schedule || {};
                    const scheduleEnabled = schedule.enabled;
                    const scheduleCron = schedule.cron || '-';
                    const nextSync = s.next_sync ? new Date(s.next_sync).toLocaleString() : '-';

                    // è·å–å½“å‰æºçš„åŒæ­¥çŠ¶æ€ (statusç›´æ¥æ˜¯å­—å…¸æ ¼å¼)
                    const sourceStatusData = status?.[s.name] || {};
                    const sourceStatus = sourceStatusData?.status || 'stopped';
                    // åªæœ‰æ­£åœ¨åŒæ­¥æ—¶æ‰èƒ½åœæ­¢ï¼Œå…¶ä»–çŠ¶æ€éƒ½æ˜¯å¼€å§‹/é‡æ–°åŒæ­¥
                    const isRunning = sourceStatus === 'syncing';
                    const filesSynced = sourceStatusData?.files_synced || 0;
                    const totalFiles = sourceStatusData?.total_files || 0;
                    const progress = totalFiles > 0 ? Math.round((filesSynced / totalFiles) * 100) : 0;

                    // çŠ¶æ€æ˜¾ç¤º
                    let statusBadge = '';
                    if (sourceStatus === 'syncing') {
                        statusBadge = '<span class="badge badge-success">åŒæ­¥ä¸­ ' + progress + '%</span>';
                    } else if (sourceStatus === 'completed') {
                        statusBadge = '<span class="badge badge-info">å·²å®Œæˆ</span>';
                    } else if (sourceStatus === 'error') {
                        statusBadge = '<span class="badge badge-danger">é”™è¯¯</span>';
                    } else {
                        statusBadge = '<span class="badge badge-secondary">ç©ºé—²</span>';
                    }

                    // è¿›åº¦æ¡
                    const progressBar = sourceStatus === 'syncing'
                        ? '<div class="progress" style="width: 60px; height: 6px;"><div class="progress-bar" style="width: ' + progress + '%"></div></div>'
                        : '-';

                    // æ£€æŸ¥æ˜¯å¦æ˜¯PyPIç±»å‹çš„æºï¼ˆæ”¯æŒä¸´æ—¶å•æ¬¡åŒæ­¥ï¼‰
                    const isPyPI = (s.type === 'http' && (s.url || '').includes('pypi'));

                    return '<tr>' +
                        '<td><strong>' + s.name + '</strong></td>' +
                        '<td><span class="badge badge-info">' + (s.type || 'http') + '</span></td>' +
                        '<td><code>' + (s.target || '-') + '</code></td>' +
                        '<td>' + statusBadge + '</td>' +
                        '<td>' + progressBar + '</td>' +
                        '<td><span class="badge ' + (scheduleEnabled ? 'badge-warning' : 'badge-secondary') + '">' + (scheduleEnabled ? 'â° å®šæ—¶' : 'æ‰‹åŠ¨') + '</span></td>' +
                        '<td>' +
                        '<button class="btn btn-secondary btn-sm" onclick="editSyncSource(\'' + safeName + '\')" title="ç¼–è¾‘"><i class="fa-solid fa-edit"></i></button> ' +
                        (isPyPI ? '<button class="btn btn-primary btn-sm" onclick="showTempSyncModal(\'' + safeName + '\')" title="ä¸´æ—¶å•æ¬¡åŒæ­¥"><i class="fa-solid fa-bolt"></i></button> ' : '') +
                        '<button class="btn btn-' + (isRunning ? 'warning' : 'success') + ' btn-sm" onclick="toggleSync(\'' + safeName + '\')" title="' + (isRunning ? 'åœæ­¢åŒæ­¥' : 'å¼€å§‹åŒæ­¥') + '"><i class="fa-solid fa-' + (isRunning ? 'stop' : 'play') + '"></i></button> ' +
                        '<button class="btn btn-danger btn-sm" onclick="deleteSync(\'' + safeName + '\')" title="åˆ é™¤"><i class="fa-solid fa-trash"></i></button>' +
                        '</td></tr>';
                }).join('');
            } else {
                syncList.innerHTML = '<tr><td colspan="7" class="empty">æš‚æ— åŒæ­¥æº</td></tr>';
            }

            statusBadge.textContent = running ? 'è¿è¡Œä¸­' : 'ç©ºé—²';
            statusBadge.className = 'badge badge-' + (running ? 'success' : 'info');
        }

        // æ ¹æ®åŒæ­¥ç±»å‹æ˜¾ç¤º/éšè—é…ç½®å­—æ®µ
        function updateSyncTypeFields() {
            const type = document.getElementById('syncType').value;
            const urlGroup = document.getElementById('syncUrlGroup');
            const urlLabel = document.getElementById('syncUrlLabel');
            const cloudFields = document.getElementById('syncCloudFields');
            const ftpFields = document.getElementById('syncFtpFields');
            const localFields = document.getElementById('syncLocalFields');
            const targetGroup = document.getElementById('syncTargetGroup');

            // éšè—æ‰€æœ‰é¢å¤–å­—æ®µ
            cloudFields.style.display = 'none';
            ftpFields.style.display = 'none';
            localFields.style.display = 'none';
            targetGroup.style.display = 'none';

            // æ ¹æ®ç±»å‹æ˜¾ç¤ºå­—æ®µ
            switch(type) {
                case 'http':
                    urlLabel.textContent = 'æº URL';
                    urlGroup.style.display = 'block';
                    targetGroup.style.display = 'block';
                    break;
                case 'ftp':
                case 'sftp':
                    urlGroup.style.display = 'none';
                    ftpFields.style.display = 'block';
                    targetGroup.style.display = 'block';
                    break;
                case 'rsync':
                    urlLabel.textContent = 'Rsync æº';
                    urlGroup.style.display = 'block';
                    targetGroup.style.display = 'block';
                    break;
                case 'git':
                    urlLabel.textContent = 'Git ä»“åº“ URL';
                    urlGroup.style.display = 'block';
                    targetGroup.style.display = 'block';
                    break;
                case 's3':
                case 'oss':
                case 'cos':
                    urlGroup.style.display = 'none';
                    cloudFields.style.display = 'block';
                    targetGroup.style.display = 'block';
                    break;
                case 'local':
                    urlGroup.style.display = 'none';
                    localFields.style.display = 'block';
                    targetGroup.style.display = 'block';
                    break;
                case 'webdav':
                    urlLabel.textContent = 'WebDAV æœåŠ¡å™¨';
                    urlGroup.style.display = 'block';
                    ftpFields.style.display = 'block';
                    targetGroup.style.display = 'block';
                    break;
            }
        }

        async function addSyncSource() {
            try {
                const name = document.getElementById('syncName').value;
                const type = document.getElementById('syncType').value;
                const auto = document.getElementById('syncAuto').checked;

                if (!name) {
                    showNotification('è¯·å¡«å†™åç§°', 'warning');
                    return;
                }

                // å®šæ—¶åŒæ­¥é…ç½®
                const scheduleEnabledEl = document.getElementById('syncScheduleEnabled');
                const scheduleCronEl = document.getElementById('syncScheduleCron');
                const scheduleEnabled = scheduleEnabledEl ? scheduleEnabledEl.checked : false;
                const scheduleCron = scheduleCronEl ? scheduleCronEl.value.trim() : '';

                // æ„å»ºé…ç½®å¯¹è±¡
                let config = {
                    type: type,
                    enabled: true,
                    auto_sync: auto
                };

                // æ·»åŠ å®šæ—¶åŒæ­¥é…ç½®
                if (scheduleEnabled && scheduleCron) {
                    config.schedule = {
                        enabled: true,
                        cron: scheduleCron
                    };
                }

                // æ ¹æ®ç±»å‹æ”¶é›†é…ç½®
                switch(type) {
                    case 'http':
                    case 'rsync':
                    case 'git':
                    case 'webdav': {
                        const url = document.getElementById('syncUrl').value;
                        if (!url) { showNotification('è¯·å¡«å†™URL', 'warning'); return; }
                        config.url = url;
                        config.target = document.getElementById('syncTarget').value || name;
                        break;
                    }
                    case 'ftp':
                    case 'sftp': {
                        const host = document.getElementById('syncHost').value;
                        const port = document.getElementById('syncPort').value;
                        const username = document.getElementById('syncUsername').value;
                        const password = document.getElementById('syncPassword').value;
                        const remotePath = document.getElementById('syncRemotePath').value;
                        if (!host) { showNotification('è¯·å¡«å†™ä¸»æœºåœ°å€', 'warning'); return; }
                        config.host = host;
                        config.port = parseInt(port) || 21;
                        config.username = username || 'anonymous';
                        config.password = password;
                        config.remote_path = remotePath || '/';
                        config.target = document.getElementById('syncTarget').value || name;
                        break;
                    }
                    case 's3':
                    case 'oss':
                    case 'cos': {
                        const bucket = document.getElementById('syncBucket').value;
                        const accessKey = document.getElementById('syncAccessKey').value;
                        const secretKey = document.getElementById('syncSecretKey').value;
                        const region = document.getElementById('syncRegion').value;
                        const prefix = document.getElementById('syncPrefix').value;
                        if (!bucket || !accessKey || !secretKey) { showNotification('è¯·å¡«å†™Bucketå’Œå¯†é’¥ä¿¡æ¯', 'warning'); return; }
                        config.bucket = bucket;
                        config.access_key = accessKey;
                        config.secret_key = secretKey;
                        config.region = region;
                        if (prefix) config.prefix = prefix;
                        config.target = document.getElementById('syncTarget').value || name;
                        break;
                    }
                    case 'local': {
                        const localPath = document.getElementById('syncLocalPath').value;
                        if (!localPath) { showNotification('è¯·å¡«å†™æœ¬åœ°è·¯å¾„', 'warning'); return; }
                        config.path = localPath;
                        config.target = document.getElementById('syncTarget').value || name;
                        break;
                    }
                }

                console.log('å‡†å¤‡æ·»åŠ åŒæ­¥æº:', name, config);
                const result = await apiRequest('/api/v1/sync/sources', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, config })
                });
                console.log('æ·»åŠ ç»“æœ:', result);

                hideModal('addSyncModal');
                loadSync();
                if (result.success) {
                    showNotification('åŒæ­¥æºæ·»åŠ æˆåŠŸ', 'success');
                } else {
                    showNotification('æ·»åŠ å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯'), 'error');
                }
            } catch (e) {
                console.error('æ·»åŠ åŒæ­¥æºå¤±è´¥:', e);
                showNotification('æ·»åŠ åŒæ­¥æºå¤±è´¥: ' + e.message, 'error');
            }
        }

        // å­˜å‚¨å½“å‰åŒæ­¥æºæ•°æ®
        let currentSyncSources = [];

        // ç¼–è¾‘åŒæ­¥æº - æ‰“å¼€ç¼–è¾‘å¯¹è¯æ¡†
        async function editSyncSource(name) {
            try {
                // è·å–åŒæ­¥æºåˆ—è¡¨
                const sources = await apiRequest('/api/v1/sync/sources');
                const source = sources.sources.find(s => s.name === name);

                if (!source) {
                    showNotification('åŒæ­¥æºä¸å­˜åœ¨', 'error');
                    return;
                }

                // å­˜å‚¨å½“å‰åŒæ­¥æºåˆ—è¡¨
                currentSyncSources = sources.sources;

                // å…ˆæ˜¾ç¤ºå¯¹è¯æ¡†ï¼ˆé¿å… showModal æ¸…ç©ºæ•°æ®ï¼‰
                showModal('editSyncModal');

                // å¡«å……åŸºæœ¬å­—æ®µ
                document.getElementById('editSyncName').value = name;
                document.getElementById('editSyncType').value = source.type || 'http';
                document.getElementById('editSyncTarget').value = source.target || '';
                document.getElementById('editSyncAuto').checked = source.auto_sync !== false;

                // å®šæ—¶åŒæ­¥é…ç½®
                const schedule = source.schedule || {};
                document.getElementById('editSyncScheduleEnabled').checked = schedule.enabled || false;
                document.getElementById('editSyncScheduleCron').value = schedule.cron || '0 2 * * *';

                // æ ¹æ®ç±»å‹å¡«å……å­—æ®µ
                const type = source.type || 'http';

                if (type === 'http' || type === 'rsync' || type === 'git' || type === 'webdav') {
                    document.getElementById('editSyncUrl').value = source.url || '';
                } else if (type === 'ftp' || type === 'sftp') {
                    document.getElementById('editSyncHost').value = source.host || '';
                    document.getElementById('editSyncPort').value = source.port || 21;
                    document.getElementById('editSyncUsername').value = source.username || '';
                    document.getElementById('editSyncPassword').value = source.password || '';
                    document.getElementById('editSyncRemotePath').value = source.remote_path || '/';
                } else if (type === 's3' || type === 'oss' || type === 'cos') {
                    document.getElementById('editSyncBucket').value = source.bucket || '';
                    document.getElementById('editSyncAccessKey').value = source.access_key || '';
                    document.getElementById('editSyncSecretKey').value = source.secret_key || '';
                    document.getElementById('editSyncRegion').value = source.region || '';
                    document.getElementById('editSyncPrefix').value = source.prefix || '';
                } else if (type === 'local') {
                    document.getElementById('editSyncLocalPath').value = source.path || '';
                }

                // æ›´æ–°å­—æ®µæ˜¾ç¤º
                updateEditSyncTypeFields();
            } catch (e) {
                console.error('è·å–åŒæ­¥æºä¿¡æ¯å¤±è´¥:', e);
                showNotification('è·å–åŒæ­¥æºä¿¡æ¯å¤±è´¥: ' + e.message, 'error');
            }
        }

        // æ ¹æ®åŒæ­¥ç±»å‹æ˜¾ç¤º/éšè—ç¼–è¾‘é…ç½®å­—æ®µ
        function updateEditSyncTypeFields() {
            const type = document.getElementById('editSyncType').value;
            const urlGroup = document.getElementById('editSyncUrlGroup');
            const urlLabel = document.getElementById('editSyncUrlLabel');
            const cloudFields = document.getElementById('editSyncCloudFields');
            const ftpFields = document.getElementById('editSyncFtpFields');
            const localFields = document.getElementById('editSyncLocalFields');
            const targetGroup = document.getElementById('editSyncTargetGroup');

            // éšè—æ‰€æœ‰é¢å¤–å­—æ®µ
            cloudFields.style.display = 'none';
            ftpFields.style.display = 'none';
            localFields.style.display = 'none';
            targetGroup.style.display = 'none';

            // æ ¹æ®ç±»å‹æ˜¾ç¤ºå¯¹åº”å­—æ®µ
            if (type === 'http' || type === 'rsync' || type === 'git' || type === 'webdav') {
                urlGroup.style.display = 'block';
                targetGroup.style.display = 'block';
                if (type === 'http') urlLabel.textContent = 'æº URL';
                else if (type === 'rsync') urlLabel.textContent = 'Rsync æº';
                else if (type === 'git') urlLabel.textContent = 'Git ä»“åº“ URL';
                else urlLabel.textContent = 'WebDAV URL';
            } else if (type === 'ftp' || type === 'sftp') {
                ftpFields.style.display = 'block';
                targetGroup.style.display = 'block';
            } else if (type === 's3' || type === 'oss' || type === 'cos') {
                cloudFields.style.display = 'block';
                targetGroup.style.display = 'block';
            } else if (type === 'local') {
                localFields.style.display = 'block';
                targetGroup.style.display = 'block';
            }
        }

        // ä¿å­˜ç¼–è¾‘åçš„åŒæ­¥æº
        async function saveEditSyncSource() {
            try {
                const name = document.getElementById('editSyncName').value;
                const type = document.getElementById('editSyncType').value;
                const auto = document.getElementById('editSyncAuto').checked;

                if (!name) {
                    showNotification('åŒæ­¥æºåç§°ä¸èƒ½ä¸ºç©º', 'warning');
                    return;
                }

                // å®šæ—¶åŒæ­¥é…ç½®
                const scheduleEnabledEl = document.getElementById('editSyncScheduleEnabled');
                const scheduleCronEl = document.getElementById('editSyncScheduleCron');
                const scheduleEnabled = scheduleEnabledEl ? scheduleEnabledEl.checked : false;
                const scheduleCron = scheduleCronEl ? scheduleCronEl.value.trim() : '';

                // æ„å»ºé…ç½®å¯¹è±¡
                let config = {
                    type: type,
                    enabled: true,
                    auto_sync: auto
                };

                // æ·»åŠ å®šæ—¶åŒæ­¥é…ç½®
                if (scheduleEnabled && scheduleCron) {
                    config.schedule = {
                        enabled: true,
                        cron: scheduleCron
                    };
                }

                // æ ¹æ®ç±»å‹æ”¶é›†é…ç½®
                switch(type) {
                    case 'http':
                    case 'rsync':
                    case 'git':
                    case 'webdav': {
                        const url = document.getElementById('editSyncUrl').value;
                        if (!url) { showNotification('è¯·å¡«å†™URL', 'warning'); return; }
                        config.url = url;
                        config.target = document.getElementById('editSyncTarget').value || name;
                        break;
                    }
                    case 'ftp':
                    case 'sftp': {
                        const host = document.getElementById('editSyncHost').value;
                        const port = document.getElementById('editSyncPort').value;
                        const username = document.getElementById('editSyncUsername').value;
                        const password = document.getElementById('editSyncPassword').value;
                        const remotePath = document.getElementById('editSyncRemotePath').value;
                        if (!host) { showNotification('è¯·å¡«å†™ä¸»æœºåœ°å€', 'warning'); return; }
                        config.host = host;
                        config.port = parseInt(port) || 21;
                        config.username = username || 'anonymous';
                        config.password = password;
                        config.remote_path = remotePath || '/';
                        config.target = document.getElementById('editSyncTarget').value || name;
                        break;
                    }
                    case 's3':
                    case 'oss':
                    case 'cos': {
                        const bucket = document.getElementById('editSyncBucket').value;
                        const accessKey = document.getElementById('editSyncAccessKey').value;
                        const secretKey = document.getElementById('editSyncSecretKey').value;
                        const region = document.getElementById('editSyncRegion').value;
                        const prefix = document.getElementById('editSyncPrefix').value;
                        if (!bucket || !accessKey || !secretKey) { showNotification('è¯·å¡«å†™Bucketå’Œå¯†é’¥ä¿¡æ¯', 'warning'); return; }
                        config.bucket = bucket;
                        config.access_key = accessKey;
                        config.secret_key = secretKey;
                        config.region = region;
                        if (prefix) config.prefix = prefix;
                        config.target = document.getElementById('editSyncTarget').value || name;
                        break;
                    }
                    case 'local': {
                        const localPath = document.getElementById('editSyncLocalPath').value;
                        if (!localPath) { showNotification('è¯·å¡«å†™æœ¬åœ°è·¯å¾„', 'warning'); return; }
                        config.path = localPath;
                        config.target = document.getElementById('editSyncTarget').value || name;
                        break;
                    }
                }

                console.log('å‡†å¤‡ç¼–è¾‘åŒæ­¥æº:', name, config);

                // ä½¿ç”¨ PUT æ–¹æ³•æ›´æ–°åŒæ­¥æº
                const result = await apiRequest('/api/v1/sync/sources/' + name, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, config })
                });
                console.log('ç¼–è¾‘ç»“æœ:', result);

                hideModal('editSyncModal');
                loadSync();
                if (result.success) {
                    showNotification('åŒæ­¥æºæ›´æ–°æˆåŠŸ', 'success');
                } else {
                    showNotification('æ›´æ–°å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯'), 'error');
                }
            } catch (e) {
                console.error('ç¼–è¾‘åŒæ­¥æºå¤±è´¥:', e);
                showNotification('ç¼–è¾‘åŒæ­¥æºå¤±è´¥: ' + e.message, 'error');
            }
        }

        async function startSync(name) {
            await apiRequest('/api/v1/sync/start', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ sources: [name] })
            });
            loadSync();
            showNotification('åŒæ­¥ä»»åŠ¡å·²å¯åŠ¨', 'success');
        }

        async function stopSync() {
            await apiRequest('/api/v1/sync/stop', { method: 'POST' });
            loadSync();
            showNotification('åŒæ­¥å·²åœæ­¢', 'info');
        }

        // åˆ‡æ¢åŒæ­¥çŠ¶æ€ï¼ˆå¼€å§‹/åœæ­¢ï¼‰
        async function toggleSync(name) {
            const status = await apiRequest('/api/v1/sync/status');
            console.log('åŒæ­¥çŠ¶æ€:', status);
            // statusç›´æ¥æ˜¯å­—å…¸æ ¼å¼: {source_name: {...}}
            const sourceStatusData = status?.[name];
            const sourceStatus = sourceStatusData?.status || 'stopped';
            // åªæœ‰ 'syncing' æ‰è¡¨ç¤ºæ­£åœ¨è¿è¡Œï¼Œ'completed' å’Œ 'stopped' éƒ½åº”è¯¥å¯ä»¥å¯åŠ¨
            const isRunning = sourceStatus === 'syncing';
            console.log('æºçŠ¶æ€:', sourceStatus, 'æ˜¯å¦è¿è¡Œ:', isRunning);

            if (isRunning) {
                console.log('æ‰§è¡Œåœæ­¢æ“ä½œ');
                await apiRequest('/api/v1/sync/stop', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: name })
                });
                showNotification('åŒæ­¥å·²åœæ­¢', 'info');
            } else {
                console.log('æ‰§è¡Œå¯åŠ¨æ“ä½œ');
                await apiRequest('/api/v1/sync/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: name })
                });
                showNotification('åŒæ­¥ä»»åŠ¡å·²å¯åŠ¨', 'success');
            }
            loadSync();
        }

        async function deleteSync(name) {
            if (!confirm('ç¡®å®šåˆ é™¤åŒæ­¥æº ' + name + 'ï¼Ÿ')) return;
            await apiRequest('/api/v1/sync/sources/' + name, { method: 'DELETE' });
            loadSync();
            showNotification('åŒæ­¥æºå·²åˆ é™¤', 'success');
        }

        // åŠ è½½åŒæ­¥å†å²è®°å½•
        async function loadSyncHistory() {
            try {
                const response = await apiRequest('/api/v2/sync/history?limit=100');
                const history = response.history || [];
                const historyList = document.getElementById('syncHistory');

                if (!historyList) return;

                if (history.length === 0) {
                    historyList.innerHTML = '<tr><td colspan="7" class="empty">æš‚æ— åŒæ­¥è®°å½•</td></tr>';
                    return;
                }

                historyList.innerHTML = history.map(h => {
                    const statusBadge = h.status === 'completed'
                        ? '<span class="badge badge-success">å®Œæˆ</span>'
                        : '<span class="badge badge-danger">å¤±è´¥</span>';

                    const date = h.last_sync ? new Date(h.last_sync).toLocaleString() : '-';

                    return `<tr>
                        <td>${h.source_name || '-'}</td>
                        <td>æ‰‹åŠ¨åŒæ­¥</td>
                        <td>${statusBadge}</td>
                        <td>${h.files_synced || 0} / ${h.total_files || 0}</td>
                        <td>-</td>
                        <td>${date}</td>
                        <td>${h.error ? '<span style="color: var(--error);">'+ h.error +'</span>' : '-'}</td>
                    </tr>`;
                }).join('');
            } catch (e) {
                console.error('åŠ è½½åŒæ­¥å†å²å¤±è´¥:', e);
            }
        }

        // æ˜¾ç¤ºä¸´æ—¶åŒæ­¥å¼¹çª—
        function showTempSyncModal(sourceName) {
            document.getElementById('tempSyncSource').value = sourceName;
            document.getElementById('tempSyncPackages').value = '';
            document.getElementById('tempSyncModal').style.display = 'flex';
        }

        // æ‰§è¡Œä¸´æ—¶åŒæ­¥
        async function doTempSync() {
            const source = document.getElementById('tempSyncSource').value;
            const packagesStr = document.getElementById('tempSyncPackages').value.trim();

            if (!packagesStr) {
                showNotification('è¯·è¾“å…¥è¦åŒæ­¥çš„åŒ…å', 'error');
                return;
            }

            // è§£æåŒ…ååˆ—è¡¨ï¼ˆæ”¯æŒé€—å·ã€ç©ºæ ¼ã€æ¢è¡Œåˆ†éš”ï¼‰
            const packages = packagesStr.split(/[, \n]+/).map(p => p.trim()).filter(p => p);

            if (packages.length === 0) {
                showNotification('è¯·è¾“å…¥æœ‰æ•ˆçš„åŒ…å', 'error');
                return;
            }

            try {
                const response = await apiRequest('/api/v2/sync/packages', {
                    method: 'POST',
                    body: JSON.stringify({ source: source, packages: packages })
                });

                if (response.success) {
                    showNotification('ä¸´æ—¶åŒæ­¥å·²å¯åŠ¨: ' + packages.slice(0, 3).join(', ') + (packages.length > 3 ? '...' : ''), 'success');
                    document.getElementById('tempSyncModal').style.display = 'none';
                    // åˆ·æ–°åŒæ­¥åˆ—è¡¨
                    loadSync();
                } else {
                    showNotification(response.error || 'å¯åŠ¨åŒæ­¥å¤±è´¥', 'error');
                }
            } catch (e) {
                showNotification('åŒæ­¥å¤±è´¥: ' + e.message, 'error');
            }
        }

        // ============ åŠ é€Ÿæº ============
        // æ˜¾ç¤ºæ·»åŠ å¼¹çª—
        function showAddMirrorModal() {
            document.getElementById('addMirrorModal').style.display = 'flex';
            // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
            document.body.style.overflow = 'hidden';
            // æ¸…ç©ºè¡¨å•
            document.getElementById('newMirrorName').value = '';
            document.getElementById('newMirrorType').value = 'http';
            document.getElementById('newMirrorUrl').value = '';
            document.getElementById('newMirrorTarget').value = '';
            document.getElementById('newMirrorDesc').value = '';
            document.getElementById('newMirrorEnabled').checked = true;
        }

        // æ·»åŠ åŠ é€Ÿæº
        async function addMirror() {
            const name = document.getElementById('newMirrorName').value.trim();
            const type = document.getElementById('newMirrorType').value;
            const url = document.getElementById('newMirrorUrl').value.trim();
            const target = document.getElementById('newMirrorTarget').value.trim();
            const storageDir = document.getElementById('newMirrorStorageDir').value.trim();
            const desc = document.getElementById('newMirrorDesc').value.trim();
            const enabled = document.getElementById('newMirrorEnabled').checked;

            // éªŒè¯è¾“å…¥
            if (!name) {
                showNotification('è¯·è¾“å…¥åŠ é€Ÿæºåç§°', 'warning');
                return;
            }
            // éªŒè¯åç§°æ ¼å¼
            if (!/^[a-zA-Z][a-zA-Z0-9_-]*$/.test(name)) {
                showNotification('åç§°å¿…é¡»ä»¥å­—æ¯å¼€å¤´ï¼Œåªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œè¿å­—ç¬¦', 'warning');
                return;
            }
            if (!url) {
                showNotification('è¯·è¾“å…¥ä¸Šæ¸¸åœ°å€', 'warning');
                return;
            }

            // æ„å»ºè¯·æ±‚æ•°æ®
            const mirrorData = {
                name: name,
                type: type,
                url: url,
                target: target,
                description: desc,
                enabled: enabled,
                custom: true
            };

            // æ·»åŠ å­˜å‚¨ç›®å½•ï¼ˆå¦‚æœç”¨æˆ·æŒ‡å®šäº†ï¼‰
            if (storageDir) {
                mirrorData.storage_dir = storageDir;
            }

            try {
                const result = await apiRequest('/api/v2/mirrors', {
                    method: 'POST',
                    body: JSON.stringify(mirrorData)
                });

                if (result.success) {
                    showNotification(`åŠ é€Ÿæº '${name}' æ·»åŠ æˆåŠŸ`, 'success');
                    closeAddMirrorModal();
                    loadMirrors();
                } else {
                    showNotification(`æ·»åŠ å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (e) {
                showNotification(`æ·»åŠ å¤±è´¥: ${e.message}`, 'error');
            }
        }

        // å…³é—­æ·»åŠ å¼¹çª—
        function closeAddMirrorModal() {
            document.getElementById('addMirrorModal').style.display = 'none';
            // æ¢å¤èƒŒæ™¯æ»šåŠ¨
            document.body.style.overflow = '';
        }

        // åŠ è½½é•œåƒåˆ—è¡¨
        async function loadMirrors() {
            try {
                const mirrors = await apiRequest('/api/v2/mirrors');
                if (!mirrors || mirrors.error) {
                    document.getElementById('mirrorList').innerHTML = '<div style="text-align: center; padding: 40px; color: var(--danger);">åŠ è½½å¤±è´¥: ' + (mirrors?.error || 'æœªçŸ¥é”™è¯¯') + '</div>';
                    return;
                }

                const mirrorData = mirrors?.mirrors || {};
                const mirrorEntries = Object.entries(mirrorData);

                if (mirrorEntries.length === 0) {
                    document.getElementById('mirrorList').innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-muted);"><i class="fa-solid fa-ghost" style="font-size: 32px; margin-bottom: 10px;"></i><div>æš‚æ— åŠ é€Ÿæº</div><div style="margin-top: 10px;">ç‚¹å‡»å³ä¸Šè§’"æ·»åŠ åŠ é€Ÿæº"æŒ‰é’®åˆ›å»º</div></div>';
                    return;
                }

                const typeIcons = {
                    'docker': 'ğŸ³',
                    'apt': 'ğŸ“¦',
                    'yum': 'ğŸ¯',
                    'pacman': 'ğŸ”µ',
                    'pypi': 'ğŸ',
                    'npm': 'ğŸ“¦',
                    'go': 'ğŸ”·',
                    'maven': 'ğŸ«™',
                    'gradle': 'ğŸ”¨',
                    'gem': 'ğŸ’',
                    'cargo': 'ğŸ¦€',
                    'nuget': 'ğŸ“š',
                    'cocoapods': 'ğŸ',
                    'cran': 'ğŸ“Š',
                    'ctan': 'ğŸ“',
                    'cuda': 'ğŸ®',
                    'http': 'ğŸŒ'
                };

                const html = mirrorEntries.map(([name, data]) => {
                    const enabled = data?.enabled !== false;
                    const type = data?.type || 'http';
                    const url = data?.url || '';
                    const target = data?.target || '';
                    const desc = data?.description || '';
                    const safeName = name.replace(/'/g, "\\'");

                    return `
                        <div style="padding: 16px; background: var(--bg-input); border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                            <div style="flex: 1; min-width: 0;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                    <span style="font-size: 20px;">${typeIcons[type] || 'ğŸŒ'}</span>
                                    <strong style="font-size: 15px;">${name}</strong>
                                    <span class="badge badge-${enabled ? 'success' : 'danger'}">${enabled ? 'å¯ç”¨' : 'ç¦ç”¨'}</span>
                                    <span class="badge badge-info">${type}</span>
                                </div>
                                <div style="color: var(--text-muted); font-size: 12px; margin-bottom: 4px;">${desc || ''}</div>
                                ${url ? '<div style="color: var(--info); font-size: 12px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">' + url + '</div>' : ''}
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; margin-left: 16px;">
                                <button onclick="editMirror('${safeName}')" class="btn btn-secondary" style="padding: 6px 10px; font-size: 12px;" title="ç¼–è¾‘">
                                    <i class="fa-solid fa-pen"></i>
                                </button>
                                <label class="switch" title="å¯ç”¨/ç¦ç”¨">
                                    <input type="checkbox" ${enabled ? 'checked' : ''} onchange="toggleMirror('${safeName}', this.checked)">
                                    <span class="switch-slider"></span>
                                </label>
                                <button onclick="deleteMirror('${safeName}')" class="btn btn-danger" style="padding: 6px 10px; font-size: 12px;" title="åˆ é™¤">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');

                document.getElementById('mirrorList').innerHTML = html;

                // ç”Ÿæˆä½¿ç”¨è¯´æ˜
                generateMirrorUsageGuide(mirrorData);
            } catch (e) {
                console.error('Failed to load mirrors:', e);
                document.getElementById('mirrorList').innerHTML = '<div style="text-align: center; padding: 40px; color: var(--danger);">åŠ è½½å¤±è´¥</div>';
            }
        }

        // ç”ŸæˆåŠ é€Ÿæºä½¿ç”¨è¯´æ˜
        function generateMirrorUsageGuide(mirrors) {
            const container = document.getElementById('mirrorUsageGuide');
            if (!container) return;

            const serverUrl = window.location.protocol + '//' + window.location.host;
            const enabledMirrors = Object.entries(mirrors).filter(([_, data]) => data?.enabled !== false);

            if (enabledMirrors.length === 0) {
                container.innerHTML = `
                    <div style="color: var(--text-muted); text-align: center; padding: 20px;">
                        <i class="fa-solid fa-info-circle" style="font-size: 24px; margin-bottom: 10px;"></i>
                        <div>æ·»åŠ åŠ é€Ÿæºåï¼Œæ­¤å¤„å°†æ˜¾ç¤ºå¯¹åº”çš„ä½¿ç”¨å‘½ä»¤</div>
                    </div>
                `;
                return;
            }

            // æ¯ç§ç±»å‹çš„ä½¿ç”¨å‘½ä»¤æ¨¡æ¿
            const usageTemplates = {
                'docker': (name, data) => ({
                    title: `${name} - Docker é•œåƒ`,
                    cmd: `docker pull ${serverUrl}/api/v2/mirrors/docker/library/ubuntu:22.04`
                }),
                'apt': (name, data) => ({
                    title: `${name} - APT (Ubuntu/Debian)`,
                    cmd: `echo "deb ${serverUrl}/api/v2/mirrors/apt/ubuntu/ jammy main" | sudo tee /etc/apt/sources.list`
                }),
                'yum': (name, data) => ({
                    title: `${name} - YUM/DNF (CentOS/RHEL)`,
                    cmd: `sudo sed -i 's|^baseurl=.*|baseurl=${serverUrl}/api/v2/mirrors/yum/centos/$releasever/|' /etc/yum.repos.d/*.repo`
                }),
                'pypi': (name, data) => ({
                    title: `${name} - PyPI`,
                    cmd: `pip config set global.index-url ${serverUrl}/api/v2/mirrors/pypi/simple`
                }),
                'npm': (name, data) => ({
                    title: `${name} - npm`,
                    cmd: `npm config set registry ${serverUrl}/api/v2/mirrors/npm/`
                }),
                'go': (name, data) => ({
                    title: `${name} - Go æ¨¡å—`,
                    cmd: `export GOPROXY=${serverUrl}/api/v2/mirrors/go,direct`
                }),
                'maven': (name, data) => ({
                    title: `${name} - Maven`,
                    cmd: `<settings><mirrors><mirror><id>hyc</id><url>${serverUrl}/api/v2/mirrors/maven</url></mirror></mirrors></settings>`
                }),
                'gradle': (name, data) => ({
                    title: `${name} - Gradle`,
                    cmd: `gradle.properties: maven { url "${serverUrl}/api/v2/mirrors/maven" }`
                }),
                'gem': (name, data) => ({
                    title: `${name} - RubyGems`,
                    cmd: `gem sources --add ${serverUrl}/api/v2/mirrors/gem/ --remove https://rubygems.org/`
                }),
                'cargo': (name, data) => ({
                    title: `${name} - Cargo (Rust)`,
                    cmd: `~/.cargo/config.toml: [source.crates-io]\nreplace-with = "hyc"\n[source.hyc]\nregistry = "${serverUrl}/api/v2/mirrors/cargo"`
                }),
                'nuget': (name, data) => ({
                    title: `${name} - NuGet`,
                    cmd: `nuget config -AsPath http://${window.location.host}/api/v2/mirrors/nuget`
                }),
                'cocoapods': (name, data) => ({
                    title: `${name} - CocoaPods`,
                    cmd: `Podfile: source '${serverUrl}/cocoapods/'`
                }),
                'cran': (name, data) => ({
                    title: `${name} - CRAN (R)`,
                    cmd: `R: options(repos = c(CRAN = "${serverUrl}/cran/"))`
                }),
                'ctan': (name, data) => ({
                    title: `${name} - CTAN (LaTeX)`,
                    cmd: `tlmgr option repository ${serverUrl}/ctan/`
                }),
                'pacman': (name, data) => ({
                    title: `${name} - Pacman (Arch Linux)`,
                    cmd: `/etc/pacman.d/mirrorlist: Server = ${serverUrl}/pacman/$arch`
                }),
                'alpine': (name, data) => ({
                    title: `${name} - Alpine Linux`,
                    cmd: `/etc/apk/repositories: ${serverUrl}/alpine/v\${VERSION_ID}/main`
                }),
                'arch': (name, data) => ({
                    title: `${name} - Arch Linux`,
                    cmd: `/etc/pacman.d/mirrorlist: Server = ${serverUrl}/arch/$repo/os/$arch`
                }),
                'yarn': (name, data) => ({
                    title: `${name} - Yarn`,
                    cmd: `yarn config set registry ${serverUrl}/api/v2/mirrors/yarn/`
                }),
                'composer': (name, data) => ({
                    title: `${name} - Composer (PHP)`,
                    cmd: `composer config -g repo.packagist composer ${serverUrl}/api/v2/mirrors/composer/`
                }),
                'conan': (name, data) => ({
                    title: `${name} - Conan (C++)`,
                    cmd: `conan remote add hyc ${serverUrl}/api/v2/mirrors/conan False`
                }),
                'bower': (name, data) => ({
                    title: `${name} - Bower`,
                    cmd: `.bowerrc: { "registry": "${serverUrl}/api/v2/mirrors/bower/" }`
                }),
                'helm': (name, data) => ({
                    title: `${name} - Helm Charts`,
                    cmd: `helm repo add hyc ${serverUrl}/api/v2/mirrors/helm/`
                }),
                'flutter': (name, data) => ({
                    title: `${name} - Flutter`,
                    cmd: `flutter config --build-dir ${serverUrl}/api/v2/mirrors/flutter/`
                }),
                'homebrew': (name, data) => ({
                    title: `${name} - Homebrew`,
                    cmd: `echo 'BREW_REPO="${serverUrl}/api/v2/mirrors/homebrew/"' >> ~/.bashrc`
                }),
                'chocolatey': (name, data) => ({
                    title: `${name} - Chocolatey (Windows)`,
                    cmd: `choco source add -n=hyc -s="${serverUrl}/api/v2/mirrors/chocolatey/" --priority=1`
                }),
                'snap': (name, data) => ({
                    title: `${name} - Snap Store`,
                    cmd: `snap set system proxy.http=${serverUrl}`
                }),
                'nix': (name, data) => ({
                    title: `${name} - Nix/NixOS`,
                    cmd: `mkdir -p ~/.config/nix && echo 'substituters = ${serverUrl}/api/v2/mirrors/nix/' >> ~/.config/nix/nix.conf`
                }),
                'gentoo': (name, data) => ({
                    title: `${name} - Gentoo`,
                    cmd: `/etc/portage/make.conf: GENTOO_MIRRORS="${serverUrl}/api/v2/mirrors/gentoo/"`
                }),
                'centos': (name, data) => ({
                    title: `${name} - CentOS`,
                    cmd: `sudo sed -i 's|mirror.centos.org|${serverUrl}/api/v2/mirrors/centos|g' /etc/yum.repos.d/*.repo`
                }),
                'debian': (name, data) => ({
                    title: `${name} - Debian`,
                    cmd: `echo "deb ${serverUrl}/api/v2/mirrors/debian/ bullseye main" | sudo tee /etc/apt/sources.list`
                }),
                'fedora': (name, data) => ({
                    title: `${name} - Fedora`,
                    cmd: `sudo sed -i 's|download.fedoraproject.org|${serverUrl}/api/v2/mirrors/fedora|g' /etc/yum.repos.d/*.repo`
                }),
                'cuda': (name, data) => ({
                    title: `${name} - NVIDIA CUDA`,
                    cmd: `cuda-repos.conf: ${serverUrl}/cuda/`
                }),
                'custom': (name, data) => ({
                    title: `${name} - è‡ªå®šä¹‰HTTP`,
                    cmd: `${serverUrl}/api/v2/mirrors/custom/`
                }),
                // æ›´å¤šåŒ…ç®¡ç†å™¨ç”¨æ³•
                'pip': (name, data) => ({
                    title: `${name} - pip`,
                    cmd: `pip config set global.index-url ${serverUrl}/api/v2/mirrors/pypi/simple`
                }),
                'pipenv': (name, data) => ({
                    title: `${name} - Pipenv`,
                    cmd: `[[source]]
url = "${serverUrl}/api/v2/mirrors/pypi/simple"
verify_ssl = true`
                }),
                'poetry': (name, data) => ({
                    title: `${name} - Poetry`,
                    cmd: `poetry source add hyc ${serverUrl}/api/v2/mirrors/pypi/simple`
                }),
                'pnpm': (name, data) => ({
                    title: `${name} - pnpm`,
                    cmd: `pnpm config set registry ${serverUrl}/api/v2/mirrors/pnpm/`
                }),
                'pub': (name, data) => ({
                    title: `${name} - Pub.dev`,
                    cmd: `dart pub cache add --global [package] --source ${serverUrl}/api/v2/mirrors/pub/`
                }),
                'dart': (name, data) => ({
                    title: `${name} - Dart SDK`,
                    cmd: `${serverUrl}/api/v2/mirrors/dart/`
                }),
                'elm': (name, data) => ({
                    title: `${name} - Elm`,
                    cmd: `elm install ${serverUrl}/api/v2/mirrors/elm/`
                }),
                'hackage': (name, data) => ({
                    title: `${name} - Hackage`,
                    cmd: `${serverUrl}/api/v2/mirrors/hackage/`
                }),
                'opam': (name, data) => ({
                    title: `${name} - OPAM`,
                    cmd: `opam repository add hyc ${serverUrl}/api/v2/mirrors/opam/`
                }),
                'dub': (name, data) => ({
                    title: `${name} - Dub`,
                    cmd: `dub addregistry ${serverUrl}/api/v2/mirrors/dub/`
                }),
                'nimble': (name, data) => ({
                    title: `${name} - Nimble`,
                    cmd: `${serverUrl}/api/v2/mirrors/nimble/`
                }),
                'julia': (name, data) => ({
                    title: `${name} - Julia`,
                    cmd: `Pkg.add("Package") # Set ENV["JULIA_PKG_SERVER"]="${serverUrl}/api/v2/mirrors/julia/"`
                }),
                'lua': (name, data) => ({
                    title: `${name} - LuaRocks`,
                    cmd: `luarocks install --server=${serverUrl}/api/v2/mirrors/lua/ [package]`
                }),
                'luarocks': (name, data) => ({
                    title: `${name} - LuaRocks`,
                    cmd: `luarocks config rocks_servers ${serverUrl}/api/v2/mirrors/luarocks/`
                }),
                // Linux å‘è¡Œç‰ˆ
                'alpine': (name, data) => ({
                    title: `${name} - Alpine`,
                    cmd: `echo "${serverUrl}/api/v2/mirrors/alpine/v\${VERSION_ID}/main" > /etc/apk/repositories`
                }),
                'arch': (name, data) => ({
                    title: `${name} - Arch Linux`,
                    cmd: `Server = ${serverUrl}/api/v2/mirrors/arch/\$repo/os/\$arch`
                }),
                'aur': (name, data) => ({
                    title: `${name} - AUR`,
                    cmd: `${serverUrl}/api/v2/mirrors/aur/`
                }),
                'centos': (name, data) => ({
                    title: `${name} - CentOS`,
                    cmd: `sed -i 's|mirror.centos.org|${serverUrl}/api/v2/mirrors/centos|g' /etc/yum.repos.d/*.repo`
                }),
                'debian': (name, data) => ({
                    title: `${name} - Debian`,
                    cmd: `echo "deb ${serverUrl}/api/v2/mirrors/debian/ bookworm main" > /etc/apt/sources.list`
                }),
                'fedora': (name, data) => ({
                    title: `${name} - Fedora`,
                    cmd: `sed -i 's|download.fedoraproject.org|${serverUrl}/api/v2/mirrors/fedora|g' /etc/yum.repos.d/*.repo`
                }),
                'gentoo': (name, data) => ({
                    title: `${name} - Gentoo`,
                    cmd: `GENTOO_MIRRORS="${serverUrl}/api/v2/mirrors/gentoo/"`
                }),
                'opensuse': (name, data) => ({
                    title: `${name} - openSUSE`,
                    cmd: `${serverUrl}/api/v2/mirrors/opensuse/`
                }),
                'void': (name, data) => ({
                    title: `${name} - Void Linux`,
                    cmd: `echo "repository=${serverUrl}/api/v2/mirrors/void/x86_64" >> /etc/xbps.d/00-repository-main.conf`
                }),
                'freebsd': (name, data) => ({
                    title: `${name} - FreeBSD`,
                    cmd: `echo "PACKAGESITE:${serverUrl}/api/v2/mirrors/freebsd/" >> /etc/pkg.conf`
                }),
                'netbsd': (name, data) => ({
                    title: `${name} - NetBSD`,
                    cmd: `${serverUrl}/api/v2/mirrors/netbsd/`
                }),
                'openbsd': (name, data) => ({
                    title: `${name} - OpenBSD`,
                    cmd: `echo "installpath=${serverUrl}/api/v2/mirrors/openbsd/" >> /etc/pkg.conf`
                }),
                'rocky': (name, data) => ({
                    title: `${name} - Rocky Linux`,
                    cmd: `sed -i 's|repo.rockylinux.org|${serverUrl}/api/v2/mirrors/rocky|g' /etc/yum.repos.d/*.repo`
                }),
                'alma': (name, data) => ({
                    title: `${name} - AlmaLinux`,
                    cmd: `sed -i 's|repo.almalinux.org|${serverUrl}/api/v2/mirrors/alma|g' /etc/yum.repos.d/*.repo`
                }),
                'kali': (name, data) => ({
                    title: `${name} - Kali Linux`,
                    cmd: `echo "deb ${serverUrl}/api/v2/mirrors/kali/ kali-rolling main" > /etc/apt/sources.list`
                }),
                'ubuntu': (name, data) => ({
                    title: `${name} - Ubuntu`,
                    cmd: `sed -i 's|archive.ubuntu.com|${serverUrl}/api/v2/mirrors/ubuntu|g' /etc/apt/sources.list`
                }),
                'mint': (name, data) => ({
                    title: `${name} - Linux Mint`,
                    cmd: `sed -i 's|packages.linuxmint.com|${serverUrl}/api/v2/mirrors/mint|g' /etc/apt/sources.list`
                }),
                // å¼€å‘å·¥å…·
                'jetbrains': (name, data) => ({
                    title: `${name} - JetBrains`,
                    cmd: `${serverUrl}/api/v2/mirrors/jetbrains/`
                }),
                'vscode': (name, data) => ({
                    title: `${name} - VS Code`,
                    cmd: `${serverUrl}/api/v2/mirrors/vscode/`
                }),
                // è¯­è¨€è¿è¡Œæ—¶
                'rustup': (name, data) => ({
                    title: `${name} - Rustup`,
                    cmd: `export RUSTUP_DIST_SERVER=${serverUrl}/api/v2/mirrors/rustup/`
                }),
                'dotnet': (name, data) => ({
                    title: `${name} - .NET SDK`,
                    cmd: `${serverUrl}/api/v2/mirrors/dotnet/`
                }),
                'node': (name, data) => ({
                    title: `${name} - Node.js`,
                    cmd: `${serverUrl}/api/v2/mirrors/node/`
                }),
                'python': (name, data) => ({
                    title: `${name} - Python`,
                    cmd: `${serverUrl}/api/v2/mirrors/python/`
                }),
                'ruby': (name, data) => ({
                    title: `${name} - Ruby`,
                    cmd: `${serverUrl}/api/v2/mirrors/ruby/`
                }),
                'java': (name, data) => ({
                    title: `${name} - Java JDK`,
                    cmd: `${serverUrl}/api/v2/mirrors/java/`
                }),
                // ç³»ç»ŸåŒ…ç®¡ç†å™¨
                'homebrew': (name, data) => ({
                    title: `${name} - Homebrew`,
                    cmd: `export HOMEBREW_BREW_GIT_REMOTE="${serverUrl}/api/v2/mirrors/homebrew/"`
                }),
                'brew': (name, data) => ({
                    title: `${name} - Brew`,
                    cmd: `export HOMEBREW_BREW_GIT_REMOTE="${serverUrl}/api/v2/mirrors/brew/"`
                }),
                'chocolatey': (name, data) => ({
                    title: `${name} - Chocolatey`,
                    cmd: `choco source add -n=hyc -s="${serverUrl}/api/v2/mirrors/chocolatey/"`
                }),
                'snap': (name, data) => ({
                    title: `${name} - Snap`,
                    cmd: `snap set system proxy.http=${serverUrl}`
                }),
                'flatpak': (name, data) => ({
                    title: `${name} - Flatpak`,
                    cmd: `flatpak remote-add --if-not-exists flathub ${serverUrl}/api/v2/mirrors/flatpak/`
                }),
                'winget': (name, data) => ({
                    title: `${name} - winget`,
                    cmd: `${serverUrl}/api/v2/mirrors/winget/`
                }),
                'scoop': (name, data) => ({
                    title: `${name} - Scoop`,
                    cmd: `scoop bucket add hyc ${serverUrl}/api/v2/mirrors/scoop/`
                }),
                // å…¶ä»–
                'termux': (name, data) => ({
                    title: `${name} - Termux`,
                    cmd: `echo "deb ${serverUrl}/api/v2/mirrors/termux/ stable main" > $PREFIX/etc/apt/sources.list`
                }),
                'msys2': (name, data) => ({
                    title: `${name} - MSYS2`,
                    cmd: `${serverUrl}/api/v2/mirrors/msys2/`
                }),
                'nix': (name, data) => ({
                    title: `${name} - Nix`,
                    cmd: `substituters = ${serverUrl}/api/v2/mirrors/nix/`
                }),
                'guix': (name, data) => ({
                    title: `${name} - Guix`,
                    cmd: `${serverUrl}/api/v2/mirrors/guix/`
                }),
                'http': (name, data) => ({
                    title: `${name} - HTTP`,
                    cmd: `${serverUrl}/${data?.target || 'custom/'}`
                })
            };

            let html = '';
            for (const [name, data] of enabledMirrors) {
                const type = data?.type || 'http';
                const template = usageTemplates[type];
                if (template) {
                    const usage = template(name, data);
                    html += `<div style="margin-bottom: 12px;"><strong>${usage.title}</strong><br><code style="color: var(--info); display: block; margin-top: 4px; white-space: pre-wrap;">${usage.cmd}</code></div>`;
                }
            }

            if (!html) {
                html = '<div style="color: var(--text-muted);">å½“å‰å¯ç”¨çš„åŠ é€Ÿæºæ— å¯ç”¨å‘½ä»¤ç¤ºä¾‹</div>';
            }

            container.innerHTML = html;
        }

        async function toggleMirror(mirror, enabled) {
            try {
                const result = await apiRequest(`/api/v2/mirrors/${mirror}/enable?enabled=${enabled}`, { method: 'PUT' });
                if (result.success) {
                    showNotification(`é•œåƒ ${mirror} å·²${enabled ? 'å¯ç”¨' : 'ç¦ç”¨'}`, 'success');
                    loadMirrors(); // åˆ·æ–°åˆ—è¡¨å’Œä½¿ç”¨è¯´æ˜
                } else {
                    showNotification(`ä¿å­˜å¤±è´¥: ${result.error}`, 'error');
                    loadMirrors();
                }
            } catch (e) {
                showNotification(`æ“ä½œå¤±è´¥: ${e.message}`, 'error');
                loadMirrors();
                loadMirrors();
            }
        }

        async function deleteMirror(mirrorName) {
            if (!confirm(`ç¡®å®šè¦åˆ é™¤åŠ é€Ÿæº '${mirrorName}' å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`)) {
                return;
            }

            try {
                const result = await apiRequest(`/api/v2/mirrors/${mirrorName}`, {
                    method: 'DELETE'
                });

                if (result.success) {
                    showNotification(`åŠ é€Ÿæº '${mirrorName}' å·²åˆ é™¤`, 'success');
                    // åˆ·æ–°åˆ—è¡¨
                    loadMirrors();
                } else {
                    showNotification(`åˆ é™¤å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (e) {
                showNotification(`åˆ é™¤å¤±è´¥: ${e.message}`, 'error');
            }
        }

        let editingMirrorName = '';

        function updateEditMirrorStatusBadge(enabled) {
            const badge = document.getElementById('editMirrorStatusBadge');
            if (badge) {
                if (enabled) {
                    badge.className = 'status-badge enabled';
                    badge.innerHTML = '<i class="fa-solid fa-check"></i> å·²å¯ç”¨';
                } else {
                    badge.className = 'status-badge disabled';
                    badge.innerHTML = '<i class="fa-solid fa-xmark"></i> å·²ç¦ç”¨';
                }
            }
        }

        async function editMirror(name) {
            editingMirrorName = name;
            try {
                const mirrors = await apiRequest('/api/v2/mirrors');
                const mirrorData = mirrors?.mirrors || {};
                const mirror = mirrorData[name];

                if (!mirror) {
                    showNotification('æ‰¾ä¸åˆ°è¯¥åŠ é€Ÿæº', 'error');
                    return;
                }

                // æ‰“å¼€å¼¹çª—ï¼ˆä¼šæ¸…ç©ºè¾“å…¥æ¡†ï¼‰
                showModal('editMirrorModal');

                // å¡«å……ç¼–è¾‘è¡¨å•
                document.getElementById('editMirrorName').value = name;
                document.getElementById('editMirrorName').disabled = true; // ä¸èƒ½ä¿®æ”¹åç§°
                document.getElementById('editMirrorType').value = mirror.type || 'custom';
                document.getElementById('editMirrorUrl').value = mirror.url || '';
                document.getElementById('editMirrorStorageDir').value = mirror.storage_dir || '';
                document.getElementById('editMirrorDesc').value = mirror.description || '';
                document.getElementById('editMirrorPriority').value = mirror.priority || 0;
                document.getElementById('editMirrorEnabled').checked = mirror.enabled !== false;

                // æ›´æ–°å¯ç”¨çŠ¶æ€å¾½ç« 
                updateEditMirrorStatusBadge(mirror.enabled !== false);

                // ç»‘å®šå¯ç”¨å¼€å…³äº‹ä»¶
                document.getElementById('editMirrorEnabled').onchange = function() {
                    updateEditMirrorStatusBadge(this.checked);
                };
            } catch (e) {
                showNotification('åŠ è½½åŠ é€Ÿæºä¿¡æ¯å¤±è´¥: ' + e.message, 'error');
            }
        }

        async function updateMirror() {
            const name = editingMirrorName;
            const type = document.getElementById('editMirrorType').value;
            const url = document.getElementById('editMirrorUrl').value.trim();
            const storageDir = document.getElementById('editMirrorStorageDir').value.trim();
            const desc = document.getElementById('editMirrorDesc').value.trim();
            const priority = parseInt(document.getElementById('editMirrorPriority').value) || 0;
            const enabled = document.getElementById('editMirrorEnabled').checked;

            if (!url) {
                showNotification('è¯·è¾“å…¥ä¸Šæ¸¸åœ°å€', 'warning');
                return;
            }

            // æ„å»ºæ›´æ–°æ•°æ®
            const updateData = {
                type: type,
                url: url,
                description: desc,
                priority: priority,
                enabled: enabled
            };

            // æ·»åŠ å­˜å‚¨ç›®å½•ï¼ˆå¦‚æœç”¨æˆ·æŒ‡å®šäº†ï¼‰
            if (storageDir) {
                updateData.storage_dir = storageDir;
            }

            try {
                const result = await apiRequest('/api/v2/mirrors/' + name, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updateData)
                });

                if (result.success) {
                    showNotification(`åŠ é€Ÿæº '${name}' å·²æ›´æ–°`, 'success');
                    hideModal('editMirrorModal');
                    loadMirrors();
                } else {
                    showNotification(`æ›´æ–°å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (e) {
                showNotification(`æ›´æ–°å¤±è´¥: ${e.message}`, 'error');
            }
        }

        async function refreshMirror(name) {
            try {
                showNotification(`æ­£åœ¨åˆ·æ–°åŠ é€Ÿæº '${name}'...`, 'info');
                const result = await apiRequest(`/api/v2/mirrors/${name}/refresh`, { method: 'POST' });
                if (result.success) {
                    showNotification(`åŠ é€Ÿæº '${name}' åˆ·æ–°æˆåŠŸ`, 'success');
                    loadMirrors();
                } else {
                    showNotification(`åˆ·æ–°å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (e) {
                showNotification(`åˆ·æ–°å¤±è´¥: ${e.message}`, 'error');
            }
        }

        // ============ é…ç½®æ–‡ä»¶ ============
        let originalConfig = '';
        let configLoadError = false;

        async function loadConfig() {
            const editor = document.getElementById('configEditor');
            editor.value = 'åŠ è½½ä¸­...';
            editor.disabled = true;

            try {
                // å°è¯•ä½¿ç”¨ V2 API
                let result = await apiRequest('/api/v2/config');

                // å¦‚æœV2 APIå¤±è´¥ï¼Œå°è¯•ä½¿ç”¨V1 API
                if (!result || !result.success) {
                    console.warn('V2 config API failed, trying V1 API...');
                    result = await apiRequest('/api/v1/config');

                    if (result && typeof result === 'object') {
                        // V1 API è¿”å›çš„æ˜¯é…ç½®å¯¹è±¡ï¼Œéœ€è¦è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²
                        editor.value = JSON.stringify(result, null, 4);
                        originalConfig = editor.value;
                        document.getElementById('configPath').textContent = 'settings.json';
                        document.getElementById('configStatus').textContent = 'å·²åŠ è½½ (V1 API)';
                        document.getElementById('configStatus').style.color = 'var(--success)';
                        editor.disabled = false;
                        configLoadError = false;
                        return;
                    }
                }

                if (result && result.success) {
                    editor.value = result.config;
                    originalConfig = result.config;
                    document.getElementById('configPath').textContent = result.path;
                    document.getElementById('configStatus').textContent = 'å·²åŠ è½½';
                    document.getElementById('configStatus').style.color = 'var(--success)';
                    validateJson(result.config);
                    editor.disabled = false;
                    configLoadError = false;
                } else {
                    throw new Error(result?.error || 'Unknown error');
                }
            } catch (e) {
                console.error('Failed to load config:', e);
                editor.value = 'åŠ è½½é…ç½®å¤±è´¥\n\né”™è¯¯ä¿¡æ¯: ' + e.message + '\n\nè¯·ç¡®ä¿æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼Œå¹¶æ£€æŸ¥APIæ˜¯å¦å¯ç”¨ã€‚';
                editor.disabled = false;
                document.getElementById('configStatus').textContent = 'åŠ è½½å¤±è´¥';
                document.getElementById('configStatus').style.color = 'var(--danger)';
                configLoadError = true;
                showNotification('åŠ è½½é…ç½®å¤±è´¥: ' + e.message, 'error');
            }
        }

        function validateJson(jsonStr) {
            try {
                JSON.parse(jsonStr);
                document.getElementById('configJsonError').style.display = 'none';
                return true;
            } catch (e) {
                document.getElementById('configJsonError').textContent = 'JSON æ ¼å¼é”™è¯¯: ' + e.message;
                document.getElementById('configJsonError').style.display = 'block';
                return false;
            }
        }

        function formatConfig() {
            try {
                const editor = document.getElementById('configEditor');
                const parsed = JSON.parse(editor.value);
                editor.value = JSON.stringify(parsed, null, 4);
                document.getElementById('configStatus').textContent = 'å·²æ ¼å¼åŒ–';
                validateJson(editor.value);
            } catch (e) {
                showNotification('æ ¼å¼åŒ–å¤±è´¥: ' + e.message, 'error');
            }
        }

        async function saveConfig() {
            const editor = document.getElementById('configEditor');
            const configContent = editor.value;

            // éªŒè¯ JSON
            if (!validateJson(configContent)) {
                showNotification('JSON æ ¼å¼é”™è¯¯ï¼Œæ— æ³•ä¿å­˜', 'error');
                return;
            }

            if (!confirm('ç¡®å®šè¦ä¿å­˜é…ç½®å—ï¼Ÿæ­¤æ“ä½œä¼šè¦†ç›–ç°æœ‰é…ç½®ã€‚')) {
                return;
            }

            try {
                const result = await apiRequest('/api/v2/config', {
                    method: 'PUT',
                    body: configContent
                });

                if (result.success) {
                    showNotification('é…ç½®å·²ä¿å­˜', 'success');
                    originalConfig = configContent;
                    document.getElementById('configStatus').textContent = 'å·²ä¿å­˜';
                } else {
                    showNotification('ä¿å­˜å¤±è´¥: ' + result.error, 'error');
                }
            } catch (e) {
                showNotification('ä¿å­˜å¤±è´¥: ' + e.message, 'error');
            }
        }

        function resetConfig() {
            if (!confirm('ç¡®å®šè¦é‡ç½®ä¸ºåŸå§‹é…ç½®å—ï¼Ÿæœªä¿å­˜çš„æ›´æ”¹å°†ä¼šä¸¢å¤±ã€‚')) {
                return;
            }
            document.getElementById('configEditor').value = originalConfig;
            document.getElementById('configStatus').textContent = 'å·²é‡ç½®';
            validateJson(originalConfig);
        }

        async function reloadConfig() {
            try {
                const result = await apiRequest('/api/v2/config');
                if (result.success) {
                    document.getElementById('configEditor').value = result.config;
                    originalConfig = result.config;
                    document.getElementById('configStatus').textContent = 'å·²é‡æ–°åŠ è½½';
                    validateJson(result.config);
                    showNotification('é…ç½®å·²é‡æ–°åŠ è½½', 'success');
                } else {
                    showNotification('é‡æ–°åŠ è½½å¤±è´¥: ' + result.error, 'error');
                }
            } catch (e) {
                showNotification('é‡æ–°åŠ è½½å¤±è´¥: ' + e.message, 'error');
            }
        }

        // ç›‘å¬é…ç½®å˜åŒ–
        document.getElementById('configEditor').addEventListener('input', function() {
            if (this.value !== originalConfig) {
                document.getElementById('configStatus').textContent = 'æœªä¿å­˜';
                document.getElementById('configStatus').style.color = 'var(--warning)';
            }
            validateJson(this.value);
        });

        // ============ ä¸‹è½½ç»Ÿè®¡ ============
        let downloadChart = null;
        let currentChartType = 'line';
        let currentPeriod = 'year';

        // åˆå§‹åŒ–é€‰æ‹©å™¨
        function initDownloadStatsSelectors() {
            const now = new Date();
            const yearSelect = document.getElementById('yearSelect');
            const monthSelect = document.getElementById('monthSelect');

            // å¡«å……å¹´ä»½ï¼ˆå½“å‰å¹´å¾€å‰5å¹´ï¼‰
            let years = [];
            for (let i = 0; i <= 5; i++) {
                years.push(now.getFullYear() - i);
            }
            yearSelect.innerHTML = years.map(y => `<option value="${y}" ${y === now.getFullYear() ? 'selected' : ''}>${y}å¹´</option>`).join('');

            // å¡«å……æœˆä»½
            monthSelect.innerHTML = Array.from({length: 12}, (_, i) => i + 1).map(m => `<option value="${m}" ${m === now.getMonth() + 1 ? 'selected' : ''}>${m}æœˆ</option>`).join('');

            // åˆå§‹åŒ–æŒ‰é’®çŠ¶æ€
            document.getElementById('lineChartBtn').classList.add('active');
        }

        // åˆ‡æ¢å›¾è¡¨ç±»å‹
        function switchChartType(type) {
            currentChartType = type;
            document.getElementById('lineChartBtn').classList.toggle('active', type === 'line');
            document.getElementById('barChartBtn').classList.toggle('active', type === 'bar');
            loadDownloadChartData();
        }

        // åˆ‡æ¢ç»Ÿè®¡å‘¨æœŸ
        function changePeriod() {
            const period = document.getElementById('periodSelect').value;
            const year = document.getElementById('yearSelect').value;
            const month = document.getElementById('monthSelect').value;
            const monthSelect = document.getElementById('monthSelect');

            currentPeriod = period;

            // æ ¹æ®å‘¨æœŸæ˜¾ç¤º/éšè—æœˆä»½é€‰æ‹©å™¨
            monthSelect.style.display = period === 'month' ? 'block' : 'none';

            loadDownloadChartData();
        }

        // åŠ è½½å›¾è¡¨æ•°æ®
        async function loadDownloadChartData() {
            const period = document.getElementById('periodSelect').value;
            const year = document.getElementById('yearSelect').value;
            const month = document.getElementById('monthSelect').value;

            const url = `/api/v2/stats/download-by-period?period=${period}&year=${year}&month=${month}`;
            const data = await apiRequest(url);

            if (data) {
                renderEnhancedChart(data);

                // æ›´æ–°å¢å¼ºç»Ÿè®¡å¡ç‰‡
                updateEnhancedStats(data, period);
            }
        }

        // æ›´æ–°å¢å¼ºç»Ÿè®¡å¡ç‰‡ï¼ˆåªæ›´æ–° yearDlï¼Œä¸ä¿®æ”¹ totalDlï¼‰
        function updateEnhancedStats(data, period) {
            const yearDl = document.getElementById('yearDl');

            if (period === 'year') {
                // å¹´åº¦è§†å›¾ï¼šæ˜¾ç¤ºå¹´åº¦æ€»ä¸‹è½½
                yearDl.textContent = formatNum(data.total || 0);
            } else if (period === 'month') {
                // æœˆåº¦è§†å›¾
                yearDl.textContent = '-';
            } else {
                // æ—¥åº¦è§†å›¾
                yearDl.textContent = '-';
            }
        }

        // æ¸²æŸ“Chart.jså›¾è¡¨
        function renderEnhancedChart(data) {
            const ctx = document.getElementById('downloadChartCanvas');
            if (!ctx) return;

            const labels = data.data.map(item => item.label);
            const values = data.data.map(item => item.value);

            // å¦‚æœå·²æœ‰å›¾è¡¨å®ä¾‹ï¼Œå…ˆé”€æ¯
            if (downloadChart) {
                downloadChart.destroy();
            }

            // ä¸»é¢˜é¢œè‰²
            const primaryColor = '#e94560';
            const primaryColorRgba = 'rgba(233, 69, 96, 0.1)';

            downloadChart = new Chart(ctx, {
                type: currentChartType,
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ä¸‹è½½é‡',
                        data: values,
                        backgroundColor: currentChartType === 'bar' ? primaryColor : primaryColorRgba,
                        borderColor: primaryColor,
                        borderWidth: 2,
                        fill: currentChartType === 'line',
                        tension: 0.4,
                        pointBackgroundColor: primaryColor,
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(26, 26, 46, 0.95)',
                            titleColor: '#fff',
                            bodyColor: '#aaa',
                            borderColor: primaryColor,
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                title: function(context) {
                                    return context[0].label;
                                },
                                label: function(context) {
                                    return 'ä¸‹è½½æ¬¡æ•°: ' + context.parsed.y;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            },
                            ticks: {
                                color: '#888',
                                maxRotation: 45,
                                minRotation: 0
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            },
                            ticks: {
                                color: '#888',
                                precision: 0
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        async function loadDownloads() {
            const stats = await apiRequest('/api/v1/stats');

            if (stats) {
                // æ ¸å¿ƒæŒ‡æ ‡
                document.getElementById('todayDl').textContent = formatNum(stats.downloads_today || 0);
                document.getElementById('weekDl').textContent = formatNum(stats.downloads_week || 0);
                // yearDl ç”±å›¾è¡¨åŠ è½½åæ›´æ–°ï¼ˆæŒ‰å¹´ç»Ÿè®¡æ—¶æ˜¾ç¤ºå¹´åº¦æ€»æ•°ï¼‰
                document.getElementById('totalDl').textContent = formatNum(stats.total_downloads || 0);
            } else {
                console.warn('APIè¿”å›ä¸ºç©º');
            }

            // åˆå§‹åŒ–é€‰æ‹©å™¨
            initDownloadStatsSelectors();

            // åŠ è½½å›¾è¡¨æ•°æ®
            await loadDownloadChartData();

            // åŠ è½½ä¸‹è½½æ’è¡Œ
            const rankData = await apiRequest('/api/v2/stats/rank?limit=20');
            const rankList = document.getElementById('downloadRank');

            if (rankData?.rank?.length > 0) {
                rankList.innerHTML = rankData.rank.map(item => {
                    const sizeStr = formatSize(item.size || 0);
                    return `<tr>
                        <td style="text-align: center;"><span class="badge badge-${item.rank <= 3 ? 'warning' : 'info'}">#${item.rank}</span></td>
                        <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${item.file || '-'}">${item.file || '-'}</td>
                        <td style="text-align: center;">${item.downloads || 0}</td>
                        <td style="text-align: center;">${sizeStr}</td>
                        <td style="text-align: center;">
                            <div class="progress" style="width: 60px; height: 6px; margin: 0 auto;">
                                <div class="progress-bar" style="width: ${item.percentage || 0}%"></div>
                            </div>
                            <span style="font-size: 11px; color: var(--text-muted);">${item.percentage || 0}%</span>
                        </td>
                    </tr>`;
                }).join('');
            } else {
                rankList.innerHTML = '<tr><td colspan="5" class="empty">æš‚æ— ä¸‹è½½æ’è¡Œæ•°æ®</td></tr>';
            }
        }

        // ============ ç³»ç»Ÿè®¾ç½® ============
        let settingsConfig = null;

        async function loadSettings() {
            // ä½¿ç”¨ v2 API è·å–å®Œæ•´çš„é…ç½®æ–‡ä»¶
            let config = {};
            try {
                const v2Config = await apiRequest('/api/v2/config');
                if (v2Config && v2Config.success && v2Config.config) {
                    config = JSON.parse(v2Config.config);
                }
            } catch (e) {
                console.warn('æ— æ³•ä» v2 API è·å–é…ç½®ï¼Œå›é€€åˆ° v1:', e);
                config = await apiRequest('/api/v1/config');
            }

            const serverInfo = await apiRequest('/api/v1/health');
            settingsConfig = config || {};

            if (config && Object.keys(config).length > 0) {
                // å®‰å…¨è®¾ç½®
                document.getElementById('ipWhitelist').value = (config.ip_whitelist || []).join('\n');
                document.getElementById('ipBlacklist').value = (config.ip_blacklist || []).join('\n');
                document.getElementById('rateLimit').value = config.rate_limit || 100;
                document.getElementById('authType').value = config.auth_type || 'none';
                document.getElementById('sessionTimeout').value = config.session_timeout || 60;

                // å­˜å‚¨è®¾ç½®
                document.getElementById('storagePath').value = config.base_dir || './downloads';
                document.getElementById('serverName').value = config.server_name || 'HYCä¸‹è½½ç«™';

                // æ•°æ®åº“è®¾ç½®
                const dbConfig = config.database || {};
                document.getElementById('dbType').value = dbConfig.type || 'sqlite';

                // SQLite
                const sqliteConfig = dbConfig.sqlite || {};
                document.getElementById('dbPath').value = sqliteConfig.path || './data/hyc.db';

                // PostgreSQL
                const pgConfig = dbConfig.postgresql || {};
                document.getElementById('dbHost').value = pgConfig.host || 'localhost';
                document.getElementById('dbPort').value = pgConfig.port || 5432;
                document.getElementById('dbUser').value = pgConfig.user || 'postgres';
                document.getElementById('dbPassword').value = pgConfig.password || '';
                document.getElementById('dbName').value = pgConfig.database || 'hyc';

                // MySQL
                const mysqlConfig = dbConfig.mysql || {};
                document.getElementById('mysqlHost').value = mysqlConfig.host || 'localhost';
                document.getElementById('mysqlPort').value = mysqlConfig.port || 3306;
                document.getElementById('mysqlUser').value = mysqlConfig.user || 'root';
                document.getElementById('mysqlPassword').value = mysqlConfig.password || '';
                document.getElementById('mysqlName').value = mysqlConfig.database || 'hyc';

                // åˆ‡æ¢æ•°æ®åº“é…ç½®UI
                switchDbType();

                // åŒæ­¥è®¾ç½®
                document.getElementById('syncInterval').value = config.sync_interval || 60;
                document.getElementById('autoSync').checked = config.auto_sync || false;
                document.getElementById('autoClean').checked = config.auto_clean || false;
                document.getElementById('cleanInterval').value = config.clean_interval || 7;

                // åŠŸèƒ½å¼€å…³
                document.getElementById('enableBrowse').checked = config.enable_browse !== false;
                document.getElementById('showHidden').checked = config.show_hidden || false;
                document.getElementById('showHash').checked = config.show_hash !== false;
                document.getElementById('enableWebSocket').checked = config.enable_websocket !== false;
                document.getElementById('enableSSE').checked = config.enable_sse !== false;
                document.getElementById('enableMonitor').checked = config.enable_monitor !== false;

                // æœåŠ¡å™¨é…ç½®
                document.getElementById('serverHost').value = config.host || '0.0.0.0';
                document.getElementById('serverPort').value = config.port || 8080;
                document.getElementById('apiVersion').value = config.api_version || 'v1';

                // æ’åºè®¾ç½®
                document.getElementById('sortBy').value = config.sort_by || 'name';
                document.getElementById('sortReverse').checked = config.sort_reverse || false;

                // æœç´¢è®¾ç½®
                document.getElementById('maxSearchResults').value = config.max_search_results || 100;
                document.getElementById('calculateHash').checked = config.calculate_hash || false;

                // SSL è®¾ç½®
                const sslConfig = config.ssl || {};
                document.getElementById('enableSSL').checked = sslConfig.enabled || false;
                document.getElementById('sslCert').value = sslConfig.cert || '';
                document.getElementById('sslKey').value = sslConfig.key || '';

                // å¥åº·æ£€æŸ¥
                const healthConfig = config.health_check || {};
                document.getElementById('enableHealthCheck').checked = healthConfig.enabled !== false;
                document.getElementById('healthCheckInterval').value = healthConfig.interval || 60;
                document.getElementById('healthCheckTimeout').value = healthConfig.timeout || 10;
                document.getElementById('healthCheckRetries').value = healthConfig.max_retries || 3;

                // æ•…éšœè½¬ç§»
                const failoverConfig = config.failover || {};
                document.getElementById('enableFailover').checked = failoverConfig.enabled || false;
                document.getElementById('failoverThreshold').value = failoverConfig.threshold || 3;

                // æ€§èƒ½è®¾ç½®
                document.getElementById('maxThreads').value = config.max_threads || 4;
                document.getElementById('monitorInterval').value = config.monitor_interval || 3;
                document.getElementById('healthInterval').value = config.health_check_interval || 30;
                document.getElementById('maxUploadSize').value = config.max_upload_size ? Math.round(config.max_upload_size / (1024*1024)) : 1024;
                document.getElementById('requestTimeout').value = config.request_timeout || 300;

                // å‘Šè­¦è®¾ç½®
                document.getElementById('enableAlerts').checked = config.enable_alerts !== false;
                document.getElementById('diskWarning').value = config.disk_warning_threshold || 80;
                document.getElementById('diskCritical').value = config.disk_critical_threshold || 90;
                document.getElementById('smtpServer').value = config.smtp_server || '';
                document.getElementById('smtpPort').value = config.smtp_port || 587;
                document.getElementById('smtpFrom').value = config.smtp_from || '';
                document.getElementById('alertEmail').value = config.alert_email || '';

                // Webhook è®¾ç½®
                const webhooksConfig = config.webhooks || {};
                document.getElementById('enableWebhook').checked = webhooksConfig.enabled || false;
                document.getElementById('webhookUrl').value = webhooksConfig.url || '';

                // å®šæ—¶ä»»åŠ¡
                const tasksConfig = config.scheduled_tasks || {};
                const cleanupTask = tasksConfig.cleanup_db || {};
                document.getElementById('enableCleanupTask').checked = cleanupTask.enabled || false;
                document.getElementById('cleanupCron').value = cleanupTask.cron || '0 2 * * *';

                // æ—¥å¿—/è°ƒè¯•è®¾ç½®
                document.getElementById('debugMode').checked = config.debug || false;
                document.getElementById('debugHttp').checked = config.debug_http || false;
                document.getElementById('debugAuth').checked = config.debug_auth || false;
                document.getElementById('logFile').value = config.log_file || './logs/hyc.log';
                document.getElementById('logLevel').value = config.log_level || 'INFO';

                // å®‰å…¨é€‰é¡¹
                document.getElementById('enableRange').checked = config.enable_range !== false;
                document.getElementById('enableStats').checked = config.enable_stats !== false;

                // ç¼“å­˜è®¾ç½®
                document.getElementById('cacheSize').value = config.cache_size ? Math.round(config.cache_size / (1024*1024)) : 1024;
                document.getElementById('cacheTTL').value = config.cache_ttl || 3600;

                // è¿æ¥æ± è®¾ç½®
                document.getElementById('poolSize').value = config.pool_size || 5;
                document.getElementById('maxOverflow').value = config.max_overflow || 10;
            }

            if (serverInfo?.server?.uptime) {
                document.getElementById('serverUptime').textContent = formatUptime(serverInfo.server.uptime);
            }
            // ç‰ˆæœ¬å·ä» config è·å–
            if (config?.version) {
                document.getElementById('serverVersion').textContent = config.version;
            }
        }

        // ä¿®æ”¹å¯†ç 
        async function changePassword() {
            // ä¼˜å…ˆä½¿ç”¨è¾“å…¥æ¡†ä¸­çš„ç”¨æˆ·åï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨ä¿å­˜çš„ç™»å½•ç”¨æˆ·å
            const savedUsername = localStorage.getItem('hyc_username') || '';
            let username = document.getElementById('changePasswordUsername').value.trim();
            if (!username && savedUsername) {
                username = savedUsername;
                document.getElementById('changePasswordUsername').value = username;
            }
            const oldPassword = document.getElementById('changePasswordOld').value;
            const newPassword = document.getElementById('changePasswordNew').value;
            const confirmPassword = document.getElementById('changePasswordConfirm').value;

            if (!username || !newPassword) {
                showNotification('ç”¨æˆ·åå’Œæ–°å¯†ç ä¸èƒ½ä¸ºç©º', 'error');
                return;
            }

            if (newPassword !== confirmPassword) {
                showNotification('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´', 'error');
                return;
            }

            if (newPassword.length < 4) {
                showNotification('å¯†ç é•¿åº¦è‡³å°‘4ä½', 'error');
                return;
            }

            try {
                const response = await apiRequest('/api/v2/user/password', {
                    method: 'POST',
                    body: JSON.stringify({
                        username: username,
                        old_password: oldPassword,
                        new_password: newPassword
                    })
                });

                if (response.success) {
                    showNotification('å¯†ç ä¿®æ”¹æˆåŠŸ', 'success');
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('changePasswordOld').value = '';
                    document.getElementById('changePasswordNew').value = '';
                    document.getElementById('changePasswordConfirm').value = '';
                } else {
                    showNotification(response.error || 'å¯†ç ä¿®æ”¹å¤±è´¥', 'error');
                }
            } catch (e) {
                showNotification('å¯†ç ä¿®æ”¹å¤±è´¥: ' + e.message, 'error');
            }
        }

        // åŠ è½½ç™»å½•æ—¥å¿—
        async function loadLoginLogs() {
            try {
                const response = await apiRequest('/api/v2/user/login-logs?limit=50');
                const logsTable = document.getElementById('loginLogsTable');

                if (!response.success || !response.logs || response.logs.length === 0) {
                    logsTable.innerHTML = '<tr><td colspan="5" class="empty">æš‚æ— ç™»å½•è®°å½•</td></tr>';
                    return;
                }

                logsTable.innerHTML = response.logs.map(log => {
                    const time = log.created_at ? new Date(log.created_at * 1000).toLocaleString() : '-';
                    const statusClass = log.status === 'success' ? 'badge-success' : (log.status === 'locked' ? 'badge-danger' : 'badge-warning');
                    const statusText = log.status === 'success' ? 'æˆåŠŸ' : (log.status === 'locked' ? 'é”å®š' : 'å¤±è´¥');

                    return `<tr>
                        <td>${time}</td>
                        <td>${log.username || '-'}</td>
                        <td><span class="badge ${statusClass}">${statusText}</span></td>
                        <td>${log.ip_address || '-'}</td>
                        <td>${log.reason || '-'}</td>
                    </tr>`;
                }).join('');
            } catch (e) {
                console.error('åŠ è½½ç™»å½•æ—¥å¿—å¤±è´¥:', e);
            }
        }

        async function saveSettings() {
            if (!settingsConfig) {
                showNotification('æ— æ³•åŠ è½½é…ç½®', 'error');
                return;
            }

            // ä¿å­˜å‰ç¡®è®¤
            if (!confirm('ç¡®å®šè¦ä¿å­˜æ‰€æœ‰è®¾ç½®å—ï¼Ÿ')) {
                return;
            }

            // éªŒè¯æ•°å€¼èŒƒå›´
            const rateLimit = parseInt(document.getElementById('rateLimit').value) || 100;
            const sessionTimeout = parseInt(document.getElementById('sessionTimeout').value) || 60;
            const syncInterval = parseInt(document.getElementById('syncInterval').value) || 60;
            const cleanInterval = parseInt(document.getElementById('cleanInterval').value) || 7;
            const maxThreads = parseInt(document.getElementById('maxThreads').value) || 4;
            const monitorInterval = parseInt(document.getElementById('monitorInterval').value) || 3;
            const maxUploadSize = parseInt(document.getElementById('maxUploadSize').value) || 1024;
            const requestTimeout = parseInt(document.getElementById('requestTimeout').value) || 300;
            const diskWarning = parseInt(document.getElementById('diskWarning').value) || 80;
            const diskCritical = parseInt(document.getElementById('diskCritical').value) || 90;

            // åŸºæœ¬éªŒè¯
            if (rateLimit < 1 || rateLimit > 10000) {
                showNotification('è¯·æ±‚é€Ÿç‡é™åˆ¶åº”åœ¨ 1-10000 ä¹‹é—´', 'warning');
                return;
            }
            if (sessionTimeout < 1 || sessionTimeout > 10080) {
                showNotification('ä¼šè¯è¶…æ—¶åº”åœ¨ 1-10080 åˆ†é’Ÿä¹‹é—´', 'warning');
                return;
            }
            if (syncInterval < 1 || syncInterval > 10080) {
                showNotification('åŒæ­¥é—´éš”åº”åœ¨ 1-10080 åˆ†é’Ÿä¹‹é—´', 'warning');
                return;
            }
            if (maxThreads < 1 || maxThreads > 32) {
                showNotification('æœ€å¤§çº¿ç¨‹æ•°åº”åœ¨ 1-32 ä¹‹é—´', 'warning');
                return;
            }
            if (diskWarning >= diskCritical) {
                showNotification('è­¦å‘Šé˜ˆå€¼å¿…é¡»å°äºä¸¥é‡é˜ˆå€¼', 'warning');
                return;
            }

            // æ”¶é›†æ‰€æœ‰è®¾ç½®
            const updates = {
                // å®‰å…¨è®¾ç½®
                ip_whitelist: document.getElementById('ipWhitelist').value.split('\n').filter(line => line.trim()),
                ip_blacklist: document.getElementById('ipBlacklist').value.split('\n').filter(line => line.trim()),
                rate_limit: rateLimit,
                auth_type: document.getElementById('authType').value || 'none',
                session_timeout: sessionTimeout,

                // å­˜å‚¨è®¾ç½®
                base_dir: document.getElementById('storagePath').value || './downloads',
                server_name: document.getElementById('serverName').value || 'HYCä¸‹è½½ç«™',

                // è¿™é‡Œçš„ host/port/api_version ç§»åˆ°åŠŸèƒ½å¼€å…³éƒ¨åˆ†ä¿å­˜

                // æ•°æ®åº“è®¾ç½® - éœ€è¦åµŒå¥—åœ¨ database å¯¹è±¡ä¸­
                database: {
                    type: document.getElementById('dbType').value || 'sqlite',
                    sqlite: {
                        path: document.getElementById('dbPath').value || './data/hyc.db'
                    },
                    postgresql: {
                        host: document.getElementById('dbHost').value || 'localhost',
                        port: parseInt(document.getElementById('dbPort').value) || 5432,
                        user: document.getElementById('dbUser').value || 'postgres',
                        password: document.getElementById('dbPassword').value || '',
                        database: document.getElementById('dbName').value || 'hyc'
                    },
                    mysql: {
                        host: document.getElementById('mysqlHost').value || 'localhost',
                        port: parseInt(document.getElementById('mysqlPort').value) || 3306,
                        user: document.getElementById('mysqlUser').value || 'root',
                        password: document.getElementById('mysqlPassword').value || '',
                        database: document.getElementById('mysqlName').value || 'hyc'
                    }
                },

                // åŒæ­¥è®¾ç½®
                sync_interval: syncInterval,
                auto_sync: document.getElementById('autoSync').checked,
                auto_clean: document.getElementById('autoClean').checked,
                clean_interval: cleanInterval,

                // åŠŸèƒ½å¼€å…³
                enable_browse: document.getElementById('enableBrowse').checked,
                show_hidden: document.getElementById('showHidden').checked,
                show_hash: document.getElementById('showHash').checked,
                enable_websocket: document.getElementById('enableWebSocket').checked,
                enable_sse: document.getElementById('enableSSE').checked,
                enable_monitor: document.getElementById('enableMonitor').checked,

                // æœåŠ¡å™¨é…ç½®
                host: document.getElementById('serverHost').value || '0.0.0.0',
                port: parseInt(document.getElementById('serverPort').value) || 8080,
                api_version: document.getElementById('apiVersion').value || 'v1',

                // æ’åºè®¾ç½®
                sort_by: document.getElementById('sortBy').value || 'name',
                sort_reverse: document.getElementById('sortReverse').checked,

                // æœç´¢è®¾ç½®
                max_search_results: parseInt(document.getElementById('maxSearchResults').value) || 100,
                calculate_hash: document.getElementById('calculateHash').checked,

                // SSL è®¾ç½®
                ssl: {
                    enabled: document.getElementById('enableSSL').checked,
                    cert: document.getElementById('sslCert').value || null,
                    key: document.getElementById('sslKey').value || null
                },

                // å¥åº·æ£€æŸ¥
                health_check: {
                    enabled: document.getElementById('enableHealthCheck').checked,
                    interval: parseInt(document.getElementById('healthCheckInterval').value) || 60,
                    timeout: parseInt(document.getElementById('healthCheckTimeout').value) || 10,
                    max_retries: parseInt(document.getElementById('healthCheckRetries').value) || 3
                },

                // æ•…éšœè½¬ç§»
                failover: {
                    enabled: document.getElementById('enableFailover').checked,
                    threshold: parseInt(document.getElementById('failoverThreshold').value) || 3
                },

                // æ€§èƒ½è®¾ç½®
                max_threads: maxThreads,
                monitor_interval: monitorInterval,
                health_check_interval: parseInt(document.getElementById('healthInterval').value) || 30,
                max_upload_size: maxUploadSize * 1024 * 1024,
                request_timeout: requestTimeout,

                // å‘Šè­¦è®¾ç½®
                enable_alerts: document.getElementById('enableAlerts').checked,
                disk_warning_threshold: diskWarning,
                disk_critical_threshold: diskCritical,
                smtp_server: document.getElementById('smtpServer').value || '',
                smtp_port: parseInt(document.getElementById('smtpPort').value) || 587,
                smtp_from: document.getElementById('smtpFrom').value || '',
                alert_email: document.getElementById('alertEmail').value || '',

                // Webhook è®¾ç½®
                webhooks: {
                    enabled: document.getElementById('enableWebhook').checked,
                    url: document.getElementById('webhookUrl').value || ''
                },

                // å®šæ—¶ä»»åŠ¡
                scheduled_tasks: {
                    cleanup_db: {
                        type: 'cron',
                        config: {
                            cron: document.getElementById('cleanupCron').value || '0 2 * * *',
                            enabled: document.getElementById('enableCleanupTask').checked
                        }
                    }
                },

                // æ—¥å¿—/è°ƒè¯•è®¾ç½®
                debug: document.getElementById('debugMode').checked,
                debug_http: document.getElementById('debugHttp').checked,
                debug_auth: document.getElementById('debugAuth').checked,
                log_file: document.getElementById('logFile').value || './logs/hyc.log',
                log_level: document.getElementById('logLevel').value || 'INFO',

                // å®‰å…¨é€‰é¡¹
                enable_range: document.getElementById('enableRange').checked,
                enable_stats: document.getElementById('enableStats').checked,

                // ç¼“å­˜è®¾ç½®
                cache_size: parseInt(document.getElementById('cacheSize').value || 1024) * 1024 * 1024,
                cache_ttl: parseInt(document.getElementById('cacheTTL').value) || 3600,

                // è¿æ¥æ± è®¾ç½®
                pool_size: parseInt(document.getElementById('poolSize').value) || 5,
                max_overflow: parseInt(document.getElementById('maxOverflow').value) || 10
            };

            // åˆå¹¶æ›´æ–°åˆ°é…ç½®
            const newConfig = { ...settingsConfig, ...updates };

            try {
                const result = await apiRequest('/api/v2/config', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newConfig, null, 2)
                });

                if (result.success) {
                    showNotification('è®¾ç½®å·²ä¿å­˜æˆåŠŸ', 'success');
                    settingsConfig = newConfig;
                } else {
                    showNotification('ä¿å­˜å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯'), 'error');
                }
            } catch (e) {
                // å¦‚æœ PUT /api/v2/config ä¸å¯ç”¨ï¼Œå°è¯•ä½¿ç”¨å…¶ä»–æ–¹å¼
                console.warn('ä¿å­˜é…ç½®å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨å¤‡ç”¨æ–¹å¼:', e);
                showNotification('é…ç½®å·²æš‚å­˜ï¼Œéœ€è¦é‡æ–°åŠ è½½é…ç½®ç”Ÿæ•ˆ', 'info');
            }
        }

        // ============ å·¥å…·å‡½æ•° ============
        function formatSize(bytes) {
            const units = ['B', 'KB', 'MB', 'GB', 'TB'];
            let i = 0;
            while (bytes >= 1024 && i < units.length - 1) { bytes /= 1024; i++; }
            return bytes.toFixed(1) + ' ' + units[i];
        }

        function formatUptime(seconds) {
            if (!seconds) return '-';
            const days = Math.floor(seconds / 86400);
            const hours = Math.floor((seconds % 86400) / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);
            let result = '';
            if (days > 0) result += days + 'å¤© ';
            if (hours > 0) result += hours + 'æ—¶ ';
            if (mins > 0) result += mins + 'åˆ† ';
            result += secs + 'ç§’';
            return result;
        }

        function formatNum(n) {
            return n?.toLocaleString() || '0';
        }

        function getFileIcon(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const icons = {
                // å‹ç¼©æ–‡ä»¶
                zip: '<i class="fa-solid fa-file-zipper"></i>',
                tar: '<i class="fa-solid fa-file-zipper"></i>',
                gz: '<i class="fa-solid fa-file-zipper"></i>',
                rar: '<i class="fa-solid fa-file-zipper"></i>',
                '7z': '<i class="fa-solid fa-file-zipper"></i>',
                iso: '<i class="fa-solid fa-compact-disc"></i>',
                // æ–‡æ¡£
                pdf: '<i class="fa-solid fa-file-pdf"></i>',
                doc: '<i class="fa-solid fa-file-word"></i>',
                docx: '<i class="fa-solid fa-file-word"></i>',
                xls: '<i class="fa-solid fa-file-excel"></i>',
                xlsx: '<i class="fa-solid fa-file-excel"></i>',
                ppt: '<i class="fa-solid fa-file-powerpoint"></i>',
                pptx: '<i class="fa-solid fa-file-powerpoint"></i>',
                // ä»£ç /æ–‡æœ¬
                txt: '<i class="fa-solid fa-file-lines"></i>',
                md: '<i class="fa-brands fa-markdown"></i>',
                json: '<i class="fa-solid fa-code"></i>',
                xml: '<i class="fa-solid fa-code"></i>',
                html: '<i class="fa-brands fa-html5"></i>',
                htm: '<i class="fa-brands fa-html5"></i>',
                css: '<i class="fa-brands fa-css3"></i>',
                scss: '<i class="fa-brands fa-sass"></i>',
                js: '<i class="fa-brands fa-js"></i>',
                ts: '<i class="fa-brands fa-js"></i>',
                py: '<i class="fa-brands fa-python"></i>',
                java: '<i class="fa-brands fa-java"></i>',
                c: '<i class="fa-solid fa-c"></i>',
                cpp: '<i class="fa-solid fa-c"></i>',
                h: '<i class="fa-solid fa-c"></i>',
                cs: '<i class="fa-solid fa-c"></i>',
                go: '<i class="fa-brands fa-golang"></i>',
                rs: '<i class="fa-brands fa-rust"></i>',
                rb: '<i class="fa-solid fa-gem"></i>',
                php: '<i class="fa-brands fa-php"></i>',
                swift: '<i class="fa-brands fa-swift"></i>',
                kt: '<i class="fa-solid fa-k"></i>',
                // å›¾ç‰‡
                img: '<i class="fa-solid fa-image"></i>',
                jpg: '<i class="fa-solid fa-image"></i>',
                jpeg: '<i class="fa-solid fa-image"></i>',
                png: '<i class="fa-solid fa-image"></i>',
                gif: '<i class="fa-solid fa-image"></i>',
                bmp: '<i class="fa-solid fa-image"></i>',
                svg: '<i class="fa-solid fa-vector-square"></i>',
                ico: '<i class="fa-solid fa-image"></i>',
                webp: '<i class="fa-solid fa-image"></i>',
                // éŸ³è§†é¢‘
                mp4: '<i class="fa-solid fa-video"></i>',
                avi: '<i class="fa-solid fa-video"></i>',
                mkv: '<i class="fa-solid fa-video"></i>',
                mov: '<i class="fa-solid fa-video"></i>',
                mp3: '<i class="fa-solid fa-music"></i>',
                wav: '<i class="fa-solid fa-music"></i>',
                ogg: '<i class="fa-solid fa-music"></i>',
                flac: '<i class="fa-solid fa-music"></i>',
                // å¯æ‰§è¡Œ/ç³»ç»Ÿ
                apk: '<i class="fa-solid fa-mobile-screen"></i>',
                exe: '<i class="fa-solid fa-desktop"></i>',
                sh: '<i class="fa-solid fa-terminal"></i>',
                bat: '<i class="fa-solid fa-terminal"></i>',
                cmd: '<i class="fa-solid fa-terminal"></i>',
                // æ•°æ®åº“
                sql: '<i class="fa-solid fa-database"></i>',
                db: '<i class="fa-solid fa-database"></i>',
                sqlite: '<i class="fa-solid fa-database"></i>',
                mdb: '<i class="fa-solid fa-database"></i>',
                // é…ç½®
                yaml: '<i class="fa-solid fa-gear"></i>',
                yml: '<i class="fa-solid fa-gear"></i>',
                ini: '<i class="fa-solid fa-gear"></i>',
                conf: '<i class="fa-solid fa-gear"></i>',
                config: '<i class="fa-solid fa-gear"></i>',
                env: '<i class="fa-solid fa-gear"></i>',
                toml: '<i class="fa-solid fa-gear"></i>',
                // å…¶ä»–
                log: '<i class="fa-solid fa-clipboard-list"></i>',
                csv: '<i class="fa-solid fa-file-csv"></i>',
                dll: '<i class="fa-solid fa-gear"></i>',
                so: '<i class="fa-solid fa-gear"></i>',
                dylib: '<i class="fa-solid fa-gear"></i>',
                tgz: '<i class="fa-solid fa-file-zipper"></i>',
                xz: '<i class="fa-solid fa-file-zipper"></i>',
                bak: '<i class="fa-solid fa-file-pen"></i>',
                backup: '<i class="fa-solid fa-floppy-disk"></i>',
                properties: '<i class="fa-solid fa-sliders"></i>',
                gradle: '<i class="fa-brands fa-graduation-cap"></i>',
                makefile: '<i class="fa-solid fa-hammer"></i>',
                dockerfile: '<i class="fa-brands fa-docker"></i>',
                nginx: '<i class="fa-solid fa-server"></i>',
                apache: '<i class="fa-solid fa-server"></i>',
                sql: '<i class="fa-solid fa-database"></i>',
            };
            return icons[ext] || '<i class="fa-regular fa-file"></i>';
        }

        // ============ åˆå§‹åŒ– ============
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', function() {
            initApp();
        });
    </script>
</body>
</html>
